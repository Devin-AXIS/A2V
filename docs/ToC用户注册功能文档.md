# ToCç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ToCç”¨æˆ·æ³¨å†ŒåŠŸèƒ½å…è®¸å‰ç«¯ç”¨æˆ·é€šè¿‡æ‰‹æœºå·è‡ªä¸»æ³¨å†Œï¼Œå¹¶è‡ªåŠ¨åŒæ­¥åˆ°åå°ç”¨æˆ·åˆ—è¡¨ä¸­ã€‚æ”¯æŒæ™ºèƒ½åˆå¹¶åŠŸèƒ½ï¼Œå½“æ³¨å†Œç”¨æˆ·ä¸åå°å·²æœ‰ç”¨æˆ·æ‰‹æœºå·ç›¸åŒæ—¶ï¼Œä¼šè‡ªåŠ¨åˆå¹¶ç”¨æˆ·ä¿¡æ¯ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. åŒé‡ç”¨æˆ·æ¥æº
- **åå°æ‰‹åŠ¨æ·»åŠ **ï¼šç®¡ç†å‘˜åœ¨åå°æ‰‹åŠ¨åˆ›å»ºç”¨æˆ·
- **å‰ç«¯ç”¨æˆ·æ³¨å†Œ**ï¼šç”¨æˆ·é€šè¿‡æ‰‹æœºå·è‡ªä¸»æ³¨å†Œ

### 2. æ™ºèƒ½åˆå¹¶æœºåˆ¶
- **ç›¸åŒæ‰‹æœºå·æ£€æµ‹**ï¼šæ³¨å†Œæ—¶è‡ªåŠ¨æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²å­˜åœ¨
- **è‡ªåŠ¨åˆå¹¶**ï¼šå‘ç°ç›¸åŒæ‰‹æœºå·æ—¶è‡ªåŠ¨åˆå¹¶ç”¨æˆ·ä¿¡æ¯
- **æ•°æ®ä¿ç•™ç­–ç•¥**ï¼šä¿ç•™åå°ç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼Œæ·»åŠ æ³¨å†Œç”¨æˆ·å¯†ç å’Œæ‰©å±•ä¿¡æ¯

### 3. ç”¨æˆ·çŠ¶æ€ç®¡ç†
- **pending**ï¼šåå°æ·»åŠ ï¼Œæ— å¯†ç çŠ¶æ€
- **active**ï¼šæ³¨å†Œç”¨æˆ·æˆ–å·²åˆå¹¶ç”¨æˆ·ï¼Œæœ‰å¯†ç çŠ¶æ€
- **inactive**ï¼šå·²ç¦ç”¨çŠ¶æ€

## ğŸ”§ APIæ¥å£

### ç”¨æˆ·æ³¨å†Œæ¥å£

**æ¥å£åœ°å€**ï¼š
```
POST /api/modules/system/user/register?applicationId={applicationId}
```

**è¯·æ±‚å¤´**ï¼š
```
Content-Type: application/json
Authorization: Bearer {token}
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "phone": "13800138000",        // å¿…å¡«ï¼šæ‰‹æœºå·
  "password": "password123",     // å¿…å¡«ï¼šå¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰
  "name": "å¼ ä¸‰",                // å¯é€‰ï¼šå§“å
  "email": "zhangsan@example.com", // å¯é€‰ï¼šé‚®ç®±
  "gender": "ç”·",                // å¯é€‰ï¼šæ€§åˆ«
  "city": "åŒ—äº¬",                // å¯é€‰ï¼šåŸå¸‚
  "birthday": "1990-01-01",      // å¯é€‰ï¼šç”Ÿæ—¥
  "avatar": "avatar_url"         // å¯é€‰ï¼šå¤´åƒURL
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "id": "7e87aa0e-4d7b-4bb2-b84f-54042aafe664",
    "applicationId": "355cf09a-6aea-4d0d-985f-71db6442c12c",
    "name": "å¼ ä¸‰",
    "email": "zhangsan@example.com",
    "phone": "13800138000",
    "status": "active",
    "role": "user",
    "metadata": {
      "city": "åŒ—äº¬",
      "gender": "ç”·",
      "source": "register",
      "password": "password123",
      "registeredAt": "2025-08-31T16:40:29.122Z"
    },
    "createdAt": "2025-08-31T16:40:29.122Z",
    "updatedAt": "2025-08-31T16:40:29.122Z"
  },
  "message": "ç”¨æˆ·æ³¨å†ŒæˆåŠŸ"
}
```

### ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢æ¥å£

**æ¥å£åœ°å€**ï¼š
```
GET /api/modules/system/user?applicationId={applicationId}
```

**æŸ¥è¯¢å‚æ•°**ï¼š
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰
- `search`: æœç´¢å…³é”®è¯
- `status`: ç”¨æˆ·çŠ¶æ€ç­›é€‰
- `role`: ç”¨æˆ·è§’è‰²ç­›é€‰

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "users": [
      {
        "id": "7e87aa0e-4d7b-4bb2-b84f-54042aafe664",
        "name": "å¼ ä¸‰",
        "email": "zhangsan@example.com",
        "phone": "13800138000",
        "status": "active",
        "role": "user",
        "metadata": {
          "city": "åŒ—äº¬",
          "gender": "ç”·",
          "source": "register"
        }
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 1,
      "totalPages": 1
    }
  }
}
```

## ğŸ”„ åˆå¹¶é€»è¾‘è¯¦è§£

### åˆå¹¶è§¦å‘æ¡ä»¶
å½“ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ç›¸åŒæ‰‹æœºå·çš„ç”¨æˆ·ï¼š
```typescript
const existingUser = await findUserByPhone(applicationId, phone)
if (existingUser) {
  // æ‰§è¡Œåˆå¹¶é€»è¾‘
  return await mergeUser(applicationId, existingUser.id, registerData)
}
```

### åˆå¹¶ç­–ç•¥
```typescript
// åˆå¹¶åçš„ç”¨æˆ·æ•°æ®ç»“æ„
{
  // ä¿ç•™åå°ç”¨æˆ·çš„åŸºç¡€ä¿¡æ¯
  "name": "æå››",                    // åå°è®¾ç½®
  "email": "lisi@example.com",       // åå°è®¾ç½®
  "phone": "13900139000",           // åˆå¹¶å­—æ®µ
  "role": "admin",                  // åå°è®¾ç½®
  "department": "æŠ€æœ¯éƒ¨",            // åå°è®¾ç½®
  "position": "å·¥ç¨‹å¸ˆ",              // åå°è®¾ç½®
  "status": "active",               // åˆå¹¶åæ¿€æ´»
  
  // æ·»åŠ æ³¨å†Œç”¨æˆ·çš„æ‰©å±•ä¿¡æ¯
  "metadata": {
    "password": "newpassword123",    // æ³¨å†Œæ—¶è®¾ç½®
    "gender": "å¥³",                  // æ³¨å†Œæ—¶å¡«å†™
    "city": "ä¸Šæµ·",                  // æ³¨å†Œæ—¶å¡«å†™
    "source": "merged",              // åˆå¹¶æ ‡è¯†
    "mergedAt": "2025-08-31T16:40:51.321Z", // åˆå¹¶æ—¶é—´
    "originalSource": "manual"       // åŸå§‹æ¥æº
  }
}
```

### åˆå¹¶è§„åˆ™
1. **åŸºç¡€ä¿¡æ¯**ï¼šä»¥åå°ç”¨æˆ·ä¸ºå‡†ï¼ˆå§“åã€é‚®ç®±ã€è§’è‰²ã€éƒ¨é—¨ã€èŒä½ï¼‰
2. **æ‰‹æœºå·**ï¼šä½¿ç”¨æ³¨å†Œç”¨æˆ·çš„æ‰‹æœºå·
3. **å¯†ç **ï¼šä½¿ç”¨æ³¨å†Œç”¨æˆ·çš„å¯†ç 
4. **æ‰©å±•ä¿¡æ¯**ï¼šåˆå¹¶æ³¨å†Œç”¨æˆ·çš„é¢å¤–ä¿¡æ¯åˆ°metadata
5. **çŠ¶æ€**ï¼šè‡ªåŠ¨æ¿€æ´»ï¼ˆactiveï¼‰
6. **æ¥æºæ ‡è¯†**ï¼šæ ‡è®°ä¸º"merged"ï¼Œè®°å½•åˆå¹¶æ—¶é—´

## ğŸ“Š ç”¨æˆ·æ•°æ®å­—æ®µè¯´æ˜

### åŸºç¡€å­—æ®µï¼ˆåå°å¯è§ï¼‰
- `id`: ç”¨æˆ·ID
- `name`: å§“å
- `email`: é‚®ç®±
- `phone`: æ‰‹æœºå·
- `status`: çŠ¶æ€ï¼ˆactive/inactive/pendingï¼‰
- `role`: è§’è‰²ï¼ˆadmin/user/guestï¼‰
- `department`: éƒ¨é—¨
- `position`: èŒä½
- `tags`: æ ‡ç­¾
- `lastLoginAt`: æœ€åç™»å½•æ—¶é—´
- `createdAt`: åˆ›å»ºæ—¶é—´
- `updatedAt`: æ›´æ–°æ—¶é—´

### æ‰©å±•å­—æ®µï¼ˆå­˜å‚¨åœ¨metadataä¸­ï¼‰
- `password`: å¯†ç ï¼ˆéœ€è¦åŠ å¯†å­˜å‚¨ï¼‰
- `gender`: æ€§åˆ«
- `city`: åŸå¸‚
- `birthday`: ç”Ÿæ—¥
- `avatar`: å¤´åƒ
- `source`: æ¥æºï¼ˆregister/manual/mergedï¼‰
- `registeredAt`: æ³¨å†Œæ—¶é—´
- `mergedAt`: åˆå¹¶æ—¶é—´
- `originalSource`: åŸå§‹æ¥æº

## ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘

### å½“å‰å®ç°
- å¯†ç æ˜æ–‡å­˜å‚¨ï¼ˆéœ€è¦æ”¹è¿›ï¼‰
- æ‰‹æœºå·ä½œä¸ºå”¯ä¸€æ ‡è¯†
- è‡ªåŠ¨åˆå¹¶æœºåˆ¶

### å»ºè®®æ”¹è¿›
1. **å¯†ç åŠ å¯†**ï¼šä½¿ç”¨bcryptç­‰åŠ å¯†ç®—æ³•
2. **æ‰‹æœºå·éªŒè¯**ï¼šæ·»åŠ çŸ­ä¿¡éªŒè¯ç 
3. **é‡å¤æ³¨å†Œæ£€æŸ¥**ï¼šé˜²æ­¢æ¶æ„é‡å¤æ³¨å†Œ
4. **æ•°æ®éªŒè¯**ï¼šåŠ å¼ºè¾“å…¥æ•°æ®éªŒè¯

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•åœºæ™¯1ï¼šæ–°ç”¨æˆ·æ³¨å†Œ
```bash
curl -X POST "http://localhost:3001/api/modules/system/user/register?applicationId=xxx" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer test-token" \
  -d '{
    "phone": "13800138000",
    "password": "password123",
    "name": "å¼ ä¸‰",
    "gender": "ç”·",
    "city": "åŒ—äº¬"
  }'
```

**é¢„æœŸç»“æœ**ï¼š
- åˆ›å»ºæ–°ç”¨æˆ·
- çŠ¶æ€ä¸ºactive
- æ¥æºæ ‡è®°ä¸ºregister
- å‡ºç°åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­

### æµ‹è¯•åœºæ™¯2ï¼šåˆå¹¶ç°æœ‰ç”¨æˆ·
```bash
# 1. åå°æ·»åŠ ç”¨æˆ·
curl -X POST "http://localhost:3001/api/modules/system/user?applicationId=xxx" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer test-token" \
  -d '{
    "name": "æå››",
    "phone": "13900139000",
    "role": "admin",
    "department": "æŠ€æœ¯éƒ¨"
  }'

# 2. ç›¸åŒæ‰‹æœºå·æ³¨å†Œ
curl -X POST "http://localhost:3001/api/modules/system/user/register?applicationId=xxx" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer test-token" \
  -d '{
    "phone": "13900139000",
    "password": "newpassword123",
    "gender": "å¥³",
    "city": "ä¸Šæµ·"
  }'
```

**é¢„æœŸç»“æœ**ï¼š
- è‡ªåŠ¨åˆå¹¶ç”¨æˆ·
- ä¿ç•™åå°ä¿¡æ¯ï¼ˆå§“åã€è§’è‰²ã€éƒ¨é—¨ï¼‰
- æ·»åŠ æ³¨å†Œä¿¡æ¯ï¼ˆå¯†ç ã€æ€§åˆ«ã€åŸå¸‚ï¼‰
- æ¥æºæ ‡è®°ä¸ºmerged
- çŠ¶æ€ä¸ºactive

## ğŸ“‹ ä½¿ç”¨æµç¨‹

### å‰ç«¯ç”¨æˆ·æ³¨å†Œæµç¨‹
1. ç”¨æˆ·å¡«å†™æ³¨å†Œè¡¨å•ï¼ˆæ‰‹æœºå·ã€å¯†ç ã€å…¶ä»–ä¿¡æ¯ï¼‰
2. å‰ç«¯è°ƒç”¨æ³¨å†ŒAPI
3. åç«¯æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²å­˜åœ¨
4. å¦‚æœå­˜åœ¨ï¼šæ‰§è¡Œåˆå¹¶é€»è¾‘
5. å¦‚æœä¸å­˜åœ¨ï¼šåˆ›å»ºæ–°ç”¨æˆ·
6. è¿”å›æ³¨å†Œç»“æœ
7. ç”¨æˆ·è‡ªåŠ¨å‡ºç°åœ¨åå°ç”¨æˆ·åˆ—è¡¨ä¸­

### åå°ç®¡ç†æµç¨‹
1. ç®¡ç†å‘˜æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
2. å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬æ³¨å†Œç”¨æˆ·ï¼‰
3. å¯ä»¥ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯
4. å¯ä»¥ç®¡ç†ç”¨æˆ·è§’è‰²å’Œæƒé™
5. å¯ä»¥æŸ¥çœ‹ç”¨æˆ·æ¥æºå’Œåˆå¹¶å†å²

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **å¯†ç å®‰å…¨**ï¼šå®ç°å¯†ç åŠ å¯†å­˜å‚¨
2. **éªŒè¯ç **ï¼šæ·»åŠ æ‰‹æœºå·éªŒè¯ç éªŒè¯
3. **å­—æ®µç®¡ç†**ï¼šå®ç°å­—æ®µæ˜¾ç¤º/éšè—çš„è‡ªå®šä¹‰
4. **ç”¨æˆ·ç™»å½•**ï¼šå®ç°ç”¨æˆ·ç™»å½•éªŒè¯åŠŸèƒ½
5. **æƒé™æ§åˆ¶**ï¼šå®Œå–„ç”¨æˆ·æƒé™ç®¡ç†
6. **æ•°æ®å¯¼å‡º**ï¼šæ”¯æŒç”¨æˆ·æ•°æ®å¯¼å‡ºåŠŸèƒ½
7. **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒæ‰¹é‡ç”¨æˆ·ç®¡ç†æ“ä½œ

---

**é‡è¦æé†’**ï¼šå½“å‰å¯†ç ä¸ºæ˜æ–‡å­˜å‚¨ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰è¯·åŠ¡å¿…å®ç°å¯†ç åŠ å¯†åŠŸèƒ½ã€‚
