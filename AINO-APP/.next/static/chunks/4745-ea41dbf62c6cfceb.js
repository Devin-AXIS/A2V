"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4745],{34745:(e,t,a)=>{a.d(t,{PCDynamicPageComponent:()=>P});var r=a(89835),l=a(55931),s=a(68232),o=a(84212),n=a(97909),i=a(30301),d=a(8892),c=a(46393),h=a(70368),u=a(58812),m=a(19453),x=a(26941),y=a(9716),f=a(7504),g=a(35749),p=a(15496),w=a(84215),j=a(97720),v=a(96037),N=a(60267),b=a(92475),M=a(15764),z=a(27426),S=a(91603),A=a(61138);function C(e){let{onResize:t,direction:a,onResizeStart:s,onResizeEnd:o}=e,[n,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)({x:0,y:0});return(0,l.useEffect)(()=>{if(!n)return;let e=e=>{t(e.clientX-d.x,e.clientY-d.y)},a=()=>{i(!1),null==o||o()};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",a),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",a)}},[n,d,t]),(0,r.jsx)("div",{className:(0,p.cn)((()=>{switch(a){case"se":return"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize bg-primary/20 hover:bg-primary/40 rounded-tl-lg";case"e":return"absolute top-1/2 right-0 w-2 h-8 -translate-y-1/2 cursor-e-resize bg-primary/20 hover:bg-primary/40 rounded-l-lg";case"s":return"absolute bottom-0 left-1/2 w-8 h-2 -translate-x-1/2 cursor-s-resize bg-primary/20 hover:bg-primary/40 rounded-t-lg";default:return""}})(),"z-50 pointer-events-auto"),onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),i(!0),c({x:e.clientX,y:e.clientY}),null==s||s()}})}function k(e){let{card:t,isEditing:a,onRemove:o,onResize:n,onScale:i,gridSize:d=120,layoutMode:c="freeform"}=e,[h,u]=(0,l.useState)(!1),m=(0,l.useRef)(null),[x,y]=(0,l.useState)(null),{attributes:f,listeners:g,setNodeRef:w,transform:j,isDragging:v}=(0,z.PM)({id:t.id,disabled:!a||h}),N=t.layout.scale||1,M="freeform"===c?Math.max(1,Math.round(t.layout.w)):t.layout.w*d-8,S="freeform"===c?Math.max(1,Math.round(t.layout.h)):t.layout.h*d-8,A=(0,l.useRef)(null),k=(e,t)=>(0,l.isValidElement)(e)?(0,l.cloneElement)(e,{id:t,"data-theme-key":t}):e,E={transform:j?"translate3d(".concat(j.x,"px, ").concat(j.y,"px, 0)"):void 0,position:"absolute",left:"freeform"===c?t.layout.x:t.layout.x*d,top:"freeform"===c?t.layout.y:t.layout.y*d,width:h&&x?x.w:M,height:h&&x?x.h:S,minWidth:"freeform"===c?260:2*d-8,minHeight:"freeform"===c?180:2*d-8,zIndex:v?1e3:1,opacity:+!v,willChange:"transform",transition:v?"none":void 0,touchAction:"none"};(0,l.useEffect)(()=>{if(!A.current||h)return;let e=0,a=()=>{if(!A.current)return;let e=A.current.getBoundingClientRect();if("freeform"!==c){let a=Math.max(1,Math.round(e.width)),r=Math.max(1,Math.round(e.height)),l=Math.max(2,Math.ceil((a+8)/d)),s=Math.max(2,Math.ceil((r+8)/d));(l!==t.layout.w||s!==t.layout.h)&&n(t.id,l,s)}},r=new ResizeObserver(()=>{e=requestAnimationFrame(a)});return r.observe(A.current),a(),()=>{e&&cancelAnimationFrame(e),r.disconnect()}},[t.id,t.layout.w,t.layout.h,d,n,c,N,h]);let R=(e,t)=>{let a=m.current;if(a)if("freeform"===c)y({w:Math.max(260,Math.round(a.baseW+e)),h:Math.max(180,Math.round(a.baseH+t))});else{let r=a.baseW*d-8,l=a.baseH*d-8;y({w:Math.max(2*d-8,Math.round(r+e)),h:Math.max(2*d-8,Math.round(l+t))})}};return(0,r.jsxs)("div",{ref:w,style:E,className:(0,p.cn)("group rounded-lg border-2 border-transparent",a&&"hover:shadow-lg",v&&"border-primary/50"),children:[a&&(0,r.jsx)("div",{className:"absolute top-0 left-0 right-0 h-6 z-50 cursor-move pointer-events-auto",...f,...g}),a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"absolute -top-12 left-0 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10 bg-white rounded-lg shadow-lg p-1",children:[(0,r.jsx)(b.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:e=>{e.stopPropagation(),o(t.id)},children:(0,r.jsx)(s.A,{className:"w-4 h-4"})}),(0,r.jsxs)(b.$,{variant:"ghost",size:"sm",className:"h-8 px-2 text-xs",onClick:e=>{e.stopPropagation();let a=1===t.layout.w?2:2===t.layout.w?3:1,r=1===t.layout.h?2:2===t.layout.h?3:1;n(t.id,a,r)},children:[t.layout.w,"\xd7",t.layout.h]}),(0,r.jsxs)(b.$,{variant:"ghost",size:"sm",className:"h-8 px-2 text-xs",onClick:e=>{var a;e.stopPropagation(),a=.5===N?1:1===N?1.5:1.5===N?2:.5,i(t.id,Math.max(.5,Math.min(2,a)))},children:[Math.round(100*N),"%"]})]}),(0,r.jsx)(C,{direction:"se",onResize:R,onResizeStart:()=>{u(!0),m.current={baseW:"freeform"===c?M:t.layout.w,baseH:"freeform"===c?S:t.layout.h},y({w:"freeform"===c?M:t.layout.w*d-8,h:"freeform"===c?S:t.layout.h*d-8})},onResizeEnd:()=>{if(u(!1),m.current=null,x)if("freeform"===c)n(t.id,x.w,x.h);else{let e=Math.max(2,Math.round((x.w+8)/d)),a=Math.max(2,Math.round((x.h+8)/d));n(t.id,e,a)}y(null)}}),(0,r.jsx)(C,{direction:"e",onResize:e=>R(e,0),onResizeStart:()=>{u(!0),m.current={baseW:"freeform"===c?M:t.layout.w,baseH:"freeform"===c?S:t.layout.h},y({w:"freeform"===c?M:t.layout.w*d-8,h:"freeform"===c?S:t.layout.h*d-8})},onResizeEnd:()=>{if(u(!1),m.current=null,x)if("freeform"===c)n(t.id,x.w,S);else{let e=Math.max(2,Math.round((x.w+8)/d)),a=t.layout.h;n(t.id,e,a)}y(null)}}),(0,r.jsx)(C,{direction:"s",onResize:e=>R(0,e),onResizeStart:()=>{u(!0),m.current={baseW:"freeform"===c?M:t.layout.w,baseH:"freeform"===c?S:t.layout.h},y({w:"freeform"===c?M:t.layout.w*d-8,h:"freeform"===c?S:t.layout.h*d-8})},onResizeEnd:()=>{if(u(!1),m.current=null,x)if("freeform"===c)n(t.id,M,x.h);else{let e=t.layout.w,a=Math.max(2,Math.round((x.h+8)/d));n(t.id,e,a)}y(null)}})]}),"freeform"===c?(0,r.jsx)("div",{ref:A,className:"rounded-lg",style:{width:"100%",height:"100%",minWidth:260,minHeight:180},children:(0,r.jsx)("div",{style:{width:"100%",height:"100%",transform:"scale(".concat(N,")"),transformOrigin:"top left"},children:(0,r.jsx)("div",{className:"h-full w-full flex flex-col min-h-0",children:k(t.component,t.id)})})}):(0,r.jsx)("div",{ref:A,className:"rounded-lg",style:{width:"100%",height:"100%",minWidth:2*d-8,minHeight:2*d-8},children:(0,r.jsx)("div",{style:{width:"100%",height:"100%",transform:"scale(".concat(N,")"),transformOrigin:"top left"},children:(0,r.jsx)("div",{className:"h-full w-full flex flex-col min-h-0",children:k(t.component,t.id)})})})]})}function E(e){let{children:t,gridCols:a,gridRows:l,gridSize:s=120,layoutMode:o="freeform",containerWidth:n,containerHeight:i}=e,{setNodeRef:d}=(0,z.zM)({id:"grid-container"});return(0,r.jsx)("div",{ref:d,className:(0,p.cn)("relative bg-gray-50/30 rounded-xl","freeform"===o?"p-0":"p-4"),style:"freeform"===o?{width:n||0,height:i||0}:{width:a*s+32,height:l*s+32},children:t})}let R=[{id:"user-info",name:"用户信息",category:"基础",defaultSize:{w:2,h:2},component:(0,r.jsx)(v.AppCard,{className:"p-6 hover:shadow-lg transition-all duration-300 h-full",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,r.jsx)(o.A,{className:"w-5 h-5 text-primary"}),(0,r.jsx)("h4",{className:"text-lg font-bold",children:"用户信息"})]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"查看和编辑用户基本信息"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:"/generic-user-avatar.png",alt:"用户头像",className:"w-12 h-12 rounded-full object-cover border-2 border-primary/20"}),(0,r.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-background"})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"font-medium",children:"张三"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"zhang.san@example.com"}),(0,r.jsx)(M.E,{variant:"secondary",className:"mt-1 text-xs",children:"活跃用户"})]})]}),(0,r.jsxs)(b.$,{variant:"outline",className:"w-full hover:bg-primary hover:text-primary-foreground transition-colors mt-4 bg-transparent",children:[(0,r.jsx)(n.A,{className:"w-4 h-4 mr-2"}),"编辑资料"]})]})})},{id:"sales-data",name:"销售数据",category:"基础",defaultSize:{w:2,h:2},component:(0,r.jsx)(v.AppCard,{className:"p-6 hover:shadow-lg transition-all duration-300 h-full",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,r.jsx)(i.A,{className:"w-5 h-5 text-green-600"}),(0,r.jsx)("h4",{className:"text-lg font-bold",children:"今日销售"})]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"实时销售数据统计"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"text-3xl font-bold",children:"\xa512,345"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-green-600",children:[(0,r.jsx)(i.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"font-medium",children:"+15.2%"}),(0,r.jsx)("span",{className:"text-muted-foreground",children:"较昨日"})]}),(0,r.jsx)(M.E,{variant:"outline",className:"text-green-600 border-green-600/30",children:"增长中"})]}),(0,r.jsx)("div",{className:"w-full bg-muted rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-500",style:{width:"75%"}})})]})]})})},{id:"quick-actions",name:"快速操作",category:"基础",defaultSize:{w:2,h:2},component:(0,r.jsx)(v.AppCard,{className:"p-6 hover:shadow-lg transition-all duration-300 h-full",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,r.jsx)(d.A,{className:"w-5 h-5 text-primary"}),(0,r.jsx)("h4",{className:"text-lg font-bold",children:"快速操作"})]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"常用功能快捷入口"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)(b.$,{variant:"outline",size:"sm",className:"h-12 flex-col space-y-1 hover:bg-primary hover:text-primary-foreground transition-colors bg-transparent",children:[(0,r.jsx)(c.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-xs",children:"订单"})]}),(0,r.jsxs)(b.$,{variant:"outline",size:"sm",className:"h-12 flex-col space-y-1 hover:bg-red-500 hover:text-white transition-colors bg-transparent",children:[(0,r.jsx)(h.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-xs",children:"收藏"})]}),(0,r.jsxs)(b.$,{variant:"outline",size:"sm",className:"h-12 flex-col space-y-1 hover:bg-blue-500 hover:text-white transition-colors bg-transparent",children:[(0,r.jsx)(u.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-xs",children:"分享"})]}),(0,r.jsxs)(b.$,{variant:"outline",size:"sm",className:"h-12 flex-col space-y-1 hover:bg-yellow-500 hover:text-white transition-colors bg-transparent",children:[(0,r.jsx)(d.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-xs",children:"评价"})]})]})]})})}],$={"media-editor":{title:"媒体内容编辑",coverImage:"",actors:["演员A","演员B"],language:"中文",prompt:"萨达说的是v v呈现出萨达说的是大叔大叔是大叔东西啊是大叔萨达说大叔 萨达的爱上大是大叔"},"ecommerce-product":{id:"1",name:"iPhone 15 Pro",price:"\xa57,999",image:"/iphone-15-pro-hands.png",rating:4.8,inStock:!0},"news-article":{id:"1",title:"人工智能技术的最新发展趋势",summary:"探讨AI技术在各个领域的应用前景，以及对未来社会发展的深远影响。",author:"张三",publishTime:"2024-01-15",category:"科技",image:"/ai-technology.png",readTime:"5分钟",comments:23}};function P(e){let{category:t="workspace",locale:a="zh",className:o}=e,[n,i]=(0,l.useState)([]),[d,c]=(0,l.useState)("freeform"),[h,u]=(0,l.useState)(12),[v,C]=(0,l.useState)(10),[P,D]=(0,l.useState)(!1),[H,F]=(0,l.useState)("全部"),[I,W]=(0,l.useState)(!0),[O,J]=(0,l.useState)(null),_=(0,l.useRef)(null),L="pc-dynamic-cards-".concat(t,"-").concat(a);(0,l.useEffect)(()=>{if("grid"!==d||0===n.length)return;let e=n.reduce((e,t)=>Math.max(e,t.layout.y+t.layout.h),0);e>v&&C(e)},[n,v,d]);let B=(0,z.FR)((0,z.MS)(z.AN,{activationConstraint:{distance:2}}),(0,z.MS)(z.uN)),q=(e,t)=>e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.y+e.h>t.y,K=(e,t,a)=>{for(let r=0;r<=v-a;r++)for(let l=0;l<=h-t;l++){let s={x:l,y:r,w:t,h:a};if(!e.some(e=>q(s,e)))return{x:l,y:r}}return{x:0,y:0}},T=(()=>{let e=[];return e.push(...R),w.U.getAll().forEach(t=>{let a=$[t.name];e.push({id:t.name,name:t.displayName||t.name,category:t.category,defaultSize:{w:2,h:2},component:(0,r.jsx)(j._,{cardName:t.name,data:a,onAction:(e,t)=>console.log("Card action:",e,t)})})}),e})(),X="全部"===H?T:T.filter(e=>e.category===H),Y=["全部",...Array.from(new Set(T.map(e=>e.category)))];(0,l.useEffect)(()=>{if(!(n.length>0))try{let e=localStorage.getItem(L);if(e){let t=JSON.parse(e);if(t&&Array.isArray(t.cards)){let e=t.cards.map(e=>{let t=T.find(t=>t.id===e.type);return t?{id:e.id||"".concat(t.id,"-").concat(Date.now()),type:t.id,name:t.name,category:t.category,component:t.component,layout:e.layout||{x:0,y:0,w:2,h:2,scale:1}}:null}).filter(Boolean);e.length>0&&(t.themes&&Object.entries(t.themes).forEach(e=>{let[t,a]=e;try{localStorage.setItem(t,JSON.stringify(a))}catch(e){}}),i(e),W(!1))}}}catch(e){console.error("Failed to load saved cards:",e)}},[L,T.length]);let U=e=>{i(n.filter(t=>t.id!==e))},V=(e,t,a)=>{i(n.map(r=>{if(r.id!==e)return r;let l="freeform"===d?{w:Math.max(260,Math.round(t)),h:Math.max(180,Math.round(a))}:{w:Math.max(2,Math.round(t)),h:Math.max(2,Math.round(a))};return{...r,layout:{...r.layout,...l}}}))},G=(e,t)=>{i(n.map(a=>a.id===e?{...a,layout:{...a.layout,scale:t}}:a))},Q=n.find(e=>e.id===O),Z="freeform"===d?{width:n.reduce((e,t)=>Math.max(e,(t.layout.x||0)+Math.max(1,Math.round(t.layout.w||0))),0),height:n.reduce((e,t)=>Math.max(e,(t.layout.y||0)+Math.max(1,Math.round(t.layout.h||0))),0)}:{width:120*h,height:120*v};return(0,r.jsx)(S.J,{visible:I,children:(0,r.jsxs)("div",{className:(0,p.cn)("min-h-screen bg-background p-6",o),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"PC自定义工作台"})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[I&&n.length>0&&(0,r.jsxs)(b.$,{variant:"outline",onClick:()=>{i(n.map((e,t)=>({...e,layout:{x:t%h*2,y:2*Math.floor(t/h),w:2,h:2,scale:1}})))},children:[(0,r.jsx)(m.A,{className:"w-4 h-4 mr-2"}),"重置布局"]}),(0,r.jsx)(b.$,{variant:I?"default":"outline",onClick:()=>{I&&(()=>{try{let e={cards:n.map(e=>({id:e.id,type:e.type,layout:e.layout})),themes:n.reduce((e,t)=>{try{let a=t.id,r=localStorage.getItem(a);r&&(e[t.id]=JSON.parse(r))}catch(e){}return e},{}),updatedAt:Date.now()};localStorage.setItem(L,JSON.stringify(e))}catch(e){console.error("Failed to save layout:",e)}})(),W(!I)},children:I?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"保存布局"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.A,{className:"w-4 h-4 mr-2"}),"编辑布局"]})}),I&&(0,r.jsxs)(N.K,{onClick:()=>D(!0),className:"flex items-center gap-2",children:[(0,r.jsx)(f.A,{className:"w-4 h-4 mr-2"}),"添加卡片"]})]})]}),(0,r.jsx)("div",{className:"",children:0===n.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mb-4",children:(0,r.jsx)(g.A,{className:"w-8 h-8 text-muted-foreground"})}),(0,r.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"开始构建您的PC工作台"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-4",children:'点击右上角的"添加卡片"按钮来添加功能模块'}),I&&(0,r.jsxs)(N.K,{onClick:()=>D(!0),children:[(0,r.jsx)(f.A,{className:"w-4 h-4 mr-2",style:{display:"inline-block"}}),"添加第一个卡片"]})]}):(0,r.jsxs)(z.Mp,{sensors:B,collisionDetection:z.fp,onDragStart:e=>{let t=e.active.id;J(t);let a=n.find(e=>e.id===t);a?_.current={x:a.layout.x,y:a.layout.y}:_.current=null},onDragEnd:e=>{let{active:t,delta:a}=e;J(null);let r=t.id,l=_.current,s=n.find(e=>e.id===r);if(!s||!l||!a){_.current=null;return}if("freeform"===d){let e=Math.max(0,Math.round(l.x+a.x)),t=Math.max(0,Math.round(l.y+a.y)),o={x:e,y:t,w:Math.round(s.layout.w),h:Math.round(s.layout.h)},d=n.filter(e=>e.id!==r&&q(o,{x:e.layout.x,y:e.layout.y,w:Math.round(e.layout.w),h:Math.round(e.layout.h)}));if(0===d.length){i(a=>a.map(a=>a.id===r?{...a,layout:{...a.layout,x:e,y:t}}:a)),_.current=null;return}let c=n.filter(e=>e.id!==r).map(e=>({x:e.layout.x,y:e.layout.y,w:Math.round(e.layout.w),h:Math.round(e.layout.h),id:e.id})),h={x:e,y:t,w:Math.round(s.layout.w),h:Math.round(s.layout.h)},u=new Map;for(let e of d){let t=c.findIndex(t=>t.id===e.id);-1!==t&&c.splice(t,1);let a=e.layout.y,r=e.layout.x;for(;c.some(t=>q({x:r,y:a,w:Math.round(e.layout.w),h:Math.round(e.layout.h)},t))||q({x:r,y:a,w:Math.round(e.layout.w),h:Math.round(e.layout.h)},h);)a+=16;u.set(e.id,{x:r,y:a}),c.push({x:r,y:a,w:Math.round(e.layout.w),h:Math.round(e.layout.h),id:e.id})}i(a=>a.map(a=>{if(a.id===r)return{...a,layout:{...a.layout,x:e,y:t}};let l=u.get(a.id);return l?{...a,layout:{...a.layout,x:l.x,y:l.y}}:a})),_.current=null;return}let o=Math.max(0,Math.min(h-s.layout.w,l.x+Math.round(a.x/120))),c=Math.max(0,Math.min(v-s.layout.h,l.y+Math.round(a.y/120))),u={x:o,y:c,w:s.layout.w,h:s.layout.h},m=n.filter(e=>e.id!==r&&q(u,e.layout));if(0===m.length){i(e=>e.map(e=>e.id===r?{...e,layout:{...e.layout,x:o,y:c}}:e)),_.current=null;return}let x=n.filter(e=>e.id!==r).map(e=>({x:e.layout.x,y:e.layout.y,w:e.layout.w,h:e.layout.h,id:e.id})),y={x:o,y:c,w:s.layout.w,h:s.layout.h},f=new Map;for(let e of m){let t=x.findIndex(t=>t.id===e.id);-1!==t&&x.splice(t,1);let a=K([...x,y],e.layout.w,e.layout.h);f.set(e.id,{x:a.x,y:a.y}),x.push({x:a.x,y:a.y,w:e.layout.w,h:e.layout.h,id:e.id})}i(e=>e.map(e=>{if(e.id===r)return{...e,layout:{...e.layout,x:o,y:c}};let t=f.get(e.id);return t?{...e,layout:{...e.layout,x:t.x,y:t.y}}:e})),_.current=null},children:[(0,r.jsx)(E,{gridCols:h,gridRows:v,gridSize:120,layoutMode:d,containerWidth:Z.width,containerHeight:Z.height,children:n.map(e=>(0,r.jsx)(A.x,{value:e.id,children:(0,r.jsx)(k,{card:e,isEditing:I,onRemove:U,onResize:V,onScale:G,gridSize:120,layoutMode:d})},e.id))}),(0,r.jsx)(z.Hd,{dropAnimation:null,children:Q?(0,r.jsx)("div",{className:"shadow-2xl",children:(0,r.jsx)("div",{style:{width:"freeform"===d?Math.max(260,Math.round(Q.layout.w)):Math.max(232,120*Q.layout.w-8),height:"freeform"===d?Math.max(180,Math.round(Q.layout.h)):Math.max(232,120*Q.layout.h-8)},children:Q.component})}):null})]})}),P&&I&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>D(!1)}),(0,r.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-6 border-b border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold",children:"选择功能卡片"}),(0,r.jsx)(b.$,{variant:"ghost",size:"sm",onClick:()=>D(!1),children:(0,r.jsx)(s.A,{className:"w-5 h-5"})})]}),(0,r.jsx)("div",{className:"flex gap-2 mt-4 overflow-x-auto pb-2",children:Y.map(e=>(0,r.jsx)(b.$,{variant:H===e?"default":"outline",size:"sm",className:"whitespace-nowrap text-sm h-9",onClick:()=>F(e),children:e},e))})]}),(0,r.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-160px)]",children:(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:X.map(e=>{let t=n.some(t=>t.type===e.id);return(0,r.jsx)("div",{className:"cursor-pointer transition-all border rounded-xl p-4 ".concat(t?"bg-gray-50 border-gray-200 opacity-50":"hover:shadow-lg hover:scale-[1.02] border-gray-200 hover:border-primary/30"),onClick:()=>!t&&(e=>{let t=e.defaultSize||{w:2,h:2};if("freeform"===d){let a=Math.max(260,120*(t.w||2)-8),r=Math.max(180,120*(t.h||2)-8),l=n.reduce((e,t)=>Math.max(e,(t.layout.y||0)+Math.max(1,Math.round(t.layout.h||0))),0),s={id:"".concat(e.id,"-").concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e.id,name:e.name,category:e.category,component:e.component,layout:{x:0,y:l+16,w:a,h:r,scale:1}};i(e=>[...e,s]),D(!1);return}let a=((e,t)=>{for(let a=0;a<=v-t;a++)for(let r=0;r<=h-e;r++)if(!n.some(l=>!(r>=l.layout.x+l.layout.w||r+e<=l.layout.x||a>=l.layout.y+l.layout.h||a+t<=l.layout.y)))return{x:r,y:a};return{x:0,y:0}})(Math.max(2,t.w),Math.max(2,t.h)),r={id:"".concat(e.id,"-").concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e.id,name:e.name,category:e.category,component:e.component,layout:{x:a.x,y:a.y,w:Math.max(2,t.w),h:Math.max(2,t.h),scale:1}};i(e=>[...e,r]),D(!1)})(e),children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h5",{className:"font-semibold text-base mb-1",children:e.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mb-2",children:[e.category,"分类"]}),(0,r.jsx)(M.E,{variant:"outline",className:"text-xs",children:e.category})]}),t&&(0,r.jsx)(M.E,{variant:"secondary",className:"text-xs ml-2",children:"已添加"})]})},e.id)})})})]})]})]})})}}}]);