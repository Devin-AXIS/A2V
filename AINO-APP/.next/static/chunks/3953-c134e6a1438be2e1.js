"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3953],{68268:(e,t,s)=>{s.d(t,{BK:()=>d,eu:()=>c,q5:()=>u});var l=s(89835),r=s(55931),a=s(84969),o=s(7951),n=s(15496);let i=(0,o.F)("relative flex shrink-0 overflow-hidden rounded-full",{variants:{size:{sm:"h-8 w-8",default:"h-10 w-10",lg:"h-12 w-12",xl:"h-16 w-16"}},defaultVariants:{size:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,size:r,...o}=e;return(0,l.jsx)(a.Root,{ref:t,className:(0,n.cn)(i({size:r}),s),...o})});c.displayName=a.Root.displayName;let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.Image,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",s),...r})});d.displayName=a.Image.displayName;let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)(a.Fallback,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});u.displayName=a.Fallback.displayName},79514:(e,t,s)=>{s.d(t,{A:()=>i,AuthProvider:()=>n});var l=s(55931);let r=(0,l.createContext)(void 0),a={USER:"aino_user",AUTH_TOKEN:"aino_auth_token",APP_ID:"CURRENT_APP_ID"},o=[{id:"1",phone:"13800138000",name:"iPollo 用户",avatar:"/generic-user-avatar.png",points:2323,followers:22,following:334,posts:3434,createdAt:new Date().toISOString()},{id:"2",phone:"13900139000",name:"测试用户",avatar:"/generic-user-avatar.png",points:1500,followers:15,following:200,posts:100,createdAt:new Date().toISOString()}];function n(e){let{children:t}=e,[s,n]=(0,l.useState)({user:null,isAuthenticated:!1,isLoading:!0});(0,l.useEffect)(()=>{try{let e=localStorage.getItem(a.USER),t=localStorage.getItem(a.AUTH_TOKEN);if(e&&t){let t=JSON.parse(e);n({user:t,isAuthenticated:!0,isLoading:!1})}else n({user:null,isAuthenticated:!1,isLoading:!1})}catch(e){console.error("初始化认证状态失败:",e),n({user:null,isAuthenticated:!1,isLoading:!1})}},[]);let i=async e=>{try{let t;n(e=>({...e,isLoading:!0})),await new Promise(e=>setTimeout(e,1e3));let s={};Object.keys(e).forEach(t=>{t.indexOf("followers")>-1&&(s.followers=e[t]),t.indexOf("following")>-1&&(s.following=e[t]),t.indexOf("posts")>-1&&(s.posts=e[t]),t.indexOf("points")>-1&&(s.points=e[t])}),console.log(s),t={id:Date.now().toString(),phone:e.phone,name:e.profile.name,avatar:e.profile.avatar,points:s.points||0,followers:s.followers||0,following:s.following||0,posts:s.posts||0,createdAt:new Date().toISOString()},o.push(t);let l="mock_token_".concat(Date.now());{localStorage.setItem(a.USER,JSON.stringify(t)),localStorage.setItem(a.AUTH_TOKEN,l);let e=localStorage.getItem(a.APP_ID);e&&(localStorage.setItem("".concat(a.USER,":").concat(e),JSON.stringify(t)),localStorage.setItem("".concat(a.AUTH_TOKEN,":").concat(e),l))}return n({user:t,isAuthenticated:!0,isLoading:!1}),!0}catch(e){return console.error("登录失败:",e),n(e=>({...e,isLoading:!1})),!1}},c=async e=>{try{if(n(e=>({...e,isLoading:!0})),await new Promise(e=>setTimeout(e,1500)),o.find(t=>t.phone===e.phone))throw Error("该手机号已注册");let t={id:Date.now().toString(),phone:e.phone,name:"用户".concat(e.phone.slice(-4)),avatar:"/generic-user-avatar.png",points:100,followers:0,following:0,posts:0,createdAt:new Date().toISOString()};o.push(t);let s="mock_token_".concat(Date.now());{localStorage.setItem(a.USER,JSON.stringify(t)),localStorage.setItem(a.AUTH_TOKEN,s);let e=localStorage.getItem(a.APP_ID);e&&(localStorage.setItem("".concat(a.USER,":").concat(e),JSON.stringify(t)),localStorage.setItem("".concat(a.AUTH_TOKEN,":").concat(e),s))}return n({user:t,isAuthenticated:!0,isLoading:!1}),!0}catch(e){return console.error("注册失败:",e),n(e=>({...e,isLoading:!1})),!1}},d={...s,login:i,register:c,logout:()=>{localStorage.removeItem(a.USER),localStorage.removeItem(a.AUTH_TOKEN),n({user:null,isAuthenticated:!1,isLoading:!1})},updateUser:e=>{if(s.user){let t={...s.user,...e};n(e=>({...e,user:t})),localStorage.setItem(a.USER,JSON.stringify(t))}}};return l.createElement(r.Provider,{value:d},t)}function i(){let e=(0,l.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},83953:(e,t,s)=>{s.d(t,{I:()=>w});var l=s(89835),r=s(55931),a=s(15496),o=s(68268),n=s(92475),i=s(11012),c=s(42039),d=s(38474),u=s(98118),h=s(91591),m=s(24215),g=s(97909),f=s(91),x=s(79514),p=s(79588);function w(e){var t,s,w;let{className:N,size:v="md",showDropdown:j=!0,onClick:b}=e,{user:S,isAuthenticated:A,logout:y}=(0,x.A)(),I=(0,p.useRouter)(),[_,k]=(0,r.useState)(!1),E={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},O=()=>{I.push("/auth/login")},U=()=>{I.push("/auth/register")},T=async()=>{k(!0);try{y()}catch(e){console.error("退出登录失败:",e)}finally{k(!1)}},C=()=>{I.push("/profile")};return A?(0,l.jsx)("div",{className:(0,a.cn)("flex items-center",N),children:j?(0,l.jsxs)(i.rI,{children:[(0,l.jsx)(i.ty,{asChild:!0,children:(0,l.jsxs)("button",{onClick:b,className:(0,a.cn)("relative rounded-full transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500/50",E[v]),children:[(0,l.jsxs)(o.eu,{className:(0,a.cn)("border-2 border-white shadow-lg",E[v]),children:[(0,l.jsx)(o.BK,{src:null==S?void 0:S.avatar,alt:null==S?void 0:S.name}),(0,l.jsx)(o.q5,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white font-semibold",children:(null==S||null==(t=S.name)?void 0:t.charAt(0))||"U"})]}),(0,l.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"}),(null==S?void 0:S.points)&&S.points>1e3&&(0,l.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center",children:(0,l.jsx)(h.A,{className:"w-3 h-3 text-white"})})]})}),(0,l.jsxs)(i.SQ,{align:"end",className:"w-64",children:[(0,l.jsx)("div",{className:"px-3 py-2 border-b",children:(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsxs)(o.eu,{className:"w-10 h-10",children:[(0,l.jsx)(o.BK,{src:null==S?void 0:S.avatar,alt:null==S?void 0:S.name}),(0,l.jsx)(o.q5,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white",children:(null==S||null==(s=S.name)?void 0:s.charAt(0))||"U"})]}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-gray-900 truncate",children:null==S?void 0:S.name}),(0,l.jsx)("p",{className:"text-xs text-gray-500 truncate",children:null==S?void 0:S.phone}),(0,l.jsxs)("div",{className:"flex items-center space-x-1 mt-1",children:[(0,l.jsx)(m.A,{className:"w-3 h-3 text-yellow-500"}),(0,l.jsxs)("span",{className:"text-xs text-gray-600",children:[null==S?void 0:S.points," 积分"]})]})]})]})}),(0,l.jsxs)(i._2,{onClick:C,className:"cursor-pointer",children:[(0,l.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"个人中心"]}),(0,l.jsxs)(i._2,{onClick:()=>{I.push("/profile/settings")},className:"cursor-pointer",children:[(0,l.jsx)(g.A,{className:"w-4 h-4 mr-2"}),"设置"]}),(0,l.jsx)(i.mB,{}),(0,l.jsxs)(i._2,{onClick:T,className:"cursor-pointer text-red-600 focus:text-red-600",disabled:_,children:[(0,l.jsx)(f.A,{className:"w-4 h-4 mr-2"}),_?"退出中...":"退出登录"]})]})]}):(0,l.jsxs)("button",{onClick:b||C,className:(0,a.cn)("relative rounded-full transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500/50",E[v]),children:[(0,l.jsxs)(o.eu,{className:(0,a.cn)("border-2 border-white shadow-lg",E[v]),children:[(0,l.jsx)(o.BK,{src:null==S?void 0:S.avatar,alt:null==S?void 0:S.name}),(0,l.jsx)(o.q5,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white font-semibold",children:(null==S||null==(w=S.name)?void 0:w.charAt(0))||"U"})]}),(0,l.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"}),(null==S?void 0:S.points)&&S.points>1e3&&(0,l.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center",children:(0,l.jsx)(h.A,{className:"w-3 h-3 text-white"})})]})}):(0,l.jsx)("div",{className:(0,a.cn)("flex items-center space-x-2",N),children:j?(0,l.jsxs)(i.rI,{children:[(0,l.jsx)(i.ty,{asChild:!0,children:(0,l.jsxs)(n.$,{variant:"outline",size:"sm",className:"flex items-center space-x-2 bg-white/20 backdrop-blur-md border-white/30 hover:bg-white/30",children:[(0,l.jsx)(c.A,{className:"w-4 h-4"}),"登录"]})}),(0,l.jsxs)(i.SQ,{align:"end",className:"w-48",children:[(0,l.jsxs)(i._2,{onClick:O,className:"cursor-pointer",children:[(0,l.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"登录"]}),(0,l.jsxs)(i._2,{onClick:U,className:"cursor-pointer",children:[(0,l.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"注册"]})]})]}):(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsxs)(n.$,{variant:"outline",size:"sm",onClick:O,className:"bg-white/20 backdrop-blur-md border-white/30 hover:bg-white/30",children:[(0,l.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"登录"]}),(0,l.jsxs)(n.$,{variant:"default",size:"sm",onClick:U,className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700",children:[(0,l.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"注册"]})]})})}}}]);