"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8720],{78720:(e,t,s)=>{s.d(t,{I:()=>b});var a=s(89835),r=s(77455),l=s(55931),n=s(79588),o=s(15496);let d=(0,s(51894).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);var c=s(59445),i=s(32937),u=s(77908),m=s(55098),h=s(89407),x=s(92475),p=s(29088);function b(e){let{onRegister:t,onLogin:s,className:b}=e,g=(0,n.usePathname)(),[f,v]=(0,l.useState)(null);(0,l.useEffect)(()=>{try{let e=new URLSearchParams(window.location.search).get("authCfg");if(e){let t=JSON.parse(e);v(t);return}let t=window.localStorage.getItem("APP_AUTH_CONFIG");t&&v(JSON.parse(t))}catch(e){}},[]);let j=(null==f?void 0:f.titleColor)?{color:f.titleColor}:void 0,w=(null==f?void 0:f.bodyColor)?{color:f.bodyColor}:void 0,N=(0,l.useMemo)(()=>(null==g?void 0:g.startsWith("/en"))?"en":"zh",[g]),y=(0,l.useMemo)(()=>{let e=null==f?void 0:f.introTitle;return e?"string"==typeof e?e:e[N]||e.zh||e.en||null:null},[f,N]),k=(0,l.useMemo)(()=>{let e=null==f?void 0:f.introText;return e?"string"==typeof e?e:e[N]||e.zh||e.en||null:null},[f,N]),[C,P]=(0,l.useState)("phone"),[S,I]=(0,l.useState)("+86"),[z,A]=(0,l.useState)(()=>{try{return new URLSearchParams(window.location.search).get("phone")||""}catch(e){return""}}),[_,T]=(0,l.useState)(""),[D,$]=(0,l.useState)(""),[F,L]=(0,l.useState)(""),[E,U]=(0,l.useState)(!1),[O,M]=(0,l.useState)(!1),[R,J]=(0,l.useState)(!1),[B,G]=(0,l.useState)(!1),[H,V]=(0,l.useState)({}),W=()=>{"phone"===C&&(()=>{let e={};return z||(e.phone="请输入手机号"),_||(e.code="请输入验证码"),V(e),0===Object.keys(e).length})()?P("verify"):"verify"===C?P("password"):"password"===C&&(()=>{let e={};return D?D.length<6&&(e.password="密码至少6位"):e.password="请输入密码",F?D!==F&&(e.confirmPassword="两次密码不一致"):e.confirmPassword="请确认密码",R||(e.agreeTerms="请同意用户协议和隐私政策"),V(e),0===Object.keys(e).length})()&&X()},X=async()=>{var e,s,a,l,n;G(!0);try{await new Promise(e=>setTimeout(e,1e3));let s=window.localStorage.getItem("APP_ID"),a=new URLSearchParams(window.location.search).get("appId"),l=s||p.env.NEXT_PUBLIC_DEFAULT_APP_ID||a||"";if(!l)return void alert("缺少应用ID，请通过预览链接附带 appId 或先写入 localStorage.APP_ID");let n=null==(e=(await r.A.post("http://47.94.52.142:3007/api/application-users/register?applicationId=".concat(l),{password:D,phone_number:z})).data)?void 0:e.data;null==t||t({phone:n.phone,countryCode:S,code:n.userId,password:D,confirmPassword:F,agreeTerms:R}),P("success")}catch(r){let e=(null==r||null==(a=r.response)||null==(s=a.data)?void 0:s.error)||(null==r||null==(n=r.response)||null==(l=n.data)?void 0:l.message),t="string"==typeof e?e:"";console.error("注册失败:",t||r),t.includes("用户已注册")||t.includes("手机号已存在")?alert("该手机号已注册，请直接登录"):t.includes("缺少应用ID")?alert("缺少应用ID，请通过预览链接附带 appId 或先写入 localStorage.APP_ID"):t?alert(t):alert("注册失败，请稍后再试")}finally{G(!1)}};return(0,a.jsx)("div",{className:"min-h-screen pb-24",children:(0,a.jsx)("div",{className:"pt-12",children:(0,a.jsx)("div",{className:"container mx-auto px-4",children:(0,a.jsxs)("div",{className:"max-w-sm mx-auto",children:["phone"===C&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",style:j,children:y||("en"===N?"Sign up":"注册账号")}),(0,a.jsx)("p",{className:"text-muted-foreground",style:w,children:k||("en"===N?"Enter your phone number":"请输入您的手机号码")})]}),(0,a.jsxs)("div",{className:"mb-6 flex items-stretch gap-3 w-full",children:[(0,a.jsx)(m.d,{value:S,onChange:I,className:"shrink-0 w-28 sm:w-32"}),(0,a.jsx)(m.L,{value:z,onChange:e=>{A(e),H.phone&&V(e=>({...e,phone:void 0}))},error:H.phone,placeholder:"请输入手机号",className:"flex-1 min-w-0"})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(x.$,{type:"button",variant:"secondary",className:"w-full rounded-full h-11",disabled:!z,onClick:()=>P("verify"),children:"发送验证码"})}),(0,a.jsx)(x.$,{type:"button",onClick:W,size:"lg",className:"w-full rounded-full h-12 text-base",variant:"default",children:"下一步"})]}),"verify"===C&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",style:j,children:"输入验证码"}),(0,a.jsxs)("p",{className:"text-muted-foreground text-sm",style:w,children:["已发送至 ",S,z]})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(h.P,{value:_,onChange:e=>{T(e),H.code&&V(e=>({...e,code:void 0}))},error:H.code,onComplete:e=>T(e),size:"sm"})}),(0,a.jsx)("div",{className:"text-center mb-6",children:(0,a.jsx)(x.$,{type:"button",variant:"link",className:"text-sm",onClick:()=>P("phone"),children:"修改手机号"})}),(0,a.jsx)(x.$,{type:"button",onClick:W,size:"lg",className:"w-full rounded-full h-12 text-base",variant:"default",children:"继续"})]}),"password"===C&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",style:j,children:"设置密码"}),(0,a.jsx)("p",{className:"text-muted-foreground",style:w,children:"请设置您的登录密码"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 z-10",children:(0,a.jsx)(d,{className:"w-5 h-5 text-gray-400"})}),(0,a.jsx)("input",{type:E?"text":"password",value:D,onChange:e=>{$(e.target.value),H.password&&V(e=>({...e,password:void 0}))},placeholder:"请设置密码（至少6位）",className:(0,o.cn)("w-full pl-12 pr-12 py-4","bg-background border border-border","rounded-lg","text-foreground placeholder-muted-foreground","text-base font-medium","outline-none transition-all duration-300","focus:border-primary focus:bg-accent",H.password&&"border-red-300")}),(0,a.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>U(!E),className:"absolute right-4 top-1/2 transform -translate-y-1/2 z-10 h-auto w-auto p-1",children:E?(0,a.jsx)(c.A,{className:"w-5 h-5 text-muted-foreground"}):(0,a.jsx)(i.A,{className:"w-5 h-5 text-muted-foreground"})})]}),H.password&&(0,a.jsx)("div",{className:"mt-2 text-sm text-red-600",children:H.password})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 z-10",children:(0,a.jsx)(d,{className:"w-5 h-5 text-gray-400"})}),(0,a.jsx)("input",{type:O?"text":"password",value:F,onChange:e=>{L(e.target.value),H.confirmPassword&&V(e=>({...e,confirmPassword:void 0}))},placeholder:"请再次输入密码",className:(0,o.cn)("w-full pl-12 pr-12 py-4","bg-background border border-border","rounded-lg","text-foreground placeholder-muted-foreground","text-base font-medium","outline-none transition-all duration-300","focus:border-primary focus:bg-accent",H.confirmPassword&&"border-red-300")}),(0,a.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>M(!O),className:"absolute right-4 top-1/2 transform -translate-y-1/2 z-10 h-auto w-auto p-1",children:O?(0,a.jsx)(c.A,{className:"w-5 h-5 text-muted-foreground"}):(0,a.jsx)(i.A,{className:"w-5 h-5 text-muted-foreground"})})]}),H.confirmPassword&&(0,a.jsx)("div",{className:"mt-2 text-sm text-red-600",children:H.confirmPassword})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("label",{className:"flex items-start space-x-3 cursor-pointer",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"checkbox",checked:R,onChange:e=>J(e.target.checked),className:"sr-only"}),(0,a.jsx)("div",{className:(0,o.cn)("w-5 h-5 rounded border-2 flex items-center justify-center","transition-all duration-200",R?"bg-blue-500 border-blue-500":"border-gray-300 hover:border-gray-400"),children:R&&(0,a.jsx)(u.A,{className:"w-3 h-3 text-white"})})]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600 leading-relaxed",children:["我已阅读并同意",(0,a.jsx)("button",{type:"button",className:"text-blue-600 hover:text-blue-800 mx-1",children:"《用户协议》"}),"和",(0,a.jsx)("button",{type:"button",className:"text-blue-600 hover:text-blue-800 mx-1",children:"《隐私政策》"})]})]}),H.agreeTerms&&(0,a.jsx)("div",{className:"mt-2 text-sm text-red-600",children:H.agreeTerms})]}),(0,a.jsx)(x.$,{type:"button",onClick:W,disabled:B,size:"lg",className:"w-full rounded-full h-12 text-base",variant:"default",children:B?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"注册中..."]}):"完成注册"})]}),"success"===C&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(u.A,{className:"w-10 h-10 text-green-600"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"注册成功！"}),(0,a.jsx)("p",{className:"text-gray-600 mb-8",children:"欢迎加入我们，现在可以开始使用了"}),(0,a.jsx)(x.$,{type:"button",onClick:s,size:"lg",className:"w-full",children:"立即登录"})]})})]})})})})}}}]);