(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3340],{6768:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var l=a(89835),r=a(55931),s=a(79588),n=a(33378),i=a(92475),o=a(17409),c=a(65794),u=a(6195),d=a(12680);function m(){let e=(0,s.useParams)();(0,s.useSearchParams)();let t=(0,s.useRouter)(),a=new URLSearchParams(window.location.search),m=a.get("appId");window.localStorage.setItem("APP_ID",m||"");let f=a.get("origin")||a.get("parentOrigin")||"*",g=a.get("data");if(g)try{let e=JSON.parse(g);window.localStorage.setItem("PREVIEW_SELECTED_DATA",JSON.stringify(e))}catch(e){window.localStorage.setItem("PREVIEW_SELECTED_DATA_RAW",g)}let[p,h]=(0,r.useState)(!0),[y,v]=(0,r.useState)(null),[S,E]=(0,r.useState)(null),_=(0,r.useMemo)(()=>(0,u.CV)({targetOrigin:f,channel:m||void 0}),[f,m]),w=e.locale||"zh",N=e.id;(0,r.useEffect)(()=>{(0,c.a)()},[]),(0,r.useEffect)(()=>{let e=(0,u.zU)(_);return _.post("aino:ready",{appId:m,id:N,locale:w}),()=>{"function"==typeof e&&e()}},[_,m,N,w]),(0,r.useEffect)(()=>{let e=!1;return async function(){h(!0),v(null);try{let l=await d.L.get("/api/preview-manifests/".concat(N));if(!(null==l?void 0:l.success))throw Error((null==l?void 0:l.message)||"failed");if(!e){var t,a;let e=(null==(t=l.data)?void 0:t.manifest)||{};try{(null==e||null==(a=e.app)?void 0:a.appKey)&&localStorage.setItem("CURRENT_APP_ID",String(e.app.appKey))}catch(e){}E(e);try{_.post("aino:manifest",{manifest:e})}catch(e){}}}catch(t){e||v((null==t?void 0:t.message)||"error")}finally{e||h(!1)}}(),()=>{e=!0}},[N]),(0,r.useEffect)(()=>{if(y)try{_.post("aino:error",{message:y})}catch(e){}},[y,_]);let[A,I]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(S)try{var e,t,a,l,r;let s=(null==S||null==(t=S.pages)||null==(e=t.home)?void 0:e.category)||"workspace",n="dynamic_page_layout_".concat(s,"_").concat(w),i=localStorage.getItem(n);if(i)try{let e=JSON.parse(i),t=Array.isArray(null==e?void 0:e.cards)?e.cards.length:0;if(t>0){let a=e.cards.filter(e=>"mobile-navigation"!==((null==e?void 0:e.type)||e));if(a.length!==t){let t={...e,cards:a,updatedAt:Date.now()};localStorage.setItem(n,JSON.stringify(t)),I(e=>e+1)}}}catch(e){}else{let e={cards:((null==S||null==(l=S.pages)||null==(a=l.home)?void 0:a.cardsDefault)&&S.pages.home.cardsDefault.length>0?S.pages.home.cardsDefault:[]).map(e=>({type:e})),themes:{},updatedAt:Date.now()};localStorage.setItem(n,JSON.stringify(e)),I(e=>e+1)}try{let e=(null==S||null==(r=S.app)?void 0:r.bottomNav)||[],t=Array.isArray(e)?e.map(e=>{let t=e.route||"/";return"/me"===t&&(t="/profile"),{href:t,label:e.label||e.key,iconName:e.icon}}):[];localStorage.setItem("CURRENT_APP_NAV_ITEMS",JSON.stringify(t))}catch(e){}}catch(e){}},[S,w]);let x=(0,r.useMemo)(()=>{var e,t;let a=(null==S||null==(t=S.pages)||null==(e=t.home)?void 0:e.category)||"workspace";return"string"==typeof a?a:"workspace"},[S]);return p?(0,l.jsx)("main",{className:"min-h-[100dvh] flex items-center justify-center text-muted-foreground",children:"Loading..."}):y?(0,l.jsxs)("main",{className:"min-h-[100dvh] flex flex-col items-center justify-center gap-3",children:[(0,l.jsx)("div",{className:"text-sm text-red-600",children:y}),(0,l.jsx)(i.$,{variant:"outline",onClick:()=>t.refresh(),children:"Retry"})]}):(0,l.jsxs)("main",{className:"min-h-[100dvh] bg-transparent",children:[(0,l.jsx)(n.M3,{category:x,locale:w,layout:"mobile"},A),(0,l.jsx)(o.BottomNavigation,{})]})}},18358:(e,t,a)=>{Promise.resolve().then(a.bind(a,6768))}},e=>{e.O(0,[6416,8290,5022,6497,7455,69,7938,1390,5897,3546,3031,6037,413,7746,7324,721,3378,9900,7341,7358],()=>e(e.s=18358)),_N_E=e.O()}]);