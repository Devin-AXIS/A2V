(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9318],{11614:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var l=a(89835),r=a(55931),o=a(79588),n=a(33378),s=a(34745),i=a(92475),c=a(17409),u=a(65794),d=a(6195),f=a(12680);function m(){let e=(0,o.useParams)(),t=(0,o.useSearchParams)(),a=(0,o.useRouter)(),[m,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!m){try{let l=window.localStorage.getItem("QUERY_STRING");if(!l)return void g(!0);let r=l.startsWith("?")?l.slice(1):l,o=new URLSearchParams(r);if(0==[...o.keys()].length)return void g(!0);let n=new URLSearchParams(t.toString()),s=!1;if(o.forEach((e,t)=>{n.get(t)!==e&&(n.set(t,e),s=!0)}),s){let t=e.locale||"zh";n.toString();let r="/".concat(t,"/preview").concat(l);a.replace(r)}}catch(e){}g(!0)}},[t,e,a,m]);let p=(0,r.useMemo)(()=>new URLSearchParams(window.location.search),[]),h=p.get("appId"),y=p.get("origin")||p.get("parentOrigin")||"*",v=p.get("data");(0,r.useEffect)(()=>{if(window.localStorage.setItem("APP_ID",h||""),v)try{let e=JSON.parse(v);window.localStorage.setItem("PREVIEW_SELECTED_DATA",JSON.stringify(e))}catch(e){window.localStorage.setItem("PREVIEW_SELECTED_DATA_RAW",v)}},[h,v]);let[S,w]=(0,r.useState)(!0),[E,N]=(0,r.useState)(null),[I,_]=(0,r.useState)(null),x=(0,r.useMemo)(()=>(0,d.CV)({targetOrigin:y,channel:h||void 0}),[y,h]),P=p.get("device")||"mobile",b=e.locale||"zh",j=p.get("previewId"),A=p.get("cfgId");(0,r.useEffect)(()=>{(0,u.a)()},[]),(0,r.useEffect)(()=>{let e=(0,d.zU)(x);return x.post("aino:ready",{appId:h,id:j,locale:b}),()=>{"function"==typeof e&&e()}},[x,h,j,b]),(0,r.useEffect)(()=>{let e=!1;return async function(){w(!0),N(null);try{var t,a;let l={};if(A){let e=await f.L.get("/api/page-configs/".concat(encodeURIComponent(A)));if(!(null==e?void 0:e.success))throw Error((null==e?void 0:e.message)||"failed to load page config");let t=e.data||e;l={app:{appKey:h||"default",defaultLanguage:b,locale:b,theme:"default",bottomNav:[{key:"home",label:"zh"===b?"首页":"Home",route:"/preview"},{key:"me",label:"zh"===b?"我的":"Me",route:"/profile"}]},pages:{home:{category:"workspace",...t}}}}else if(j){let e=await f.L.get("/api/preview-manifests/".concat(j));if(!(null==e?void 0:e.success))throw Error((null==e?void 0:e.message)||"failed");l=(null==(t=e.data)?void 0:t.manifest)||{}}else throw Error("No previewId or cfgId provided");if(!e){try{(null==l||null==(a=l.app)?void 0:a.appKey)&&localStorage.setItem("CURRENT_APP_ID",String(l.app.appKey))}catch(e){}_(l);try{x.post("aino:manifest",{manifest:l})}catch(e){}}}catch(t){e||N((null==t?void 0:t.message)||"error")}finally{e||w(!1)}}(),()=>{e=!0}},[j,A,h,b]),(0,r.useEffect)(()=>{if(E)try{x.post("aino:error",{message:E})}catch(e){}},[E,x]);let[R,k]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(I)try{var e,t,a,l,r;let o=(null==I||null==(t=I.pages)||null==(e=t.home)?void 0:e.category)||"workspace",n="dynamic_page_layout_".concat(o,"_").concat(b),s=localStorage.getItem(n);if(s)try{let e=JSON.parse(s),t=Array.isArray(null==e?void 0:e.cards)?e.cards.length:0;if(t>0){let a=e.cards.filter(e=>"mobile-navigation"!==((null==e?void 0:e.type)||e));if(a.length!==t){let t={...e,cards:a,updatedAt:Date.now()};localStorage.setItem(n,JSON.stringify(t)),k(e=>e+1)}}}catch(e){}else{let e={cards:((null==I||null==(l=I.pages)||null==(a=l.home)?void 0:a.cardsDefault)&&I.pages.home.cardsDefault.length>0?I.pages.home.cardsDefault:[]).map(e=>({type:e})),themes:{},updatedAt:Date.now()};localStorage.setItem(n,JSON.stringify(e)),k(e=>e+1)}try{let e=(null==I||null==(r=I.app)?void 0:r.bottomNav)||[],t=Array.isArray(e)?e.map(e=>{let t=e.route||"/";return"/me"===t&&(t="/profile"),{href:t,label:e.label||e.key,iconName:e.icon}}):[];localStorage.setItem("CURRENT_APP_NAV_ITEMS",JSON.stringify(t))}catch(e){}}catch(e){}},[I,b]);let D=(0,r.useMemo)(()=>{var e,t;let a=(null==I||null==(t=I.pages)||null==(e=t.home)?void 0:e.category)||"workspace";return"string"==typeof a?a:"workspace"},[I]);return S?(0,l.jsx)("main",{className:"min-h-[100dvh] flex items-center justify-center text-muted-foreground",children:"Loading..."}):E?(0,l.jsxs)("main",{className:"min-h-[100dvh] flex flex-col items-center justify-center gap-3",children:[(0,l.jsx)("div",{className:"text-sm text-red-600",children:E}),(0,l.jsx)(i.$,{variant:"outline",onClick:()=>a.refresh(),children:"Retry"})]}):"pc"===P?(0,l.jsx)("main",{className:"min-h-screen bg-transparent",children:(0,l.jsx)(s.PCDynamicPageComponent,{category:D,locale:b,layout:"pc"},R)}):(0,l.jsxs)("main",{className:"min-h-[100dvh] bg-transparent",children:[(0,l.jsx)(n.M3,{category:D,locale:b,layout:"mobile"},R),(0,l.jsx)(c.BottomNavigation,{})]})}function g(){return(0,l.jsx)(r.Suspense,{fallback:(0,l.jsx)("main",{className:"min-h-[100dvh] flex items-center justify-center text-muted-foreground",children:"Loading..."}),children:(0,l.jsx)(m,{})})}},30132:(e,t,a)=>{Promise.resolve().then(a.bind(a,11614))}},e=>{e.O(0,[6416,8290,5022,6497,7455,69,7938,1390,5897,3546,3031,6037,413,7746,7324,721,3378,6889,4745,9900,7341,7358],()=>e(e.s=30132)),_N_E=e.O()}]);