(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[612],{13391:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(51894).A)("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]])},17409:(e,t,r)=>{"use strict";r.d(t,{BottomNavigation:()=>b});var l=r(89835),a=r(79588),n=r(35749),i=r(13391),o=r(92126),c=r(79644),s=r(42039),u=r(77796),d=r(97909),h=r(59213),p=r(8892),f=r(70368),m=r(92475),g=r(96037),v=r(41657),y=r(55931);function b(e){let{dict:t,items:r}=e,b=(0,a.usePathname)(),{theme:x}=(0,v.b)(),A=b.split("/")[1],w=b.endsWith("/chat"),S=(0,y.useMemo)(()=>!function(e){if(!e.startsWith("#"))return!1;let t=Number.parseInt(e.substring(1),16);return .2126*(t>>16&255)+.7152*(t>>8&255)+.0722*((0|t)&255)<128}(x.background)?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.1)",[x.background]);if(w)return null;let N=t||{browseComponents:"组件",dashboard:"仪表板",chat:"AI",search:"搜索",profile:"我的"},I=[{href:"/",label:N.browseComponents,icon:n.A},{href:"/dashboard",label:N.dashboard,icon:i.A},{href:"/chat",label:N.chat,icon:o.A},{href:"/search",label:N.search,icon:c.A},{href:"/profile",label:N.profile,icon:s.A}],j=b.includes("/preview/")||b.includes("/app/"),k=[];if(r&&r.length>0)k=r;else try{{let e=localStorage.getItem("APPLICATION_CONFIG");if(e){var P,C,E;let t=JSON.parse(e),r=Array.isArray(null==t||null==(E=t.config)||null==(C=E.clientManifest)||null==(P=C.app)?void 0:P.bottomNav)?t.config.clientManifest.app.bottomNav:[];r.length>0&&(k=r.filter(e=>(null==e?void 0:e.visible)!==!1).map(e=>{var t,r,l;return{href:e.route||"/",label:(null==(t=e.label)?void 0:t[A])||(null==(r=e.label)?void 0:r.zh)||(null==(l=e.label)?void 0:l.en)||e.id||"",iconName:e.icon||"grid"}}))}if(0===k.length){let e=localStorage.getItem("CURRENT_APP_NAV_ITEMS");if(e){let t=JSON.parse(e);Array.isArray(t)&&t.length>0&&(k=t.filter(e=>e&&!1!==e.visible).map(e=>{let t=e.route||e.href||"/";return"/me"===t&&(t="/profile"),{href:t,label:e.label||e.key||"",iconName:e.icon||e.iconName}}))}}}}catch(e){}if(0!==k.length||j||(k=I),0===k.length)return null;let _={home:u.A,user:s.A,profile:s.A,search:c.A,dashboard:i.A,grid:n.A,menu:n.A,chat:o.A,message:o.A,settings:d.A,bell:h.A,star:p.A,heart:f.A},M=localStorage.getItem("QUERY_STRING");return(0,l.jsx)("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-40",children:(0,l.jsx)(g.AppCard,{className:"px-4 py-1",children:(0,l.jsx)("div",{className:"flex items-center space-x-2 md:space-x-3",children:k.map((e,t)=>{var r;let{href:a,icon:i,iconName:o,label:c}=e,s="/".concat(A).concat("/"===a?"":a);if("/preview"===a){let e=new URLSearchParams(window.location.search),t=e.get("cfgId"),r=e.get("previewId"),l=e.get("appId"),a=window.localStorage.getItem("MAIN_PATH");s=t?"/".concat(A,"/preview?cfgId=").concat(t,"&device=mobile&isEdite=true"):r&&l?"/".concat(A,"/preview?previewId=").concat(r,"&device=mobile&appId=").concat(l):a||"/".concat(A)}else s+=M||"";let u=b===s||"/"===a&&b==="/".concat(A),d=null!=(r=null!=i?i:o?_[o]:void 0)?r:n.A;return(0,l.jsxs)(m.$,{onClick:()=>{window.location.href=s},variant:"ghost",className:"rounded-2xl w-12 h-12 flex flex-col items-center justify-center transition-all duration-300 group",style:{backgroundColor:u?S:"transparent"},children:[(0,l.jsx)(d,{className:"w-6 h-6 transition-colors",style:{color:x.fontColor,opacity:u?1:.7}}),(0,l.jsx)("span",{className:"sr-only",children:c})]})})})})})}},35749:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(51894).A)("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]])},67158:(e,t,r)=>{Promise.resolve().then(r.bind(r,80458))},70368:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(51894).A)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]])},80458:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var l=r(89835),a=r(55931),n=r(79588),i=r(33378),o=r(17409),c=r(12680);async function s(e,t,r){let l=function(e,t){if(null==e?void 0:e.dataSources)return e.dataSources[t]}(e,t);if(!(null==l?void 0:l.url))throw Error("DataSource not found: ".concat(t));let a=function(e){try{var t;let r=null==e||null==(t=e.app)?void 0:t.appKey;if(r)return String(r);{let e=localStorage.getItem("CURRENT_APP_ID");if(e)return String(e)}}catch(e){}return null}(e),n=(l.method||"GET").toUpperCase(),i=(null==r?void 0:r.baseUrl)||"http://localhost:3007",o=(f=l.url,(m=null==r?void 0:r.params)?f.replace(/\{(\w+)\}/g,(e,t)=>{let r=m[t];return null==r?"":encodeURIComponent(String(r))}):f),s=o.startsWith("http")?o:"".concat(i).concat(o),u={"Content-Type":"application/json"};a&&(u["x-application-id"]=a);let d=new URL(s);if(a&&!d.searchParams.has("applicationId")&&d.searchParams.set("applicationId",a),"appUser"===l.auth){let e=function(){try{{let e=localStorage.getItem("APP_USER_TOKEN");if(e)return String(e)}}catch(e){}return null}();e&&(u.Authorization="Bearer ".concat(e))}let h=await c.L.request({url:d.toString(),method:n,headers:u});if(!h.success)throw Error(h&&(h.message||h.error)||"Request failed: ".concat(h.code));var p,f,m,g=h&&(null!=(p=h.data)?p:h),v=null==r?void 0:r.selectPath;if(!v)return g;let y=v.startsWith("$.")?v.slice(2):v.startsWith("$")?v.slice(1):v;return y?y.split(".").reduce((e,t)=>e&&t in e?e[t]:void 0,g):g}async function u(e,t,r){let l={};if(!e||!t||!t.data||"object"!=typeof t.data)return l;for(let[a,n]of Object.entries(t.data))try{let t=null==n?void 0:n.source,i=null==n?void 0:n.params,o=null==n?void 0:n.select;if(!t)continue;l[a]=await s(e,t,{params:i,selectPath:o,baseUrl:r})}catch(e){l[a]={__error:(null==e?void 0:e.message)||"fetch error"}}return l}let d=(0,a.createContext)({data:{},loading:!1});function h(e){let{manifest:t,pageKey:r,children:n,baseUrl:i}=e,o=(0,a.useMemo)(()=>r&&(null==t?void 0:t.pages)?t.pages[r]:void 0,[t,r]),[c,s]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[f,m]=(0,a.useState)({});(0,a.useEffect)(()=>{let e=!1;return async function(){if(t&&o){s(!0),p(null);try{let r=await u(t,o,i);e||m(r)}catch(t){e||p((null==t?void 0:t.message)||"load error")}finally{e||s(!1)}}}(),()=>{e=!0}},[t,o,i]);let g=(0,a.useMemo)(()=>({manifest:t,pageKey:r,pageConfig:o,data:f,loading:c,error:h}),[t,r,o,f,c,h]);return(0,l.jsx)(d.Provider,{value:g,children:n})}let p=(0,a.createContext)({});function f(e){let{appKey:t,locale:r,device:n="mobile",children:i}=e,[o,c]=(0,a.useState)(n),s=(0,a.useMemo)(()=>({appKey:t,locale:r,device:o,setDevice:c}),[t,r,o]);return(0,l.jsx)(p.Provider,{value:s,children:i})}var m=r(65794);function g(){let e=(0,n.useParams)(),t=(0,n.useSearchParams)(),[r,s]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),[p,g]=(0,a.useState)(null),v=e.locale||"zh",y=e.appKey;(0,a.useEffect)(()=>{try{(0,m.a)()}catch(e){}},[]),(0,a.useEffect)(()=>{let e=!1;async function t(){d(!0),g(null);try{var t;let r=await c.L.get("/api/apps/".concat(encodeURIComponent(String(y)),"/manifest?state=published"));if(!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"failed");e||s((null==(t=r.data)?void 0:t.manifest)||r.data)}catch(t){e||g((null==t?void 0:t.message)||"error")}finally{e||d(!1)}}return y&&t(),()=>{e=!0}},[y]);let b=(0,a.useMemo)(()=>{var e,l;let a=t.get("route")||"",n=("/me"===a?"/profile":a)||(null==r||null==(l=r.pages)||null==(e=l.home)?void 0:e.route)||"/home";try{let e=r&&r.pages?r.pages:{},t=Object.entries(e).find(e=>{let[,t]=e;return((null==t?void 0:t.route)||"")===n});if(t&&t[0])return t[0];return(n||"").replace(/^\//,"")||"home"}catch(e){return"home"}},[r,t]);(0,a.useEffect)(()=>{try{var e,l;let a=t.get("route")||"",n=("/me"===a?"/profile":a)||(null==r||null==(l=r.pages)||null==(e=l.home)?void 0:e.route)||"/home",i=r&&r.pages?r.pages:{},o=Object.entries(i).find(e=>{let[,t]=e;return((null==t?void 0:t.route)||"")===n}),c=(n||"").replace(/^\//,"")||"home";if(!(o||c)){let e=new URL(window.location.href);e.searchParams.set("route","/home"),window.history.replaceState(null,"",e.toString())}}catch(e){}},[r,t]);let x=(0,a.useMemo)(()=>{try{let e=(null==r?void 0:r.pages)&&b?r.pages[b]:void 0,t=(null==e?void 0:e.category)||"workspace";return"string"==typeof t?t:"workspace"}catch(e){return"workspace"}},[r,b]);return u?(0,l.jsx)("main",{className:"min-h-[100dvh] flex items-center justify-center text-muted-foreground",children:"Loading..."}):p?(0,l.jsx)("main",{className:"min-h-[100dvh] flex items-center justify-center text-red-600 text-sm",children:p}):(0,l.jsx)("main",{className:"min-h-[100dvh] bg-transparent",children:(0,l.jsxs)(f,{appKey:String(y),locale:String(v),device:"mobile",children:[(0,l.jsx)(h,{manifest:r,pageKey:b,baseUrl:"http://localhost:3007",children:(0,l.jsx)(i.M3,{category:x,locale:v,layout:"mobile",pageKey:b})}),(0,l.jsx)(o.BottomNavigation,{})]})})}},92126:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(51894).A)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])}},e=>{e.O(0,[6416,8290,5022,6497,5123,69,7938,1390,7455,4755,3031,6037,7414,7746,721,3378,9900,7341,7358],()=>e(e.s=67158)),_N_E=e.O()}]);