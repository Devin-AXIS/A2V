(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[612],{67158:(e,t,r)=>{Promise.resolve().then(r.bind(r,80458))},80458:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var a=r(89835),l=r(55931),n=r(79588),o=r(33378),i=r(17409),s=r(12680);async function u(e,t,r){let a=function(e,t){if(null==e?void 0:e.dataSources)return e.dataSources[t]}(e,t);if(!(null==a?void 0:a.url))throw Error("DataSource not found: ".concat(t));let l=function(e){try{var t;let r=null==e||null==(t=e.app)?void 0:t.appKey;if(r)return String(r);{let e=localStorage.getItem("CURRENT_APP_ID");if(e)return String(e)}}catch(e){}return null}(e),n=(a.method||"GET").toUpperCase(),o=(null==r?void 0:r.baseUrl)||"http://47.94.52.142:3007",i=(h=a.url,(m=null==r?void 0:r.params)?h.replace(/\{(\w+)\}/g,(e,t)=>{let r=m[t];return null==r?"":encodeURIComponent(String(r))}):h),u=i.startsWith("http")?i:"".concat(o).concat(i),c={"Content-Type":"application/json"};l&&(c["x-application-id"]=l);let d=new URL(u);if(l&&!d.searchParams.has("applicationId")&&d.searchParams.set("applicationId",l),"appUser"===a.auth){let e=function(){try{{let e=localStorage.getItem("APP_USER_TOKEN");if(e)return String(e)}}catch(e){}return null}();e&&(c.Authorization="Bearer ".concat(e))}let p=await s.L.request({url:d.toString(),method:n,headers:c});if(!p.success)throw Error(p&&(p.message||p.error)||"Request failed: ".concat(p.code));var f,h,m,v=p&&(null!=(f=p.data)?f:p),g=null==r?void 0:r.selectPath;if(!g)return v;let y=g.startsWith("$.")?g.slice(2):g.startsWith("$")?g.slice(1):g;return y?y.split(".").reduce((e,t)=>e&&t in e?e[t]:void 0,v):v}async function c(e,t,r){let a={};if(!e||!t||!t.data||"object"!=typeof t.data)return a;for(let[l,n]of Object.entries(t.data))try{let t=null==n?void 0:n.source,o=null==n?void 0:n.params,i=null==n?void 0:n.select;if(!t)continue;a[l]=await u(e,t,{params:o,selectPath:i,baseUrl:r})}catch(e){a[l]={__error:(null==e?void 0:e.message)||"fetch error"}}return a}let d=(0,l.createContext)({data:{},loading:!1});function p(e){let{manifest:t,pageKey:r,children:n,baseUrl:o}=e,i=(0,l.useMemo)(()=>r&&(null==t?void 0:t.pages)?t.pages[r]:void 0,[t,r]),[s,u]=(0,l.useState)(!1),[p,f]=(0,l.useState)(null),[h,m]=(0,l.useState)({});(0,l.useEffect)(()=>{let e=!1;return async function(){if(t&&i){u(!0),f(null);try{let r=await c(t,i,o);e||m(r)}catch(t){e||f((null==t?void 0:t.message)||"load error")}finally{e||u(!1)}}}(),()=>{e=!0}},[t,i,o]);let v=(0,l.useMemo)(()=>({manifest:t,pageKey:r,pageConfig:i,data:h,loading:s,error:p}),[t,r,i,h,s,p]);return(0,a.jsx)(d.Provider,{value:v,children:n})}let f=(0,l.createContext)({});function h(e){let{appKey:t,locale:r,device:n="mobile",children:o}=e,[i,s]=(0,l.useState)(n),u=(0,l.useMemo)(()=>({appKey:t,locale:r,device:i,setDevice:s}),[t,r,i]);return(0,a.jsx)(f.Provider,{value:u,children:o})}var m=r(65794);function v(){let e=(0,n.useParams)(),t=(0,n.useSearchParams)(),[r,u]=(0,l.useState)(null),[c,d]=(0,l.useState)(!0),[f,v]=(0,l.useState)(null),g=e.locale||"zh",y=e.appKey;(0,l.useEffect)(()=>{try{(0,m.a)()}catch(e){}},[]),(0,l.useEffect)(()=>{let e=!1;async function t(){d(!0),v(null);try{var t;let r=await s.L.get("/api/apps/".concat(encodeURIComponent(String(y)),"/manifest?state=published"));if(!(null==r?void 0:r.success))throw Error((null==r?void 0:r.message)||"failed");e||u((null==(t=r.data)?void 0:t.manifest)||r.data)}catch(t){e||v((null==t?void 0:t.message)||"error")}finally{e||d(!1)}}return y&&t(),()=>{e=!0}},[y]);let S=(0,l.useMemo)(()=>{var e,a;let l=t.get("route")||"",n=("/me"===l?"/profile":l)||(null==r||null==(a=r.pages)||null==(e=a.home)?void 0:e.route)||"/home";try{let e=r&&r.pages?r.pages:{},t=Object.entries(e).find(e=>{let[,t]=e;return((null==t?void 0:t.route)||"")===n});if(t&&t[0])return t[0];return(n||"").replace(/^\//,"")||"home"}catch(e){return"home"}},[r,t]);(0,l.useEffect)(()=>{try{var e,a;let l=t.get("route")||"",n=("/me"===l?"/profile":l)||(null==r||null==(a=r.pages)||null==(e=a.home)?void 0:e.route)||"/home",o=r&&r.pages?r.pages:{},i=Object.entries(o).find(e=>{let[,t]=e;return((null==t?void 0:t.route)||"")===n}),s=(n||"").replace(/^\//,"")||"home";if(!(i||s)){let e=new URL(window.location.href);e.searchParams.set("route","/home"),window.history.replaceState(null,"",e.toString())}}catch(e){}},[r,t]);let w=(0,l.useMemo)(()=>{try{let e=(null==r?void 0:r.pages)&&S?r.pages[S]:void 0,t=(null==e?void 0:e.category)||"workspace";return"string"==typeof t?t:"workspace"}catch(e){return"workspace"}},[r,S]);return c?(0,a.jsx)("main",{className:"min-h-[100dvh] flex items-center justify-center text-muted-foreground",children:"Loading..."}):f?(0,a.jsx)("main",{className:"min-h-[100dvh] flex items-center justify-center text-red-600 text-sm",children:f}):(0,a.jsx)("main",{className:"min-h-[100dvh] bg-transparent",children:(0,a.jsxs)(h,{appKey:String(y),locale:String(g),device:"mobile",children:[(0,a.jsx)(p,{manifest:r,pageKey:S,baseUrl:"http://47.94.52.142:3007",children:(0,a.jsx)(o.M3,{category:w,locale:g,layout:"mobile",pageKey:S})}),(0,a.jsx)(i.BottomNavigation,{})]})})}}},e=>{e.O(0,[6416,8290,5022,6497,7455,69,7938,1390,5897,3546,3031,6037,413,7746,7324,721,3378,9900,7341,7358],()=>e(e.s=67158)),_N_E=e.O()}]);