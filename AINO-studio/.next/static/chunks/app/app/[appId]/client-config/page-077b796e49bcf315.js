(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9046],{5660:(e,t,a)=>{"use strict";a.d(t,{$:()=>o,r:()=>r});var s=a(74364);a(10640);var i=a(4756),l=a(31792),n=a(11915);let r=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:a,size:l,asChild:o=!1,...c}=e,d=o?i.DX:"button";return(0,s.jsx)(d,{"data-slot":"button",className:(0,n.cn)(r({variant:a,size:l,className:t})),...c})}},11915:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l});var s=a(44542),i=a(61375);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,i.QP)((0,s.$)(t))}},24470:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ea});var s=a(74364),i=a(10640),l=a(28410),n=a(5660),r=a(25646),o=a(88224),c=a(11286),d=a(57893),p=a(11915);function u(e){let{className:t,...a}=e;return(0,s.jsx)(d.YZ,{"data-slot":"resizable-panel-group",className:(0,p.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...a})}function h(e){let{...t}=e;return(0,s.jsx)(d.Zk,{"data-slot":"resizable-panel",...t})}function m(e){let{withHandle:t,className:a,...i}=e;return(0,s.jsx)(d.TW,{"data-slot":"resizable-handle",className:(0,p.cn)("bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:translate-x-0 data-[panel-group-direction=vertical]:after:-translate-y-1/2 [&[data-panel-group-direction=vertical]>div]:rotate-90",a),...i,children:t&&(0,s.jsx)("div",{className:"bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border",children:(0,s.jsx)(c.A,{className:"size-2.5"})})})}var g=a(69494),v=a(56318),x=a(74688),f=a(73475),y=a(6712),j=a(40825),b=a(18374),N=a(4002),w=a(49592),S=a(64565),C=a(46400),z=a(6651),k=a(29552),I=a(40721),T=a(53107),_=a(96619),D=a(45889),A=a(67553),O=a(83075);let E={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{schemaVersion:{type:"string"},app:{type:"object",properties:{appKey:{type:"string"},locale:{type:"string"},theme:{type:"string"},bottomNav:{type:"array",items:{type:"object",properties:{key:{type:"string"},label:{type:"string"},page:{type:"string"},route:{type:"string"},iconName:{type:"string"}},required:["key","label"]}}},required:["appKey","locale","theme","bottomNav"]},pages:{type:"object"},dataSources:{type:"object"},actions:{type:"object"}},required:["schemaVersion","app"]};var P=a(91650),L=a(8639),R=a(54356),M=a(55132),$=a(47255),B=a(76572),F=a(74395);function J(e){let{open:t,onOpenChange:a,lang:l,pages:r,value:o,onSave:c}=e,[d]=(0,i.useState)("click"),[p,u]=(0,i.useState)("navigate"),[h,m]=(0,i.useState)("internal"),[f,y]=(0,i.useState)(r[0]||"home"),[j,b]=(0,i.useState)(""),[N,w]=(0,i.useState)(""),[S,C]=(0,i.useState)(void 0),[z,k]=(0,i.useState)("");return(0,i.useEffect)(()=>{t&&(o?(u(o.action||"navigate"),m(o.pageType||"internal"),y(o.page||r[0]||"home"),b(o.url||""),w(o.tabKey||""),C("number"==typeof o.tabIndex?o.tabIndex:void 0),k(o.params||"")):(u("navigate"),m("internal"),y(r[0]||"home"),b(""),w(""),C(void 0),k("")))},[t]),(0,s.jsx)(R.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(R.Cf,{className:"max-w-[560px] w-[92vw] bg-white",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{children:"zh"===l?"事件配置":"Event Settings"})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(v.J,{children:"zh"===l?"事件类型":"Trigger"}),(0,s.jsx)(x.p,{value:"zh"===l?"点击时":"On Click",readOnly:!0})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(v.J,{children:"zh"===l?"执行动作":"Action"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"navigate"===p?"default":"outline",onClick:()=>u("navigate"),children:"zh"===l?"跳转新页面":"Navigate"}),(0,s.jsx)(n.$,{size:"sm",variant:"switchTab"===p?"default":"outline",onClick:()=>u("switchTab"),children:"zh"===l?"当前页面切换":"Switch Tab"})]})]})]}),"navigate"===p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(v.J,{children:"zh"===l?"页面类型":"Destination"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"internal"===h?"default":"outline",onClick:()=>m("internal"),children:"zh"===l?"内部页面":"Internal"}),(0,s.jsx)(n.$,{size:"sm",variant:"external"===h?"default":"outline",onClick:()=>m("external"),children:"zh"===l?"外部链接":"External"})]})]}),"internal"===h?(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(v.J,{children:"zh"===l?"选择页面":"Select Page"}),(0,s.jsx)("select",{className:"border rounded-md h-9 px-2",value:f,onChange:e=>y(e.target.value),children:r.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}):(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(v.J,{children:"zh"===l?"外部链接":"External URL"}),(0,s.jsx)(x.p,{placeholder:"https://",value:j,onChange:e=>b(e.target.value)})]})]}):(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(v.J,{children:"zh"===l?"标签标识(可选)":"Tab Key (optional)"}),(0,s.jsx)(x.p,{placeholder:"zh"===l?"例如: overview":"e.g. overview",value:N,onChange:e=>w(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(v.J,{children:"zh"===l?"标签索引(可选)":"Tab Index (optional)"}),(0,s.jsx)(x.p,{type:"number",placeholder:"0",value:"number"==typeof S?String(S):"",onChange:e=>C(""===e.target.value?void 0:Number(e.target.value))})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(v.J,{children:"zh"===l?"页面入参 (JSON)":"Params (JSON)"}),(0,s.jsx)(g.T,{rows:3,value:z,onChange:e=>k(e.target.value),placeholder:"zh"===l?'例如: {"tab":1}':'e.g. {"tab":1}'})]})]}),(0,s.jsxs)(R.Es,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>a(!1),children:"zh"===l?"取消":"Cancel"}),(0,s.jsx)(n.$,{onClick:()=>{c("navigate"===p?{trigger:d,action:p,pageType:h,page:"internal"===h?f:void 0,url:"external"===h?j:void 0,params:(null==z?void 0:z.trim())||void 0}:{trigger:d,action:p,tabKey:N||void 0,tabIndex:"number"==typeof S?S:void 0,params:(null==z?void 0:z.trim())||void 0}),a(!1)},children:"zh"===l?"确定":"Save"})]})]})})}async function U(){console.log("\uD83D\uDCCB 采集Studio端配置...");try{let e=await V(),t=await K(),a=await W(),s=await H(),i=await G(),l=await q();return{manifest:a,auth:s,pages:i,dataSources:l,user:e,modules:t}}catch(e){throw console.error("❌ Studio配置采集失败:",e),e}}async function V(){try{let e=localStorage.getItem("user"),t=localStorage.getItem("user_preferences"),a=localStorage.getItem("user_settings");return{currentUser:e?JSON.parse(e):null,preferences:t?JSON.parse(t):null,settings:a?JSON.parse(a):null}}catch(e){return console.warn("⚠️ 用户配置采集失败:",e),{}}}async function K(){try{let e=await P.api.modules.getAllModules();if(e.success&&e.data){let t={};return e.data.forEach(e=>{t[e.key]={name:e.name,description:e.description,version:e.version,config:e.config}}),t}return{}}catch(e){return console.warn("⚠️ 模块配置采集失败:",e),{}}}async function W(){try{let e=Y();if(e){let t=await P.api.apps.getManifest(e,"draft");if(t.success&&t.data)return t.data}return{schemaVersion:"1.0",app:{appKey:e||"default-app",locale:"zh-CN",defaultLanguage:"zh",theme:"default",bottomNav:[{key:"home",label:"首页",route:"/preview"},{key:"me",label:"我的",route:"/profile"}],pcTopNav:[]}}}catch(e){return console.warn("⚠️ Manifest配置采集失败:",e),{schemaVersion:"1.0",app:{appKey:"default-app",locale:"zh-CN",defaultLanguage:"zh",theme:"default",bottomNav:[],pcTopNav:[]}}}}async function H(){try{let e=localStorage.getItem("auth_config");if(e)return JSON.parse(e);return{layoutVariant:"centered",showBackground:!0,backgroundImage:void 0,showLogo:!0,logoImage:void 0,showIntro:!0,introTitle:void 0,introText:void 0,titleColor:void 0,bodyColor:void 0,providers:[{key:"phone",label:"手机号登录",enabled:!0},{key:"wechat",label:"微信登录",enabled:!0},{key:"bytedance",label:"字节登录",enabled:!1},{key:"google",label:"谷歌登录",enabled:!0},{key:"apple",label:"苹果登录",enabled:!0}]}}catch(e){return console.warn("⚠️ 认证配置采集失败:",e),{layoutVariant:"centered",showBackground:!0,providers:[]}}}async function G(){try{let t=Y();if(t){var e;let a=await P.api.apps.getManifest(t,"draft");if(a.success&&(null===(e=a.data)||void 0===e?void 0:e.pages))return a.data.pages}return{}}catch(e){return console.warn("⚠️ 页面配置采集失败:",e),{}}}async function q(){try{let t=Y();if(t){var e;let a=await P.api.apps.getManifest(t,"draft");if(a.success&&(null===(e=a.data)||void 0===e?void 0:e.dataSources))return a.data.dataSources}return{}}catch(e){return console.warn("⚠️ 数据源配置采集失败:",e),{}}}async function Z(){console.log("\uD83D\uDCF1 通过iframe桥接采集APP端配置...");try{var e,t,a;let s=function(){for(let e of document.querySelectorAll("iframe"))try{if(e.src&&(e.src.includes("localhost:3002")||e.src.includes("localhost:3005")||e.src.includes("/preview")||e.src.includes("/p/")))return e}catch(e){continue}return null}();if(!s)return console.warn("⚠️ 未找到AINO-APP的iframe，使用默认配置"),X();let i="config-request-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),l=await (e=s,t={type:"aino:config:request",requestId:i},a=i,new Promise(s=>{let i=setTimeout(()=>{s({success:!1,error:"请求超时"})},1e4),l=t=>{if(t.source!==e.contentWindow)return;let n=t.data;if("aino:config:response"===n.type&&n.requestId===a)clearTimeout(i),window.removeEventListener("message",l),s({success:!0,data:n.payload});else if("aino:config:error"===n.type&&n.requestId===a){var r;clearTimeout(i),window.removeEventListener("message",l),s({success:!1,error:(null===(r=n.payload)||void 0===r?void 0:r.message)||"未知错误"})}};window.addEventListener("message",l);try{var n;null===(n=e.contentWindow)||void 0===n||n.postMessage(t,"*")}catch(e){clearTimeout(i),window.removeEventListener("message",l),s({success:!1,error:"消息发送失败"})}}));if(l.success)return console.log("✅ APP配置采集成功"),l.data;return console.warn("⚠️ APP配置采集失败，使用默认配置"),X()}catch(e){return console.error("❌ iframe桥接配置采集失败:",e),X()}}function X(){return{layout:{},components:{},design:{},animation:{},accessibility:{},themes:{},cards:{},localStorage:{}}}function Y(){let e=window.location.pathname.match(/\/app\/([^\/]+)/);return e?e[1]:null}let Q=(0,O.default)(()=>a.e(5386).then(a.bind(a,55386)).then(e=>e.default),{loadableGenerated:{webpack:()=>[55386]},ssr:!1}),ee={type:"object",additionalProperties:!0,properties:{title:{type:["string","object"],properties:{zh:{type:"string"},en:{type:"string"}}},subtitle:{type:["string","object"],properties:{zh:{type:"string"},en:{type:"string"}}},actions:{type:"array",items:{type:"object",properties:{key:{type:"string"},label:{type:"string"},icon:{type:"string"}}}},style:{type:"object",properties:{variant:{type:"string",enum:["plain","soft","elevated"]},radius:{type:"string",enum:["none","sm","md","lg","xl","full"]},elevation:{type:"number",minimum:0,maximum:24},padding:{type:"string",enum:["none","xs","sm","md","lg"]},gap:{type:"string",enum:["none","xs","sm","md","lg"]},colors:{type:"object",properties:{background:{type:"string"},text:{type:"string"},highlight:{type:"string"}}},typography:{type:"object",properties:{titleSize:{type:"string"},bodySize:{type:"string"}}}}},layout:{type:"object",properties:{type:{type:"string"},columns:{type:"number",minimum:1,maximum:4}}},display:{type:"object",properties:{mode:{type:"string",enum:["pick","filter","time","hot"]},limit:{type:["number","null"]},unlimited:{type:"boolean"},sort:{type:"object",properties:{by:{type:"string"},order:{type:"string",enum:["asc","desc"]}}}}},data:{type:"object",properties:{mode:{type:"string",enum:["dynamic","static"]},source:{type:"string"},static:{type:["array","object","null"]}}},render:{type:"object",properties:{item:{type:["object","string"]}}}}},et=()=>'{\n  "title": "",\n  "subtitle": "",\n  "style": {\n    "variant": "plain",\n    "radius": "md",\n    "elevation": 0,\n    "padding": "md",\n    "gap": "md",\n    "colors": { "background": "", "text": "" },\n    "typography": { "titleSize": "base", "bodySize": "sm" }\n  },\n  "layout": { "type": "list", "columns": 1 },\n  "display": { "limit": 1, "mode": "time" },\n  "data": { "mode": "dynamic" },\n  "render": { "item": {} }\n}';function ea(){var e,t,a,d,p,O,U,V,K,W,H,G,q,Z,X,Y,ea,es,ei,el,en,er,eo,ec,ed,ep,eu,eh,em,eg,ev,ex,ef,ey,ej,eb,eN,ew,eS,eC,ez,ek;let eI=(0,l.useParams)();(0,l.useRouter)();let{locale:eT}=(0,f.Y)(),{toast:e_}=(0,y.dj)(),[eD,eA]=(0,i.useState)("mobile"),[eO,eE]=(0,i.useState)("zh"===eT?"zh":"en"),[eP,eL]=(0,i.useState)(""),[eR,eM]=(0,i.useState)("preview"),[e$,eB]=(0,i.useState)(""),[eF,eJ]=(0,i.useState)(""),[eU,eV]=(0,i.useState)(!1),eK=(0,i.useRef)(null),eW=(0,i.useRef)(!1),[eH,eG]=(0,i.useState)(!1),[eq,eZ]=(0,i.useState)(!1),[eX,eY]=(0,i.useState)(!0),[eQ,e0]=(0,i.useState)(!1),[e1,e2]=(0,i.useState)(!1),[e3,e5]=(0,i.useState)(null),[e4,e6]=(0,i.useState)(!1),[e7,e8]=(0,i.useState)("manifest"),[e9,te]=(0,i.useState)(!1),[tt,ta]=(0,i.useState)(""),[ts,ti]=(0,i.useState)({layoutVariant:"centered",showBackground:!0,backgroundImage:void 0,showLogo:!0,logoImage:void 0,showIntro:!0,introTitle:void 0,introText:void 0,providers:[{key:"phone",label:"zh"===eT?"手机号登录":"Phone",enabled:!0},{key:"wechat",label:"zh"===eT?"微信登录":"WeChat",enabled:!0},{key:"bytedance",label:"zh"===eT?"字节登录":"ByteDance",enabled:!1},{key:"google",label:"zh"===eT?"谷歌登录":"Google",enabled:!0},{key:"apple",label:"zh"===eT?"苹果登录":"Apple",enabled:!0}]}),[tl,tn]=(0,i.useState)({schemaVersion:"1.0",app:{appKey:eI.appId,locale:"zh"===eO?"zh-CN":"en-US",defaultLanguage:"zh"===eO?"zh":"en",theme:"default",bottomNav:[{key:"home",label:"zh"===eO?"首页":"Home",route:"/preview"},{key:"me",label:"zh"===eO?"我的":"Me",route:"/profile"}],pcTopNav:[]},dataSources:{}}),[tr,to]=(0,i.useState)("manifest"),[tc,td]=(0,i.useState)("home"),[tp,tu]=(0,i.useState)(!1),[th,tm]=(0,i.useState)([]),[tg,tv]=(0,i.useState)(!1),[tx,tf]=(0,i.useState)(""),[ty,tj]=(0,i.useState)(null),[tb,tN]=(0,i.useState)({}),[tw,tS]=(0,i.useState)({});eI.appId;let[tC,tz]=(0,i.useState)({}),[tk,tI]=(0,i.useState)([]),[tT,t_]=(0,i.useState)({}),[tD,tA]=(0,i.useState)({}),[tO,tE]=(0,i.useState)({});function tP(e){try{var t,a,s,i,l,n,r,o,c,d;let p=String((null==e?void 0:null===(t=e.card)||void 0===t?void 0:t.id)||""),u=String((null==e?void 0:null===(a=e.card)||void 0===a?void 0:a.name)||""),h=(null==e?void 0:null===(s=e.dataSource)||void 0===s?void 0:s.key)?String(null==e?void 0:null===(i=e.dataSource)||void 0===i?void 0:i.key):void 0,m=(null==e?void 0:null===(l=e.dataSource)||void 0===l?void 0:l.label)?String(null==e?void 0:null===(n=e.dataSource)||void 0===n?void 0:n.label):void 0,g=(null==e?void 0:null===(r=e.dataSource)||void 0===r?void 0:r.tableId)||(null==e?void 0:null===(o=e.dataSource)||void 0===o?void 0:o.id),v=(null==e?void 0:null===(c=e.dataSource)||void 0===c?void 0:c.tableName)||(null==e?void 0:null===(d=e.dataSource)||void 0===d?void 0:d.name),x=(null==e?void 0:e.inputs)&&"object"==typeof e.inputs?e.inputs:{};if(!p)return;let f="".concat(p,"::").concat(h||(g?"table:".concat(g):"unknown"));tz(e=>({...e,[f]:{cardType:p,cardName:u,dataSourceKey:h,dataSourceLabel:m,tableId:g?String(g):void 0,tableName:v?String(v):void 0,inputs:x,timestamp:Date.now()}}))}catch(e){}}let tL=async(e,t)=>{e.forEach(e=>{let{mapConfig:a,table:s}=e,{card:i,inputs:l,dataSource:n}=a,{fields:r}=s.config,o=t[i.packageId];if(-1!==i.packageId.indexOf("Sub")){let e=o.find(e=>e.cardId===i.type);e&&e.dataConfig.forEach((e,t)=>{let{key:a,label:l,type:n,child:o}=e;if(o){let e=r.find(e=>e.label===l&&e.type===n);if(e){let t=e.key;o.forEach((l,n)=>{let r="".concat(i.id,"::table_").concat(s.id);tB(r,"".concat(a,"[].").concat(l.key),"".concat(t,".").concat(e.metaItemsConfig.fields[n].id))})}}else{var c;tB("".concat(i.id,"::table_").concat(s.id),a,null===(c=r.find(e=>e.label===l&&e.type===n))||void 0===c?void 0:c.key)}})}else cardConfig.forEach(e=>{var t;let{key:a,label:l,type:n}=e;tB("".concat(i.id,"::table_").concat(s.id),a,null===(t=r.find(e=>e.label===l&&e.type===n))||void 0===t?void 0:t.key)})})},tR=async e=>{let t=String(eI.appId),a=await P.api.applications.getApplicationModules(t),s=a.success&&a.data?a.data.modules:[],i=await tV(),{data:l}=await P.api.modules.getCardConfigs(),n=[];for(let t=0;t<e.length;t++){let a=e[t],l=s.find(e=>{var t;return a.packageId.startsWith(null==e?void 0:null===(t=e.config)||void 0===t?void 0:t.moduleKey)});if(l){let{moduleKey:e}=l.config,t=a.packageId==="".concat(e,"Sub")?"".concat(a.packageId,"-").concat(a.type):e,s=i.find(e=>{var a;return(null==e?void 0:null===(a=e.config)||void 0===a?void 0:a.moduleKey)===t});if(s){a6({id:s.id,moduleName:s.moduleName,name:s.name});let t={key:"table_".concat(s.id),label:"".concat(s.moduleName,"/").concat(s.name)},i={card:{id:a.id,name:a.displayName,type:a.type,packageId:a.packageId,moduleKey:e},dataSource:t,inputs:a.inputFields};n.push({mapConfig:i,table:s}),tP(i)}}}tL(n,l)};async function tM(e){try{var t;let a;if(!e||tT[e])return;let s=String(eI.appId);if(e.startsWith("table:"))a=e.replace(/^table:/,"");else{let t=(tl.dataSources||{})[e];a=null==t?void 0:t.tableId}if(!a){t_(t=>({...t,[e]:[]}));return}let i=await P.api.directoryDefs.getOrCreateDirectoryDefByDirectoryId(a,s),l=null==i?void 0:null===(t=i.data)||void 0===t?void 0:t.id;if(!l){t_(t=>({...t,[e]:[]}));return}let n=await P.api.fields.getFields({directoryId:l,page:1,limit:100}),r=Array.isArray(null==n?void 0:n.data)?n.data:[],o=[];r.map(e=>{var t,a,s;"meta_items"===e.type&&((null===(s=e.schema)||void 0===s?void 0:null===(a=s.metaItemsConfig)||void 0===a?void 0:a.fields)||[]).forEach(t=>{var a;o.push({key:"".concat(e.key,".").concat(t.id)||"",label:"".concat((null==e?void 0:null===(a=e.schema)||void 0===a?void 0:a.label)||e.key||"","-").concat(t.label)})}),o.push({key:String(e.key||""),label:String((null==e?void 0:null===(t=e.schema)||void 0===t?void 0:t.label)||e.key||"")})}),t_(t=>({...t,[e]:o}))}catch(t){t_(t=>({...t,[e]:[]}))}}function t$(e){try{let t=[],a=e=>"String"===e||"Number"===e||"Boolean"===e||"Date"===e||"Time"===e||"Datetime"===e||"RichText"===e||"Image"===e||"Video"===e||"File"===e;return((e,s)=>{if(!e||"object"!=typeof e){s&&t.push(s);return}if(Array.isArray(e)){if(0===e.length){s&&t.push("".concat(s,"[]"));return}let i=e[0];if(a(i)){s&&t.push("".concat(s,"[]"));return}if("object"==typeof i&&i){Object.keys(i).forEach(e=>{let l=i[e];a(l)?t.push("".concat(s,"[].").concat(e)):Array.isArray(l)?t.push("".concat(s,"[].").concat(e,"[]")):"object"==typeof l&&l?Object.keys(l).forEach(a=>{t.push("".concat(s,"[].").concat(e,".").concat(a))}):t.push("".concat(s,"[].").concat(e))});return}s&&t.push("".concat(s,"[]"));return}Object.keys(e).forEach(i=>{let l=e[i],n=s?"".concat(s,".").concat(i):i;if(a(l))t.push(n);else if(Array.isArray(l)){if(0===l.length)t.push("".concat(n,"[]"));else{let e=l[0];a(e)?t.push("".concat(n,"[]")):"object"==typeof e&&e?Object.keys(e).forEach(s=>{let i=e[s];a(i)?t.push("".concat(n,"[].").concat(s)):Array.isArray(i)?t.push("".concat(n,"[].").concat(s,"[]")):"object"==typeof i&&i?Object.keys(i).forEach(e=>{t.push("".concat(n,"[].").concat(s,".").concat(e))}):t.push("".concat(n,"[].").concat(s))}):t.push("".concat(n,"[]"))}}else if("object"==typeof l&&l){let e=Object.keys(l);0===e.length?t.push(n):e.forEach(e=>{let s=l[e];a(s)||"object"!=typeof s?t.push("".concat(n,".").concat(e)):Array.isArray(s)?0===s.length?t.push("".concat(n,".").concat(e,"[]")):a(s[0])?t.push("".concat(n,".").concat(e,"[]")):"object"==typeof s[0]&&s[0]&&Object.keys(s[0]).forEach(a=>{t.push("".concat(n,".").concat(e,"[].").concat(a))}):Object.keys(s).forEach(a=>{t.push("".concat(n,".").concat(e,".").concat(a))})})}else t.push(n)})})(e,""),Array.from(new Set(t))}catch(e){return[]}}function tB(e,t,a){tA(s=>{let i={...s[e]||{},[t]:a};return{...s,[e]:i}})}function tF(e){try{tz(t=>{let a={...t};return delete a[e],a}),tA(t=>{let a={...t};return delete a[e],a}),tE(t=>{let a={...t};return delete a[e],a})}catch(e){}}function tJ(e,t){tA(a=>{let s={...a[e]||{}};return void 0!==s[t]&&delete s[t],{...a,[e]:s}})}(0,i.useEffect)(()=>{try{Object.values(tC||{}).forEach(e=>{let t=(null==e?void 0:e.dataSourceKey)?String(e.dataSourceKey):void 0;t&&(tl.dataSources||{})[t]&&!tT[t]&&tM(t);let a=(null==e?void 0:e.tableId)?String(e.tableId):void 0;if(a){let e="table:".concat(a);tT[e]||tM(e)}})}catch(e){}},[tC,tT]),(0,i.useEffect)(()=>{try{let e=Object.entries(tC||{});if(0===e.length)return;tE(t=>{let a={...t};return e.forEach(e=>{let[t,s]=e,i=String((null==s?void 0:s.dataSourceKey)||"");a[t]||(i&&(tl.dataSources||{})[i]?a[t]=i:(null==s?void 0:s.tableId)?a[t]="table:".concat(String(s.tableId)):a[t]="")}),a})}catch(e){}},[tC,null==tl?void 0:tl.dataSources]);let tU=(0,i.useMemo)(()=>{let e=tx.trim().toLowerCase();return e?th.filter(t=>t.name.toLowerCase().includes(e)||t.moduleName.toLowerCase().includes(e)):th},[th,tx]);async function tV(){if(!tg&&!(th.length>0)){tv(!0);try{let e=String(eI.appId),t=await P.api.applications.getApplicationModules(e),a=t.success&&t.data?t.data.modules:[],s=[],i=await Promise.all(a.map(async t=>{try{let a=await P.api.directories.getDirectories({applicationId:e,moduleId:t.id}),i=a.success&&a.data&&a.data.directories||[];return s.push(i.map(e=>({...e,moduleName:t.name}))),i.filter(e=>"table"===e.type).map(e=>({id:e.id,name:e.name,moduleName:t.name}))}catch(e){return[]}}));return tm(i.flat()),s.flat()}finally{tv(!1)}}}let[tK,tW]=(0,i.useState)(!1),[tH,tG]=(0,i.useState)(null),[tq,tZ]=(0,i.useState)(""),[tX,tY]=(0,i.useState)(!1),[tQ,t0]=(0,i.useState)("navigation"),[t1,t2]=(0,i.useState)("iconText"),[t3,t5]=(0,i.useState)("grid-4"),[t4,t6]=(0,i.useState)([]),[t7,t8]=(0,i.useState)(!1),[t9,ae]=(0,i.useState)(null),[at,aa]=(0,i.useState)(0),[as,ai]=(0,i.useState)({}),[al,an]=(0,i.useState)(""),[ar,ao]=(0,i.useState)(!1);(0,i.useEffect)(()=>{try{let a="STUDIO_CLIENT_CFG_".concat(eI.appId),s=window.localStorage.getItem(a);if(s){var e,t;let a=JSON.parse(s);tn(e=>(function(e,t){try{if(!t||"object"!=typeof t)return e;let a={...t};if("__ui"in a)try{delete a.__ui}catch(e){}let s={...e,...a};return s.app={...e.app,...a.app||{}},s.app.appKey=e.app.appKey,s.app.defaultLanguage=s.app.defaultLanguage||e.app.defaultLanguage,s.app.locale=s.app.locale||e.app.locale,Array.isArray(s.app.bottomNav)||(s.app.bottomNav=e.app.bottomNav),Array.isArray(s.app.pcTopNav)||(s.app.pcTopNav=e.app.pcTopNav),a.pages&&(s.pages=a.pages),a.dataSources&&(s.dataSources=a.dataSources),s}catch(t){return e}})(e,a));try{let t=null==a?void 0:null===(e=a.__ui)||void 0===e?void 0:e.activePageKey;t&&ta(String(t))}catch(e){}try{let e=null==a?void 0:null===(t=a.__ui)||void 0===t?void 0:t.pageTabIndex;"number"==typeof e&&aa(e)}catch(e){}}}catch(e){}finally{eW.current=!0}},[eI.appId]),(0,i.useEffect)(()=>{try{if(!eW.current)return;let e="STUDIO_CLIENT_CFG_".concat(eI.appId),t={...tl,__ui:{activePageKey:tt,pageTabIndex:at}};window.localStorage.setItem(e,JSON.stringify(t))}catch(e){}},[tl,tt,at,eI.appId]);let[ac,ad]=(0,i.useState)(""),[ap,au]=(0,i.useState)(""),[ah,am]=(0,i.useState)('{\n  "title": "",\n  "subtitle": ""\n}'),[ag,av]=(0,i.useState)({}),[ax,af]=(0,i.useState)(""),[ay,aj]=(0,i.useState)(null),[ab,aN]=(0,i.useState)("json"),aw=(0,i.useRef)(!1),aS=(0,i.useRef)(null),[aC,az]=(0,i.useState)(!1),[ak,aI]=(0,i.useState)(""),[aT,a_]=(0,i.useState)(""),[aD,aA]=(0,i.useState)("1"),[aO,aE]=(0,i.useState)(!1),[aP,aL]=(0,i.useState)("time"),[aR,aM]=(0,i.useState)(""),[a$,aB]=(0,i.useState)(!1);function aF(e){let t=new Set,a=[];for(let s of Array.isArray(e)?e:[]){let e=String((null==s?void 0:s.id)||"")+"::"+String((null==s?void 0:s.title)||"");t.has(e)||(t.add(e),a.push({id:(null==s?void 0:s.id)||"tab-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,7)),title:(null==s?void 0:s.title)||""}))}return a}let[aJ,aU]=(0,i.useState)(!1),[aV,aK]=(0,i.useState)(""),[aW,aH]=(0,i.useState)(""),[aG,aq]=(0,i.useState)(""),[aZ,aX]=(0,i.useState)(!1),[aY,aQ]=(0,i.useState)([]),[a0,a1]=(0,i.useState)({}),a2=(0,i.useRef)(null),a3=(0,i.useMemo)(()=>Object.entries(tl.dataSources||{}).filter(e=>{let[,t]=e;return t&&"table"===t.type}).map(e=>{let[t,a]=e;return{key:t,tableId:a.tableId,label:a.label||"".concat(a.moduleName||"","/").concat(a.tableName||"")}}),[tl.dataSources]);async function a5(e){try{var t;aX(!0);let a=(tl.dataSources||{})[e],s=null==a?void 0:a.tableId;if(!s&&"string"==typeof e&&e.startsWith("table:")&&(s=e.replace(/^table:/,"")),!s){aQ([]);return}let i=String(eI.appId),l=await P.api.directoryDefs.getOrCreateDirectoryDefByDirectoryId(s,i),n=null==l?void 0:null===(t=l.data)||void 0===t?void 0:t.id;if(!n){aQ([]);return}let r=await P.api.fields.getFields({directoryId:n,page:1,limit:100}),o=r&&null!=r.data?r.data:r,c=(Array.isArray(o)?o:Array.isArray(null==o?void 0:o.items)?o.items:Array.isArray(null==o?void 0:o.records)?o.records:[]).map(e=>{let t=e.schema||{},a=e.type||t.type||"text",s=t.label||e.label||e.key;return{id:e.id,key:e.key,label:s,type:a,options:Array.isArray(t.options)?t.options:[],optionsTree:Array.isArray(t.cascaderOptions)?t.cascaderOptions:[]}}).sort((e,t)=>{let a=e=>+("select"!==e&&"cascader"!==e);return a(e.type)-a(t.type)});if(aQ(c),a2.current&&a2.current.dataSourceKey===e){let e=a2.current,t=new Set((e.fields||[]).map(e=>String(e.fieldId)));a1(()=>{let e={};return c.forEach(a=>{let s=t.has(String(a.key));e[a.key]={fieldId:a.key,type:a.type,label:a.label,__checked:s}}),e}),a2.current=null}else a1(e=>{let t={...e};return c.forEach(e=>{t[e.key]||(t[e.key]={fieldId:e.key,type:e.type,label:e.label})}),t})}catch(e){aQ([])}finally{aX(!1)}}async function a4(e){if(!tw[e]&&!tb[e]){tS(t=>({...t,[e]:!0}));try{let t=await P.api.records.listRecords(e,{page:1,pageSize:100}),a=(t.success&&t.data?Array.isArray(t.data)?t.data:t.data.records||[]:[]).map(e=>({id:e.id,label:e.name||e.title||e.id,raw:e}));tN(t=>({...t,[e]:a}))}catch(t){tN(t=>({...t,[e]:[]}))}finally{tS(t=>({...t,[e]:!1}))}}}function a6(e){let t="table_".concat(e.id);tn(a=>{let s={...a};return s.dataSources=s.dataSources||{},s.dataSources[t]={type:"table",tableId:e.id,tableName:e.name,moduleName:e.moduleName,label:"".concat(e.moduleName,"/").concat(e.name)},s}),tu(!1)}function a7(e){tn(t=>{let a={...t},s={...a.dataSources||{}};return delete s[e],a.dataSources=s,a})}async function a8(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8,i=document.createElement("img"),l=await new Promise((t,a)=>{let s=new FileReader;s.onload=()=>t(String(s.result)),s.onerror=a,s.readAsDataURL(e)});await new Promise(e=>{i.onload=e,i.src=l});let n=document.createElement("canvas"),r=Math.min(t/i.width,a/i.height),o=Math.round(i.width*r),c=Math.round(i.height*r);return n.width=o,n.height=c,n.getContext("2d").drawImage(i,0,0,o,c),n.toDataURL("image/jpeg",s)}(0,i.useEffect)(()=>{let e=e=>{let t=e.data;if(t&&"DYN_CARDS"===t.type&&Array.isArray(t.cards))ai(e=>({...e,[t.category]:t.cards})),an(t.category||"");else if(t&&"OVERRIDE"===t.type){let{pageId:e,sectionKey:a,cardType:s,props:i,jsx:l,filters:n}=t;try{if(i){let t="pages/p-".concat(e,"/cards/").concat(a,"/").concat(s,".json"),l=JSON.stringify(i||{},null,2);av(e=>({...e,[t]:l})),ax===t&&(aw.current=!0,eL(l),aN("json"),eM("code"))}n&&"object"==typeof n&&(a2.current=n,n.dataSourceKey&&(aq(String(n.dataSourceKey)),a5(String(n.dataSourceKey))))}catch(e){}}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[]),(0,i.useEffect)(()=>{try{let e;e="manifest"===tr?tl:"app"===tr?tl.app||{}:"dataSources"===tr?tl.dataSources||{}:"page"===tr?tl.pages&&tl.pages[tc]||{}:tl,eL(JSON.stringify(e,null,2))}catch(e){eL("{}")}},[tl,tr,tc]),(0,i.useEffect)(()=>{tn(e=>({...e,app:{...e.app,locale:"zh"===eO?"zh-CN":"en-US",bottomNav:e.app.bottomNav.map(e=>"home"===e.key?{...e,label:"zh"===eO?"首页":"Home"}:"me"===e.key?{...e,label:"zh"===eO?"我的":"Me"}:e)}}))},[eO]),(0,i.useEffect)(()=>{ti(e=>({...e,providers:e.providers.map(e=>"phone"===e.key?{...e,label:"zh"===eO?"手机号登录":"Phone"}:"wechat"===e.key?{...e,label:"zh"===eO?"微信登录":"WeChat"}:"bytedance"===e.key?{...e,label:"zh"===eO?"字节登录":"ByteDance"}:"google"===e.key?{...e,label:"zh"===eO?"谷歌登录":"Google"}:"apple"===e.key?{...e,label:"zh"===eO?"苹果登录":"Apple"}:e)}))},[eO]);let[a9,se]=(0,i.useState)(!1),[st,sa]=(0,i.useState)(!1),[ss,si]=(0,i.useState)(!1),[sl,sn]=(0,i.useState)(""),[sr,so]=(0,i.useState)(""),[sc,sd]=(0,i.useState)(""),[sp,su]=(0,i.useState)("");async function sh(){try{var e;let t=await fetch("http://localhost:3007/api/preview-manifests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({manifest:tl})}),a=await t.json();if(!t.ok||!(null==a?void 0:a.success)||!(null==a?void 0:null===(e=a.data)||void 0===e?void 0:e.id))throw Error((null==a?void 0:a.message)||"create failed");let s=a.data.id;eJ(s);let i=encodeURIComponent(JSON.stringify((null==tl?void 0:tl.dataSources)||{})),l="http://localhost:3005/".concat(eO,"/preview?previewId=").concat(s,"&device=").concat(eD,"&appId=").concat(eI.appId,"&data=").concat(i);eB(l);try{window.localStorage.setItem("PREVIEW_ID",s),window.localStorage.setItem("APP_ID",String(eI.appId))}catch(e){}eM("preview")}catch(e){e_({description:(null==e?void 0:e.message)||("zh"===eO?"创建预览失败":"Failed to create preview"),variant:"destructive"}),eM("code")}}async function sm(){try{var e;let t=await fetch("http://localhost:3007/api/preview-manifests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({manifest:tl})}),a=await t.json();if(!t.ok||!(null==a?void 0:a.success)||!(null==a?void 0:null===(e=a.data)||void 0===e?void 0:e.id))throw Error((null==a?void 0:a.message)||"create failed");let s=a.data.id;eJ(s);let i=encodeURIComponent(JSON.stringify((null==tl?void 0:tl.dataSources)||{})),l="http://localhost:3005/".concat(eO,"/preview?previewId=").concat(s,"&device=").concat(eD,"&appId=").concat(eI.appId,"&data=").concat(i);eB(l);try{window.localStorage.setItem("PREVIEW_ID",s),window.localStorage.setItem("APP_ID",String(eI.appId))}catch(e){}window.open(l,"_blank","noopener,noreferrer"),e_({description:"zh"===eO?"预览已在新标签页打开":"Preview opened in new tab"})}catch(e){e_({description:(null==e?void 0:e.message)||("zh"===eO?"打开预览失败":"Failed to open preview"),variant:"destructive"})}}async function sg(e,t){try{if(!t)try{let e=JSON.parse(eP||"{}");tn(t=>{let a={...t};if("manifest"===tr)Object.assign(a,e);else if("app"===tr)a.app=e;else if("dataSources"===tr)a.dataSources=e;else if("page"===tr){if(ay&&ax)try{var s,i;let t=ay.pageKey.replace(/^p-/,"");ax.endsWith(".json")?(null===(s=window.frames[0])||void 0===s||s.postMessage({type:"SET_OVERRIDE",pageId:t,sectionKey:ay.sectionKey,cardType:ay.cardType,props:e},"*"),av(t=>({...t,[ax]:JSON.stringify(e,null,2)}))):ax.endsWith(".tsx")&&(null===(i=window.frames[0])||void 0===i||i.postMessage({type:"SET_OVERRIDE",pageId:t,sectionKey:ay.sectionKey,cardType:ay.cardType,jsx:eP},"*"),av(e=>({...e,[ax]:eP})))}catch(e){}else a.pages=a.pages||{},a.pages[tc]=e}return a})}catch(e){e_({description:(null==e?void 0:e.message)||("zh"===eO?"JSON 无法解析":"JSON parse error"),variant:"destructive"});return}if(!eF)return sh();let a=null!=e?e:tl,s=await fetch("http://localhost:3007/api/preview-manifests/".concat(eF),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({manifest:a})}),i=await s.json().catch(()=>({}));if(!s.ok||(null==i?void 0:i.success)===!1)throw Error((null==i?void 0:i.message)||"save failed");try{let e=new URL(e$||"http://localhost:3005/".concat(eO,"/preview?previewId=").concat(eF,"&device=").concat(eD,"&appId=").concat(eI.appId));e.searchParams.set("device",eD),e.searchParams.set("appId",String(eI.appId));let t=JSON.stringify((null==tl?void 0:tl.dataSources)||{});e.searchParams.set("data",encodeURIComponent(t)),eB(e.toString())}catch(a){let e=encodeURIComponent(JSON.stringify((null==tl?void 0:tl.dataSources)||{})),t="http://localhost:3005/".concat(eO,"/preview?previewId=").concat(eF,"&device=").concat(eD,"&appId=").concat(eI.appId,"&data=").concat(e);eB(t)}try{let e="STUDIO_CLIENT_CFG_".concat(eI.appId),t={...a,__ui:{activePageKey:tt,pageTabIndex:at}};window.localStorage.setItem(e,JSON.stringify(t))}catch(e){}e_({description:"zh"===eO?"已保存并刷新预览":"Saved and refreshed preview"})}catch(e){e_({description:(null==e?void 0:e.message)||("zh"===eO?"保存失败":"Save failed"),variant:"destructive"})}}async function sv(){if(!eq){eZ(!0);try{let t={...function(e,t,a,s){let i={};try{i=JSON.parse(s||"{}")}catch(e){throw Error((null==e?void 0:e.message)||("zh"===eO?"JSON 无法解析":"JSON parse error"))}let l={...e||{}};return"manifest"===t?Object.assign(l,i):"app"===t?l.app=i:"dataSources"===t?l.dataSources=i:"page"===t&&(l.pages=l.pages||{},l.pages[a]=i),l}(tl,tr,tc,eP),dataMappings:tD,incomingMappings:tC},a=String(eI.appId),s={};try{let e=await P.api.applications.getApplication(a);s=(e.success&&e.data?e.data.config:{})||{}}catch(e){s={}}let i={...s,clientManifest:t},l=await P.api.applications.updateApplication(a,{config:i});if(!l.success)throw Error(l.error||("zh"===eO?"保存到数据库失败":"Save to database failed"));if(tn(t),eF){let e=await fetch("http://localhost:3007/api/preview-manifests/".concat(eF),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({manifest:t})}),a=await e.json().catch(()=>({}));if(!e.ok||(null==a?void 0:a.success)===!1)throw Error((null==a?void 0:a.message)||"save failed");try{let e=new URL(e$||"http://localhost:3005/".concat(eO,"/preview?previewId=").concat(eF,"&device=").concat(eD,"&appId=").concat(eI.appId));e.searchParams.set("device",eD),e.searchParams.set("appId",String(eI.appId));let a=JSON.stringify((null==t?void 0:t.dataSources)||{});e.searchParams.set("data",encodeURIComponent(a)),eB(e.toString())}catch(s){let e=encodeURIComponent(JSON.stringify((null==t?void 0:t.dataSources)||{})),a="http://localhost:3005/".concat(eO,"/preview?previewId=").concat(eF,"&device=").concat(eD,"&appId=").concat(eI.appId,"&data=").concat(e);eB(a)}}else{var e;let a=await fetch("http://localhost:3007/api/preview-manifests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({manifest:t})}),s=await a.json();if(!a.ok||!(null==s?void 0:s.success)||!(null==s?void 0:null===(e=s.data)||void 0===e?void 0:e.id))throw Error((null==s?void 0:s.message)||"create failed");let i=s.data.id;eJ(i);let l=encodeURIComponent(JSON.stringify((null==t?void 0:t.dataSources)||{})),n="http://localhost:3005/".concat(eO,"/preview?previewId=").concat(i,"&device=").concat(eD,"&appId=").concat(eI.appId,"&data=").concat(l);eB(n)}e_({description:"zh"===eO?"已保存到数据库并刷新预览":"Saved to database and refreshed preview"}),eM("preview")}catch(e){e_({description:(null==e?void 0:e.message)||("zh"===eO?"保存失败":"Save failed"),variant:"destructive"})}finally{eZ(!1)}}}return(0,i.useEffect)(()=>{if(e4&&"auth-login"===e7&&"preview"===eR)try{var e;let t=(null===(e=tl.app)||void 0===e?void 0:e.defaultLanguage)||("zh"===eO?"zh":"en"),a={layoutVariant:ts.layoutVariant||"centered",showBackground:!!ts.showBackground,backgroundImage:ts.backgroundImage||void 0,showLogo:!!ts.showLogo,logoImage:ts.logoImage||void 0,showIntro:!!ts.showIntro,introTitle:ts.introTitle||void 0,introText:ts.introText||void 0,titleColor:ts.titleColor||void 0,bodyColor:ts.bodyColor||void 0,providers:(ts.providers||[]).map(e=>({key:e.key,enabled:!!e.enabled}))},s=new URL("http://localhost:3005/".concat(t,"/auth/login"));s.searchParams.set("authCfg",JSON.stringify(a)),s.searchParams.set("v",String(Date.now())),eB(s.toString())}catch(e){}},[ts,e4,e7,eR,null===(e=tl.app)||void 0===e?void 0:e.defaultLanguage,eO]),(0,i.useEffect)(()=>{let e=document.getElementById("my-app-iframe");window.addEventListener("message",function(t){var a,s;let i=t.data||{};if(i.cards&&"DYN_CARDS"===i.type&&tR(i.cards),"aino:data"===i.type&&tP(i.payload),i&&"object"==typeof i&&i.type&&String(i.type).startsWith("aino:")){if(!e){console.warn("Frame element not found, skipping message handling");return}switch(i.type){case"aino:ready":console.log("AINO ready:",i.payload);break;case"aino:height":i.payload&&"number"==typeof i.payload.height&&(e.style.height=i.payload.height+"px");break;case"aino:data":try{console.log("aino:data",i.payload),tP(i.payload)}catch(e){}break;case"aino:manifest":console.log("AINO manifest:",null===(a=i.payload)||void 0===a?void 0:a.manifest);break;case"aino:error":console.warn("AINO error:",null===(s=i.payload)||void 0===s?void 0:s.message);break;case"aino:custom":console.log("AINO custom:",i.payload)}}},!1)},[]),(0,i.useEffect)(()=>{"preview"!==eR||e$||sh()},[eR]),(0,i.useEffect)(()=>{if(e9)try{let e=String(tt||"");if(!e)return;let t=tl.pages&&tl.pages[e]||{},a=String(e$||"http://localhost:3005/".concat(eO,"/p/").concat(e.replace(/^p-/,"")));fetch("http://localhost:3007/api/page-configs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json().catch(()=>null)).then(e=>{var t;let s=e&&(e.id||(null===(t=e.data)||void 0===t?void 0:t.id)),i=new URL(a);s&&i.searchParams.set("cfgId",String(s)),eB(i.toString()),eM("preview")}).catch(()=>{let e=new URL(a);eB(e.toString()),eM("preview")})}catch(e){}},[e9]),(0,i.useEffect)(()=>{if(e$)try{let e=new URL(e$);e.searchParams.set("device",eD);let t=e.pathname.split("/");t.length>=3&&(t[1]=eO,e.pathname=t.join("/")),eB(e.toString())}catch(e){}},[eD,eO]),(0,i.useEffect)(()=>{let e=!0;return async function(){eY(!0);try{let a=String(eI.appId),s=await P.api.applications.getApplication(a),i=s.success&&s.data?s.data.config:null,l=null==i?void 0:i.clientManifest;if(e&&l&&"object"==typeof l){try{var t;let e=null==l?void 0:null===(t=l.app)||void 0===t?void 0:t.locale;"string"==typeof e&&(/^zh/i.test(e)?eE("zh"):/^en/i.test(e)&&eE("en"))}catch(e){}try{let e=Object.keys((null==l?void 0:l.pages)||{});e.length>0&&td(e[0])}catch(e){}tn(l);try{tA(l.dataMappings||{})}catch(e){}try{tz(l.incomingMappings||{})}catch(e){}"preview"===eR&&setTimeout(()=>{sh()},0)}}catch(e){}finally{e&&eY(!1)}}(),()=>{e=!1}},[eI.appId]),(0,s.jsxs)("main",{className:"h-[100dvh] overflow-hidden bg-gradient-to-br from-white via-blue-50 to-green-50",children:[(0,s.jsx)("div",{className:"max-w-[100rem] mx-auto p-3 h-full",children:(0,s.jsx)(r.Zp,{className:"p-0 overflow-hidden h-full",children:(0,s.jsxs)(u,{direction:"horizontal",className:"h-full",children:[(0,s.jsx)(h,{defaultSize:22,minSize:18,className:"bg-white",children:(0,s.jsxs)("div",{className:"h-full overflow-y-auto p-3 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b",children:[(0,s.jsx)("div",{className:"text-xs font-medium text-muted-foreground",children:"zh"===eO?"设备类型":"Device"}),(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsxs)(n.$,{variant:"pc"===eD?"default":"outline",size:"sm",onClick:()=>eA("pc"),className:"flex items-center gap-1 px-2 py-1 h-7 text-xs",children:[(0,s.jsx)(j.A,{className:"w-3 h-3"}),"PC"]}),(0,s.jsxs)(n.$,{variant:"mobile"===eD?"default":"outline",size:"sm",onClick:()=>eA("mobile"),className:"flex items-center gap-1 px-2 py-1 h-7 text-xs",children:[(0,s.jsx)(b.A,{className:"w-3 h-3"}),"Mobile"]})]})]}),e4||e9?e9?(0,s.jsxs)("div",{className:"h-full overflow-y-auto p-1 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{te(!1),e8("preview"),eM("preview");try{var e;let t=(null===(e=tl.app)||void 0===e?void 0:e.defaultLanguage)||"zh",a=encodeURIComponent(JSON.stringify((null==tl?void 0:tl.dataSources)||{})),s="http://localhost:3005/".concat(t,"/preview?previewId=").concat(eF,"&device=").concat(eD,"&appId=").concat(eI.appId,"&data=").concat(a);eB(s)}catch(e){}},children:[(0,s.jsx)(k.A,{className:"w-4 h-4 mr-1"}),"zh"===eO?"返回":"Back"]}),(0,s.jsx)("div",{className:"text-sm font-semibold",children:"zh"===eO?"页面配置":"Page Settings"}),tt&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["/pages/",tt,".json"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"页面名称":"Page Title"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)(x.p,{placeholder:"zh"===eO?"中文标题":"Title ZH",value:tt&&(null===(d=tl.pages)||void 0===d?void 0:null===(a=d[tt])||void 0===a?void 0:null===(t=a.title)||void 0===t?void 0:t.zh)||"",onChange:e=>tn(t=>{let a={...t};a.pages=a.pages||{};let s=a.pages[tt]||{};return s.title={...s.title||{},zh:e.target.value},a.pages[tt]=s,a})}),(0,s.jsx)(x.p,{placeholder:"zh"===eO?"英文标题":"Title EN",value:tt&&(null===(U=tl.pages)||void 0===U?void 0:null===(O=U[tt])||void 0===O?void 0:null===(p=O.title)||void 0===p?void 0:p.en)||"",onChange:e=>tn(t=>{let a={...t};a.pages=a.pages||{};let s=a.pages[tt]||{};return s.title={...s.title||{},en:e.target.value},a.pages[tt]=s,a})})]}),(0,s.jsx)("div",{className:"text-[10px] text-muted-foreground",children:"zh"===eO?"保存后右侧预览页标题会跟随显示":"Title applies to header after save"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("label",{className:"flex items-center justify-between border rounded-md px-3 py-2",children:[(0,s.jsx)("span",{children:"zh"===eO?"开启 顶部栏":"Show Header"}),(0,s.jsx)(M.d,{checked:!!(tt&&(null===(W=tl.pages)||void 0===W?void 0:null===(K=W[tt])||void 0===K?void 0:null===(V=K.options)||void 0===V?void 0:V.showHeader)!==!1),onCheckedChange:e=>tn(t=>{let a={...t};a.pages=a.pages||{};let s=a.pages[tt]||{};return s.options={...s.options||{},showHeader:!!e},a.pages[tt]=s,a})})]}),(0,s.jsx)("div",{})]}),(0,s.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["zh"===eO?"顶部标签栏（开启顶部栏后可用）":"Top Tabs (requires header)"," "]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-3",children:(0,s.jsxs)("label",{className:"flex items-center justify-between border rounded-md px-3 py-2",children:[(0,s.jsx)("span",{children:"zh"===eO?"开启 顶部标签栏":"Enable Top Tabs"}),(0,s.jsx)(M.d,{checked:!!(tt&&(null===(q=tl.pages)||void 0===q?void 0:null===(G=q[tt])||void 0===G?void 0:null===(H=G.topBar)||void 0===H?void 0:H.enabled)),onCheckedChange:e=>tn(t=>{var a,s;let i={...t};i.pages=i.pages||{};let l=i.pages[tt]||{};return l.topBar={...l.topBar||{},enabled:!!e,tabs:Array.isArray(null===(a=l.topBar)||void 0===a?void 0:a.tabs)?null===(s=l.topBar)||void 0===s?void 0:s.tabs:[]},i.pages[tt]=l,i})})]})}),!!(null===(Y=tl.pages)||void 0===Y?void 0:null===(X=Y[tt])||void 0===X?void 0:null===(Z=X.topBar)||void 0===Z?void 0:Z.enabled)&&(0,s.jsxs)("div",{className:"flex items-center justify-between px-1",children:[(0,s.jsx)("div",{className:"flex items-center gap-8 overflow-x-auto flex-nowrap",children:aF((null===(ek=tl.pages)||void 0===ek?void 0:null===(ez=ek[tt])||void 0===ez?void 0:null===(eC=ez.topBar)||void 0===eC?void 0:eC.tabs)||[]).map((e,t)=>(0,s.jsxs)("button",{className:"relative text-lg flex-shrink-0 ".concat(at===t?"text-primary":"text-foreground"),onClick:()=>aa(t),children:[e.title||"".concat("zh"===eO?"标签栏":"").concat(t+1),at===t&&(0,s.jsx)("span",{className:"absolute left-0 right-0 -bottom-1 mx-auto block h-1 w-20 bg-primary rounded-full"})]},"tabkey-".concat((null==e?void 0:e.id)||t)))}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>{aM(""),aB(!0)},children:"zh"===eO?"增加/管理":"Add/Manage"})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"内容导航配置":"Content Navigation"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:function(){try{var e,t;let a;let s=tl.pages&&tl.pages[tt]||{};if(null==s?void 0:null===(e=s.topBar)||void 0===e?void 0:e.enabled){let e=s.tabContent||{};a=(null==e?void 0:null===(t=e[at])||void 0===t?void 0:t.contentNav)||{}}else a=(null==s?void 0:s.contentNav)||{};let i=a.style||("text"===a.type?"text":(a.type,"icon"));t0("status"===a.category?"status":"navigation"),t2("text"===i?"text":"iconText"),t5(a.layout||"grid-4"),t6(Array.isArray(a.items)?a.items:[]),tY(!0)}catch(e){t0("navigation"),t2("iconText"),t5("grid-4"),t6([]),tY(!0)}},children:"zh"===eO?"配置内容导航":"Configure"}),tt&&(null===(es=tl.pages)||void 0===es?void 0:null===(ea=es[tt])||void 0===ea?void 0:ea.contentNav)&&(0,s.jsxs)("div",{className:"text-[11px] text-muted-foreground",children:[(null===(el=tl.pages[tt])||void 0===el?void 0:null===(ei=el.contentNav)||void 0===ei?void 0:ei.type)==="iconText"?"zh"===eO?"图+文":"Icon+Text":"zh"===eO?"文字":"Text"," \xb7 ",(null===(er=tl.pages[tt])||void 0===er?void 0:null===(en=er.contentNav)||void 0===en?void 0:en.layout)||"-"," \xb7 ",Array.isArray(null===(ec=tl.pages[tt])||void 0===ec?void 0:null===(eo=ec.contentNav)||void 0===eo?void 0:eo.items)?null===(ep=tl.pages[tt])||void 0===ep?void 0:null===(ed=ep.contentNav)||void 0===ed?void 0:ed.items.length:0," ","zh"===eO?"项":"items"]})]}),(()=>{try{var e,t,a,s;let i=(null===(e=tl.pages)||void 0===e?void 0:e[tt])||{},l=(null==i?void 0:null===(t=i.topBar)||void 0===t?void 0:t.enabled)?null==i?void 0:null===(s=i.tabContent)||void 0===s?void 0:null===(a=s[at])||void 0===a?void 0:a.contentNav:null==i?void 0:i.contentNav;return!!l&&"text"===l.style}catch(e){return!1}})()&&(0,s.jsx)("div",{className:"mt-2 px-1",children:(0,s.jsx)("div",{className:"flex items-center gap-6 overflow-x-auto scrollbar-hide",children:((null===(eh=tl.pages[tt])||void 0===eh?void 0:null===(eu=eh.contentNav)||void 0===eu?void 0:eu.items)||[]).map((e,t)=>(0,s.jsxs)("button",{className:"relative pb-1 text-sm ".concat(at===t?"text-primary":"text-muted-foreground hover:text-foreground"),onClick:()=>{aa(t);try{var e;let a=(null===(e=tl.pages)||void 0===e?void 0:e[tt])||{},s=String(e$||"http://localhost:3005/".concat(eO,"/p/").concat(tt.replace(/^p-/,"")));fetch("http://localhost:3007/api/page-configs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(e=>e.json().catch(()=>null)).then(e=>{var a;let i=e&&(e.id||(null===(a=e.data)||void 0===a?void 0:a.id)),l=new URL(s);i&&l.searchParams.set("cfgId",String(i)),l.searchParams.set("tab",String(t)),eB(l.toString())}).catch(()=>{let e=new URL(s);e.searchParams.set("tab",String(t)),eB(e.toString())}),eM("preview")}catch(e){}},children:[(null==e?void 0:e.title)||"".concat("zh"===eO?"标签":"Tab"," ").concat(t+1),at===t&&(0,s.jsx)("span",{className:"absolute left-1/2 -translate-x-1/2 -bottom-0.5 h-0.5 w-6 bg-primary rounded-full"})]},t))})}),(()=>{try{var e,t,a,s;let i=(null===(e=tl.pages)||void 0===e?void 0:e[tt])||{},l=(null==i?void 0:null===(t=i.topBar)||void 0===t?void 0:t.enabled)?null==i?void 0:null===(s=i.tabContent)||void 0===s?void 0:null===(a=s[at])||void 0===a?void 0:a.contentNav:null==i?void 0:i.contentNav;return!!l&&"icon"===l.style}catch(e){return!1}})()&&(0,s.jsxs)("div",{className:"mt-2 px-1",children:[(0,s.jsx)("div",{className:"text-[11px] text-muted-foreground mb-1",children:"zh"===eO?"点击图标以切换配置的卡片区域":"Click icon to switch section being configured"}),(0,s.jsx)("div",{className:"flex items-center gap-5 overflow-x-auto scrollbar-hide py-2",children:((null===(eg=tl.pages[tt])||void 0===eg?void 0:null===(em=eg.contentNav)||void 0===em?void 0:em.items)||[]).map((e,t)=>(0,s.jsxs)("button",{className:"flex flex-col items-center gap-1 ".concat(at===t?"text-primary":"text-foreground"),onClick:()=>{aa(t);try{var e;let a=(null===(e=tl.pages)||void 0===e?void 0:e[tt])||{},s=String(e$||"http://localhost:3005/".concat(eO,"/p/").concat(tt.replace(/^p-/,"")));fetch("http://localhost:3007/api/page-configs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(e=>e.json().catch(()=>null)).then(e=>{var a;let i=e&&(e.id||(null===(a=e.data)||void 0===a?void 0:a.id)),l=new URL(s);i&&l.searchParams.set("cfgId",String(i)),l.searchParams.set("tab",String(t)),eB(l.toString())}).catch(()=>{let e=new URL(s);e.searchParams.set("tab",String(t)),eB(e.toString())}),eM("preview")}catch(e){}},children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-100 border border-gray-200"}),(0,s.jsx)("div",{className:"text-xs opacity-70",children:(null==e?void 0:e.title)||"Item ".concat(t+1)})]},t))})]})]}),(0,s.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"数据定义":"Data Sources"}),(0,s.jsxs)(n.$,{variant:"secondary",size:"sm",onClick:()=>tu(!0),children:[(0,s.jsx)(S.A,{className:"w-4 h-4 mr-1"}),"zh"===eO?"添加数据":"Add Data"]})]}),(0,s.jsxs)("div",{className:"space-y-1 max-h-40 overflow-auto pr-1",children:[0===Object.entries(tl.dataSources||{}).length&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground px-1",children:"zh"===eO?"尚未添加数据源":"No data sources yet"}),Object.entries(tl.dataSources||{}).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex items-center gap-2 border rounded-md px-2 py-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,s.jsx)(C.A,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{className:"font-medium",children:(null==a?void 0:a.label)||t})]}),(0,s.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-100 text-gray-600",children:null==a?void 0:a.type}),(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>a7(t),children:(0,s.jsx)(N.A,{className:"w-4 h-4"})})]})]},t)})]})]}),(0,s.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,s.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center justify-between",children:[(0,s.jsx)("span",{children:"zh"===eO?"数据映射":"Field Mapping"}),(0,s.jsx)("span",{className:"text-[10px] text-muted-foreground",children:"zh"===eO?"将卡片入参字段映射到所选数据源表字段":"Map card input fields to table fields"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[0===Object.entries(tC||{}).length&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground px-1",children:"zh"===eO?"等待子页面选择数据源后将自动出现映射项":"Mappings will appear after selecting data source in preview"}),Object.entries(tC||{}).map(e=>{var t;let[a,i]=e,l=t$(i.inputs||{}),r=tO[a]||i.dataSourceKey||"",o=tT[r]||[],c=tD[a]||{};return(0,s.jsxs)("div",{className:"border rounded-md p-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"text-xs font-medium",children:[i.cardName||i.cardType," → ",(0,s.jsx)("span",{className:"text-muted-foreground",children:(null===(t=(tl.dataSources||{})[r])||void 0===t?void 0:t.label)||i.dataSourceLabel||r||"-"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"text-[10px] text-muted-foreground",children:new Date(i.timestamp).toLocaleString()}),(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>tF(a),children:(0,s.jsx)(N.A,{className:"w-4 h-4"})})]})]}),0===l.length?(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"暂无卡片入参字段":"No input fields"}):(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:l.map(e=>{var t;return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"text-xs w-40 truncate",title:e,children:e}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)(B.l6,{disabled:0===o.length||!r,value:o.length>0&&null!==(t=c[e])&&void 0!==t?t:void 0,onValueChange:t=>tB(a,e,t),children:[(0,s.jsx)(B.bq,{className:"max-w-[80px] w-full truncate",children:(0,s.jsx)(B.yv,{placeholder:"zh"===eO?"选择字段":"Choose field"})}),(0,s.jsx)(B.gC,{children:0===o.length?(0,s.jsx)(B.eb,{disabled:!0,value:"__no_fields__",children:"zh"===eO?"（无可用字段）":"(no fields)"}):o.map(e=>(0,s.jsx)(B.eb,{value:String(e.key),children:e.label||String(e.key)},String(e.key)))})]})}),(0,s.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>tJ(a,e),title:"zh"===eO?"清除该字段映射":"Clear mapping",children:(0,s.jsx)(z.A,{className:"w-4 h-4"})})]},"".concat(a,"::").concat(e))})})]},a)})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"主内容":"Main Content"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(as[al]||[]).map(e=>(0,s.jsxs)("div",{className:"px-3 py-2 rounded-xl border bg-white flex items-center justify-between",children:[(0,s.jsx)("span",{className:"truncate text-sm text-foreground",children:e.displayName||e.type}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>{try{var t,a,s;let i=null===(a=tl.pages)||void 0===a?void 0:null===(t=a[tt])||void 0===t?void 0:t.topBar,l=(null==i?void 0:i.enabled)?"tab-".concat(at):"icon-".concat(at),n="pages/".concat(tt,"/cards/").concat(l,"/").concat(e.type,".json");null===(s=window.frames[0])||void 0===s||s.postMessage({type:"GET_OVERRIDE",pageId:tt.replace(/^p-/,""),sectionKey:l,cardType:e.type},"*"),setTimeout(()=>{let t=ag[n]||et();eL(t),to("page"),eM("code"),af(n),aj({pageKey:tt,sectionKey:l,cardType:e.type}),aN("json")},100)}catch(e){}},children:"zh"===eO?"配置":"Config"}),(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>{aI(e.displayName||e.type),a_(e.type),az(!0),aA("1"),aE(!1),aL("time")},children:"zh"===eO?"显示":"Display"}),(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>{try{var t,a,s,i,l,n,r,o;let c=null===(a=tl.pages)||void 0===a?void 0:null===(t=a[tt])||void 0===t?void 0:t.topBar,d=(null==c?void 0:c.enabled)?"tab-".concat(at):"icon-".concat(at);aK(e.displayName||e.type),aH(e.type);let p="";try{let t=localStorage.getItem("APP_PAGE_".concat(tt.replace(/^p-/,""))),a=t?JSON.parse(t):{},s=null==a?void 0:null===(n=a.overrides)||void 0===n?void 0:null===(l=n[d])||void 0===l?void 0:l[e.type],i=null==s?void 0:null===(r=s.filters)||void 0===r?void 0:r.dataSourceKey;i&&(p=String(i))}catch(e){}if(!p)try{let t=Object.entries(tC||{}),a=null===(o=t.find(t=>{let[a,s]=t;return String(null==s?void 0:s.cardType)===String(e.type)}))||void 0===o?void 0:o[1];a&&(a.dataSourceKey?p=String(a.dataSourceKey):a.tableId&&(p="table:".concat(String(a.tableId))))}catch(e){}p||(p=(null===(s=a3[0])||void 0===s?void 0:s.key)||""),aq(p),a5(p),null===(i=window.frames[0])||void 0===i||i.postMessage({type:"GET_OVERRIDE",pageId:tt.replace(/^p-/,""),sectionKey:d,cardType:e.type},"*"),aU(!0)}catch(e){}},children:"zh"===eO?"筛选":"Filter"}),(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>{try{var t,a,s,i;let l=null===(a=tl.pages)||void 0===a?void 0:null===(t=a[tt])||void 0===t?void 0:t.topBar,n=(null==l?void 0:l.enabled)?"tab-".concat(at):"icon-".concat(at),r=(null===(i=tl.pages)||void 0===i?void 0:null===(s=i[tt])||void 0===s?void 0:s.innerPages)&&tl.pages[tt].innerPages[n]&&tl.pages[tt].innerPages[n][e.type];tn(t=>{let a={...t};if(a.pages=a.pages||{},!r){let t="p-".concat(Date.now().toString(36));r=t,a.pages[t]={title:{zh:"".concat(e.displayName||e.type,"内页"),en:"".concat(e.displayName||e.type," Detail")},layout:"mobile",route:"/".concat(t),options:{showBack:!0},cards:[]};let s=a.pages[tt]||{};s.innerPages=s.innerPages||{},s.innerPages[n]=s.innerPages[n]||{},s.innerPages[n][e.type]=t,a.pages[tt]=s}return a}),setTimeout(()=>{try{let t=tl.pages&&tl.pages[r]||{title:{zh:"".concat(e.displayName||e.type,"内页"),en:"".concat(e.displayName||e.type," Detail")},layout:"mobile",route:"/".concat(r)},a={...t,options:{...(null==t?void 0:t.options)||{},showBack:!0}};fetch("http://localhost:3007/api/page-configs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(e=>e.json().catch(()=>null)).then(e=>{var t;let a=e&&(e.id||(null===(t=e.data)||void 0===t?void 0:t.id)),s=new URL("http://localhost:3005/".concat(eO,"/p/").concat(String(r).replace(/^p-/,"")));a&&s.searchParams.set("cfgId",String(a)),eB(s.toString())}).catch(()=>{let e=new URL("http://localhost:3005/".concat(eO,"/p/").concat(String(r).replace(/^p-/,"")));eB(e.toString())}),ta(String(r)),te(!0),eM("preview")}catch(e){}},0)}catch(e){}},children:"zh"===eO?"内页":"Inner"})]})]},e.type)),(!as[al]||0===as[al].length)&&(0,s.jsx)("div",{className:"text-xs opacity-60",children:"zh"===eO?"右侧新增卡片后，将自动出现在这里以配置显示":"New cards added on the right will appear here for display config."})]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"其他卡片":"Other Cards"})]}),(0,s.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,s.jsxs)("label",{className:"flex items-center justify-between border rounded-md px-3 py-2",children:[(0,s.jsx)("span",{children:"zh"===eO?"开启 全局底部导航":"Show Bottom Nav"}),(0,s.jsx)(M.d,{checked:!!(tt&&(null===(ef=tl.pages)||void 0===ef?void 0:null===(ex=ef[tt])||void 0===ex?void 0:null===(ev=ex.options)||void 0===ev?void 0:ev.showBottomNav)!==!1),onCheckedChange:e=>tn(t=>{let a={...t};a.pages=a.pages||{};let s=a.pages[tt]||{};return s.options={...s.options||{},showBottomNav:!!e},a.pages[tt]=s,a})})]}),(0,s.jsx)(n.$,{size:"sm",className:"w-full",onClick:()=>{try{var e;let t=(null===(e=tl.pages)||void 0===e?void 0:e[tt])||{},a=String(e$||"http://localhost:3005/".concat(eO,"/p/").concat(tt.replace(/^p-/,"")));fetch("http://localhost:3007/api/page-configs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json().catch(()=>null)).then(e=>{var t;let s=e&&(e.id||(null===(t=e.data)||void 0===t?void 0:t.id)),i=new URL(a);s&&i.searchParams.set("cfgId",String(s)),eB(i.toString())}).catch(()=>{let e=new URL(a);eB(e.toString())}),eM("preview")}catch(e){}},children:"zh"===eO?"保留浏览":"Keep Preview"})]})]}):(0,s.jsxs)("div",{className:"h-full p-1 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{e6(!1),e8("preview"),eM("preview");try{var e;let t=(null===(e=tl.app)||void 0===e?void 0:e.defaultLanguage)||"zh",a=encodeURIComponent(JSON.stringify((null==tl?void 0:tl.dataSources)||{})),s="http://localhost:3005/".concat(t,"/preview?previewId=").concat(eF,"&device=").concat(eD,"&appId=").concat(eI.appId,"&data=").concat(a);eB(s)}catch(e){}},children:[(0,s.jsx)(k.A,{className:"w-4 h-4 mr-1"}),"zh"===eO?"返回":"Back"]}),(0,s.jsx)("div",{className:"text-sm font-semibold",children:"zh"===eO?"登录配置":"Login Settings"})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"布局模式":"Layout"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"centered"===ts.layoutVariant?"default":"outline",onClick:()=>ti(e=>({...e,layoutVariant:"centered"})),children:"zh"===eO?"居中":"Centered"}),(0,s.jsx)(n.$,{size:"sm",variant:"bottomDocked"===ts.layoutVariant?"default":"outline",onClick:()=>ti(e=>({...e,layoutVariant:"bottomDocked"})),children:"zh"===eO?"底部承载":"Bottom"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"显示元素":"Visibility"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border rounded-md px-3 py-2",children:[(0,s.jsx)("span",{className:"mr-2",children:"zh"===eO?"背景":"Background"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>se(!0),disabled:!ts.showBackground,children:"zh"===eO?"上传":"Upload"}),(0,s.jsx)(M.d,{checked:ts.showBackground,onCheckedChange:e=>ti(t=>({...t,showBackground:!!e}))})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between border rounded-md px-3 py-2",children:[(0,s.jsx)("span",{className:"mr-2",children:"logo"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>sa(!0),disabled:!ts.showLogo,children:"zh"===eO?"上传":"Upload"}),(0,s.jsx)(M.d,{checked:ts.showLogo,onCheckedChange:e=>ti(t=>({...t,showLogo:!!e}))})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between border rounded-md px-3 py-2 col-span-2",children:[(0,s.jsx)("span",{className:"mr-2",children:"zh"===eO?"介绍":"Intro"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>{var e,t,a,s,i,l;sn((null===(e=ts.introTitle)||void 0===e?void 0:e.zh)||(null===(t=ts.introTitle)||void 0===t?void 0:t.en)||""),so((null===(a=ts.introText)||void 0===a?void 0:a.zh)||(null===(s=ts.introText)||void 0===s?void 0:s.en)||""),sd((null===(i=ts.introTitle)||void 0===i?void 0:i.en)||""),su((null===(l=ts.introText)||void 0===l?void 0:l.en)||""),si(!0)},disabled:!ts.showIntro,children:"zh"===eO?"编辑":"Edit"}),(0,s.jsx)(M.d,{checked:ts.showIntro,onCheckedChange:e=>ti(t=>({...t,showIntro:!!e}))})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"文本设置":"Text Settings"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(v.J,{children:"zh"===eO?"标题颜色":"Title Color"}),(0,s.jsx)(x.p,{type:"color",value:ts.titleColor||"#111111",onChange:e=>ti(t=>({...t,titleColor:e.target.value}))})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(v.J,{children:"zh"===eO?"内容颜色":"Body Color"}),(0,s.jsx)(x.p,{type:"color",value:ts.bodyColor||"#6b7280",onChange:e=>ti(t=>({...t,bodyColor:e.target.value}))})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"登录方式":"Login Methods"}),(0,s.jsx)("div",{className:"space-y-2",children:ts.providers.map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-[20px_1fr_auto] items-center gap-2 border rounded-md px-2 py-2",draggable:"phone"!==e.key,onDragStart:a=>{"phone"!==e.key&&a.dataTransfer.setData("text/plain",String(t))},onDragOver:t=>{"phone"!==e.key&&t.preventDefault()},onDrop:a=>{if("phone"===e.key)return;a.preventDefault();let s=Number(a.dataTransfer.getData("text/plain"));Number.isNaN(s)||s===t||0===s||0===t||ti(e=>{let a=[...e.providers],[i]=a.splice(s,1);return a.splice(t,0,i),{...e,providers:a}})},children:[(0,s.jsx)("div",{className:"cursor-grab active:cursor-grabbing text-muted-foreground flex items-center justify-center opacity-70",children:(0,s.jsx)(c.A,{className:"w-4 h-4"})}),(0,s.jsx)("div",{className:"font-medium text-sm",children:e.label}),(0,s.jsx)(M.d,{checked:e.enabled,onCheckedChange:a=>ti(s=>({...s,providers:s.providers.map((s,i)=>i===t?{...s,enabled:"phone"===e.key||!!a}:s)})),disabled:"phone"===e.key})]},e.key))})]})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:"pc"===eD?"zh"===eO?"PC配置/构建":"PC Config/Build":"zh"===eO?"Mobile配置/构建":"Mobile Config/Build"}),(0,s.jsx)(o.tU,{value:"config",className:"-mr-2",children:(0,s.jsxs)(o.j7,{children:[(0,s.jsx)(o.Xi,{value:"config",children:"zh"===eO?"配置":"Config"}),(0,s.jsx)(o.Xi,{value:"ai",disabled:!0,children:"zh"===eO?"AI 对话（稍后）":"AI (later)"})]})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"默认语言（应用）":"Default Language (App)"}),(0,s.jsxs)("div",{className:"inline-flex items-center gap-2 bg-gray-50 rounded-md p-1 border",children:[(0,s.jsx)(n.$,{size:"sm",variant:"zh"===tl.app.defaultLanguage?"default":"ghost",onClick:()=>{tn(e=>({...e,app:{...e.app,defaultLanguage:"zh",locale:"zh-CN"}}))},children:"中文"}),(0,s.jsx)(n.$,{size:"sm",variant:"en"===tl.app.defaultLanguage?"default":"ghost",onClick:()=>{tn(e=>({...e,app:{...e.app,defaultLanguage:"en",locale:"en-US"}}))},children:"EN"})]})]}),!1,"pc"===eD?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(v.J,{children:"zh"===eO?"PC顶部导航（最多8项）":"PC Top Nav (max 8)"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(tl.app.pcTopNav||[]).map((e,t)=>(0,s.jsxs)("div",{className:"space-y-2 p-3 border rounded-lg bg-gray-50",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",String(t))},onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();let a=Number(e.dataTransfer.getData("text/plain"));Number.isNaN(a)||a===t||tn(e=>{let s=[...e.app.pcTopNav||[]],[i]=s.splice(a,1);return s.splice(t,0,i),{...e,app:{...e.app,pcTopNav:s}}})},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"cursor-grab active:cursor-grabbing text-muted-foreground flex items-center justify-center",children:(0,s.jsx)(c.A,{className:"w-4 h-4"})}),(0,s.jsx)(x.p,{value:e.label,onChange:e=>{let a={...tl,app:{...tl.app,pcTopNav:(tl.app.pcTopNav||[]).map((a,s)=>s===t?{...a,label:e.target.value}:a)}};tn(a),setTimeout(()=>{sg(a,!0)},0)},placeholder:"zh"===eO?"导航名称":"Nav Label",className:"flex-1"})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{tn(e=>{let a={...e,app:{...e.app,pcTopNav:(e.app.pcTopNav||[]).filter((e,a)=>a!==t)}};return setTimeout(()=>{sg(a,!0)},0),a})},children:[(0,s.jsx)(N.A,{className:"w-4 h-4 mr-1"}),"zh"===eO?"删除":"Delete"]})})]},e.key)),(tl.app.pcTopNav||[]).length<8&&(0,s.jsx)(n.$,{variant:"secondary",onClick:()=>tn(e=>{let t="pc-".concat(Date.now()),a={...e};return a.app={...a.app,pcTopNav:[...a.app.pcTopNav||[],{key:t,label:"zh"===eO?"新导航":"New Nav"}]},setTimeout(()=>{sg(a,!0)},0),a}),children:"zh"===eO?"添加导航项":"Add Nav Item"})]})]}):(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(v.J,{children:"zh"===eO?"底部导航（最多5项）":"Bottom Nav (max 5)"}),(0,s.jsxs)("div",{className:"space-y-2",children:[tl.app.bottomNav.map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-[20px_1fr_auto_auto_auto] items-center gap-2",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",String(t))},onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();let a=Number(e.dataTransfer.getData("text/plain"));Number.isNaN(a)||a===t||tn(e=>{let s=[...e.app.bottomNav],[i]=s.splice(a,1);return s.splice(t,0,i),{...e,app:{...e.app,bottomNav:s}}})},children:[(0,s.jsx)("div",{className:"cursor-grab active:cursor-grabbing text-muted-foreground flex items-center justify-center",children:(0,s.jsx)(c.A,{className:"w-4 h-4"})}),(0,s.jsx)(x.p,{value:e.label,onChange:e=>tn(a=>({...a,app:{...a.app,bottomNav:a.app.bottomNav.map((a,s)=>s===t?{...a,label:e.target.value}:a)}})),placeholder:"zh"===eO?"名称":"Label"}),(0,s.jsxs)(n.$,{variant:"secondary",size:"sm",onClick:()=>{let t=(e.route||"").replace(/^\//,"")||e.key;if(t){var a,s;try{let s=(null===(a=e.route)||void 0===a?void 0:a.startsWith("/"))?e.route:"/".concat(t),i=new URL("http://localhost:3005/".concat(eO).concat(s));eB(i.toString())}catch(i){let a=(null===(s=e.route)||void 0===s?void 0:s.startsWith("/"))?e.route:"/".concat(t);eB("http://localhost:3005/".concat(eO).concat(a))}ta(t),te(!0),eM("preview")}else e_({description:"zh"===eO?"请先设置路由":"Set route first"})},children:[(0,s.jsx)(w.A,{className:"w-4 h-4 mr-1"}),"zh"===eO?"配置":"Config"]}),(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>{tn(e=>{let a={...e,app:{...e.app,bottomNav:e.app.bottomNav.filter((e,a)=>a!==t)}};return setTimeout(()=>{sg(a,!0)},0),a})},children:(0,s.jsx)(N.A,{className:"w-4 h-4"})})]},e.key)),tl.app.bottomNav.length<5&&(0,s.jsx)(n.$,{variant:"secondary",onClick:()=>tn(e=>{let t="k".concat(Date.now()),a="/p-".concat(t),s={...e};s.app={...s.app,bottomNav:[...s.app.bottomNav,{key:t,label:"zh"===eO?"新项":"Item",route:a}]};let i=(a||"").replace(/^\//,"")||"p-".concat(t);return s.pages=s.pages||{},s.pages[i]||(s.pages[i]={title:{zh:"新页面",en:"New Page"},layout:"mobile",route:a,cards:[]}),s}),children:"zh"===eO?"添加项":"Add Item"})]})]}),(0,s.jsx)("div",{className:"pt-2",children:(0,s.jsx)(n.$,{className:"w-full justify-center",variant:"secondary",onClick:()=>{e6(!0),e8("auth-login"),eM("preview");try{var e;let t=(null===(e=tl.app)||void 0===e?void 0:e.defaultLanguage)||"zh",a={layoutVariant:ts.layoutVariant||"centered",showBackground:!!ts.showBackground,backgroundImage:ts.backgroundImage||void 0,showLogo:!!ts.showLogo,logoImage:ts.logoImage||void 0,showIntro:!!ts.showIntro,introTitle:ts.introTitle||void 0,introText:ts.introText||void 0,titleColor:ts.titleColor||void 0,bodyColor:ts.bodyColor||void 0,providers:(ts.providers||[]).map(e=>({key:e.key,enabled:!!e.enabled}))},s=new URL("http://localhost:3005/".concat(t,"/auth/login"));s.searchParams.set("authCfg",JSON.stringify(a)),s.searchParams.set("v",String(Date.now())),eB(s.toString())}catch(e){}},children:"zh"===eO?"登录配置":"Login Settings"})}),(0,s.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"数据定义":"Data Sources"}),(0,s.jsxs)(n.$,{variant:"secondary",size:"sm",onClick:()=>tu(!0),children:[(0,s.jsx)(S.A,{className:"w-4 h-4 mr-1"}),"zh"===eO?"添加数据":"Add Data"]})]}),(0,s.jsxs)("div",{className:"space-y-1 max-h-40 overflow-auto pr-1",children:[0===Object.entries(tl.dataSources||{}).length&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground px-1",children:"zh"===eO?"尚未添加数据源":"No data sources yet"}),Object.entries(tl.dataSources||{}).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex items-center gap-2 border rounded-md px-2 py-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,s.jsx)(C.A,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{className:"font-medium",children:(null==a?void 0:a.label)||t})]}),(0,s.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-100 text-gray-600",children:null==a?void 0:a.type}),(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>a7(t),children:(0,s.jsx)(N.A,{className:"w-4 h-4"})})]})]},t)})]})]}),(0,s.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,s.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center justify-between",children:[(0,s.jsx)("span",{children:"zh"===eO?"数据映射":"Field Mapping"}),(0,s.jsx)("span",{className:"text-[10px] text-muted-foreground",children:"zh"===eO?"将卡片入参字段映射到所选数据源表字段":"Map card input fields to table fields"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[0===Object.entries(tC||{}).length&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground px-1",children:"zh"===eO?"等待子页面选择数据源后将自动出现映射项":"Mappings will appear after selecting data source in preview"}),Object.entries(tC||{}).map(e=>{var t;let[a,i]=e,l=t$(i.inputs||{}),r=tO[a]||i.dataSourceKey||"",o=tT[r]||[],c=tD[a]||{};return(0,s.jsxs)("div",{className:"border rounded-md p-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"text-xs font-medium",children:[i.cardName||i.cardType," → ",(0,s.jsx)("span",{className:"text-muted-foreground",children:(null===(t=(tl.dataSources||{})[r])||void 0===t?void 0:t.label)||i.dataSourceLabel||r||"-"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"text-[10px] text-muted-foreground",children:new Date(i.timestamp).toLocaleString()}),(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>tF(a),children:(0,s.jsx)(N.A,{className:"w-4 h-4"})})]})]}),0===l.length?(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"暂无卡片入参字段":"No input fields"}):(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:l.map(e=>{var t;return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"text-xs w-40 truncate",title:e,children:e}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)(B.l6,{disabled:0===o.length||!r,value:o.length>0&&null!==(t=c[e])&&void 0!==t?t:void 0,onValueChange:t=>tB(a,e,t),children:[(0,s.jsx)(B.bq,{className:"max-w-[80px] w-full truncate",children:(0,s.jsx)(B.yv,{placeholder:"zh"===eO?"选择字段":"Choose field"})}),(0,s.jsx)(B.gC,{children:0===o.length?(0,s.jsx)(B.eb,{disabled:!0,value:"__no_fields__",children:"zh"===eO?"（无可用字段）":"(no fields)"}):o.map(e=>(0,s.jsx)(B.eb,{value:String(e.key),children:e.label||String(e.key)},String(e.key)))})]})}),(0,s.jsx)(n.$,{size:"sm",variant:"ghost",onClick:()=>tJ(a,e),title:"zh"===eO?"清除该字段映射":"Clear mapping",children:(0,s.jsx)(z.A,{className:"w-4 h-4"})})]},"".concat(a,"::").concat(e))})})]},a)})]})]})]})]})}),(0,s.jsx)(R.lG,{open:tp,onOpenChange:tu,children:(0,s.jsxs)(R.Cf,{className:"max-w-[880px] w-[95vw] max-h-[80vh] bg-white",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{children:"zh"===eO?"选择数据源":"Choose Data Source"})}),(0,s.jsxs)("div",{className:"p-0",children:[(0,s.jsx)("div",{className:"p-3 text-xs text-muted-foreground",children:"zh"===eO?"可选择整张表作为数据源，或展开表选择某条记录作为数据源。":"Choose a whole table or expand to pick a specific record."}),(0,s.jsxs)("div",{className:"px-3 pb-3 flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(x.p,{placeholder:"zh"===eO?"搜索表/模块":"Search tables/modules",value:tx,onChange:e=>tf(e.target.value),className:"pl-8 w-64"}),(0,s.jsx)(I.A,{className:"w-4 h-4 absolute left-2 top-2.5 text-gray-400"})]}),(0,s.jsx)(n.$,{variant:"outline",onClick:tV,disabled:tg,children:"zh"===eO?"刷新":"Refresh"})]}),(0,s.jsx)("div",{className:"px-3 pb-3",children:(0,s.jsx)(L.F,{className:"h-[52vh] border rounded-lg",children:(0,s.jsxs)("div",{className:"divide-y",children:[tg&&(0,s.jsx)("div",{className:"p-4 text-sm text-muted-foreground",children:"zh"===eO?"加载中...":"Loading..."}),!tg&&0===tU.length&&(0,s.jsx)("div",{className:"p-4 text-sm text-muted-foreground",children:"zh"===eO?"暂无数据表":"No tables found"}),tU.map(e=>{let t=ty===e.id,a=tb[e.id],i=!!tw[e.id];return(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"p-1 rounded hover:bg-gray-100",onClick:async()=>{let a=t?null:e.id;tj(a),a&&await a4(e.id)},"aria-label":t?"collapse":"expand",children:t?(0,s.jsx)(T.A,{className:"w-4 h-4"}):(0,s.jsx)(_.A,{className:"w-4 h-4"})}),(0,s.jsx)(C.A,{className:"w-4 h-4 text-blue-600"}),(0,s.jsx)("div",{className:"font-medium",children:e.name}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["/ ",e.moduleName]}),(0,s.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",onClick:()=>a6(e),children:"zh"===eO?"整表":"Whole Table"}),(0,s.jsx)(n.$,{variant:"secondary",size:"sm",onClick:async()=>{tj(e.id),await a4(e.id)},children:"zh"===eO?"选择记录":"Pick Record"})]})]}),t&&(0,s.jsxs)("div",{className:"mt-2 ml-7",children:[i&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground p-2",children:"zh"===eO?"加载记录...":"Loading records..."}),!i&&(a&&a.length>0?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:a.map(t=>(0,s.jsxs)("div",{className:"border rounded-md px-2 py-1.5 flex items-center gap-2",children:[(0,s.jsx)(D.A,{className:"w-3.5 h-3.5 text-gray-500"}),(0,s.jsx)("div",{className:"text-sm truncate",title:t.label,children:t.label}),(0,s.jsx)("div",{className:"ml-auto",children:(0,s.jsx)(n.$,{size:"sm",onClick:()=>(function(e,t){let a="record_".concat(e.id,"_").concat(t.id);tn(s=>{let i={...s};return i.dataSources=i.dataSources||{},i.dataSources[a]={type:"record",tableId:e.id,tableName:e.name,moduleName:e.moduleName,recordId:t.id,label:"".concat(e.moduleName,"/").concat(e.name,"#").concat(t.label)},i}),tu(!1)})(e,t),children:"zh"===eO?"选择":"Select"})})]},t.id))}):(0,s.jsx)("div",{className:"text-xs text-muted-foreground p-2",children:"zh"===eO?"暂无记录":"No records"}))]})]},e.id)})]})})})]}),(0,s.jsx)(R.Es,{children:(0,s.jsx)(n.$,{variant:"outline",onClick:()=>tu(!1),children:"zh"===eO?"关闭":"Close"})})]})}),(0,s.jsx)(J,{open:t7,onOpenChange:t8,lang:eO,pages:Object.keys(tl.pages||{home:{}}),value:(()=>{if(null==t9)return;let e=t4[t9];return null==e?void 0:e.event})(),onSave:e=>{null!=t9&&t6(t=>t.map((t,a)=>a===t9?{...t,event:e}:t))}}),(0,s.jsx)(R.lG,{open:tX,onOpenChange:tY,children:(0,s.jsxs)(R.Cf,{className:"max-w-[760px] w-[95vw] max-h-[85vh] bg-white",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{children:"zh"===eO?"内容导航配置":"Content Navigation"})}),(0,s.jsx)(L.F,{className:"max-h-[62vh] pr-2",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"展示样式":"Display Type"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"iconText"===t1?"default":"outline",onClick:()=>t2("iconText"),children:"zh"===eO?"图+文":"Icon+Text"}),(0,s.jsx)(n.$,{size:"sm",variant:"text"===t1?"default":"outline",onClick:()=>t2("text"),children:"zh"===eO?"文字":"Text"})]})]}),"iconText"===t1&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"排版":"Layout"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"grid-4"===t3?"default":"outline",onClick:()=>t5("grid-4"),children:"zh"===eO?"每行4个":"4 per row"}),(0,s.jsx)(n.$,{size:"sm",variant:"grid-5"===t3?"default":"outline",onClick:()=>t5("grid-5"),children:"zh"===eO?"每行5个":"5 per row"}),(0,s.jsx)(n.$,{size:"sm",variant:"scroll"===t3?"default":"outline",onClick:()=>t5("scroll"),children:"zh"===eO?"横向滑动":"Horizontal scroll"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"导航项":"Items"}),(0,s.jsxs)("div",{className:"space-y-2",children:[t4.map((e,t)=>(0,s.jsxs)("div",{className:"iconText"===t1?"grid grid-cols-[20px_56px_1fr_auto] items-center gap-2 border rounded-md px-2 py-2":"grid grid-cols-[20px_1fr_auto] items-center gap-2 border rounded-md px-2 py-2",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",String(t))},onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault();let a=Number(e.dataTransfer.getData("text/plain"));Number.isNaN(a)||a===t||t6(e=>{let s=[...e],[i]=s.splice(a,1);return s.splice(t,0,i),s})},children:[(0,s.jsx)("div",{className:"cursor-grab active:cursor-grabbing text-muted-foreground flex items-center justify-center opacity-70",children:(0,s.jsx)(c.A,{className:"w-4 h-4"})}),"iconText"===t1&&(0,s.jsx)("div",{className:"flex items-center gap-2",children:e.image?(0,s.jsx)("img",{src:e.image,alt:"icon",className:"w-12 h-12 rounded border object-cover"}):(0,s.jsx)("div",{className:"w-12 h-12 rounded border bg-gray-50 text-[10px] flex items-center justify-center text-gray-400",children:"img"})}),(0,s.jsx)(x.p,{placeholder:"zh"===eO?"标题(中文/英文皆可)":"Title",value:e.title||"",onChange:e=>t6(a=>a.map((a,s)=>s===t?{...a,title:e.target.value}:a))}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["iconText"===t1&&(0,s.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>(function(e){try{let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async t=>{try{var a;let s=null===(a=t.target.files)||void 0===a?void 0:a[0];if(!s)return;let i=await a8(s,256,256,.9);t6(t=>t.map((t,a)=>a===e?{...t,image:i}:t))}catch(e){}},t.click()}catch(e){}})(t),children:"zh"===eO?"上传图片":"Upload"}),(0,s.jsx)(n.$,{size:"sm",variant:"secondary",onClick:()=>{ae(t),t8(!0)},children:"zh"===eO?"事件":"Event"}),(0,s.jsx)(n.$,{size:"icon",variant:"ghost",onClick:()=>t6(e=>e.filter((e,a)=>a!==t)),children:(0,s.jsx)(N.A,{className:"w-4 h-4"})})]})]},t)),(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>t6(e=>[...e,{title:""}]),children:[(0,s.jsx)(S.A,{className:"w-4 h-4 mr-1"}),"zh"===eO?"新增导航":"Add Item"]})]})]})]})}),(0,s.jsxs)(R.Es,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>tY(!1),children:"zh"===eO?"取消":"Cancel"}),(0,s.jsx)(n.$,{onClick:function(){tn(e=>{var t;let a={...e};a.pages=a.pages||{};let s=a.pages[tt]||{},i={category:tQ,style:"text"===t1?"text":"icon",layout:"iconText"===t1?t3:void 0,items:t4};if(null==s?void 0:null===(t=s.topBar)||void 0===t?void 0:t.enabled){let e=s.tabContent||{},t=e[at]||{};e[at]={...t,contentNav:i},s.tabContent=e}else s.contentNav=i;return a.pages[tt]=s,a}),tY(!1)},children:"zh"===eO?"保存":"Save"})]})]})}),(0,s.jsx)(m,{withHandle:!0}),(0,s.jsx)(h,{defaultSize:50,minSize:35,className:"bg-gray-50",children:(0,s.jsxs)("div",{className:"h-full p-3 flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(o.tU,{value:eR,onValueChange:e=>(function(e){if("preview"===e){var t,a;if("auth-login"===e7){let e=(null===(t=tl.app)||void 0===t?void 0:t.defaultLanguage)||("zh"===eO?"zh":"en");eB("http://localhost:3005/".concat(e,"/auth/login")),eM("preview")}else if("home"===e7){let e=(null===(a=tl.app)||void 0===a?void 0:a.defaultLanguage)||("zh"===eO?"zh":"en");try{if(eF){let t=encodeURIComponent(JSON.stringify((null==tl?void 0:tl.dataSources)||{})),a="http://localhost:3005/".concat(e,"/preview?previewId=").concat(eF,"&device=").concat(eD,"&appId=").concat(eI.appId,"&data=").concat(t);eB(a);try{window.localStorage.setItem("PREVIEW_ID",eF),window.localStorage.setItem("APP_ID",String(eI.appId))}catch(e){}}else sh()}catch(e){sh()}eM("preview")}else sh()}else eM("code")})(e),children:(0,s.jsxs)(o.j7,{children:[(0,s.jsx)(o.Xi,{value:"preview",children:"zh"===eO?"预览":"Preview"}),(0,s.jsx)(o.Xi,{value:"code",children:"zh"===eO?"代码":"Code"})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.$,{variant:"default",onClick:sv,disabled:eq,children:eq?"zh"===eO?"保存中...":"Saving...":"zh"===eO?"保存":"Save"}),(0,s.jsx)(n.$,{onClick:sh,children:"zh"===eO?e$?"刷新预览":"生成预览":e$?"Refresh":"Generate"}),(0,s.jsxs)(n.$,{variant:"outline",onClick:sm,children:[(0,s.jsx)(A.A,{className:"w-4 h-4 mr-1"}),"zh"===eO?"新标签打开":"Open in New Tab"]}),(0,s.jsx)(n.$,{variant:"outline",onClick:()=>eE("zh"===eO?"en":"zh"),children:"zh"===eO?"中/EN":"EN/中"}),(0,s.jsx)("a",{href:"http://localhost:3007/docs/apps/".concat(eI.appId,"/swagger"),target:"_blank",rel:"noreferrer",children:(0,s.jsx)(n.$,{variant:"secondary",children:"API"})})]})]}),"code"===eR?(0,s.jsx)("div",{className:"flex-1 min-h-[520px]",children:(0,s.jsxs)(u,{direction:"horizontal",className:"h-full",children:[(0,s.jsxs)(h,{defaultSize:20,minSize:14,className:"bg-white border rounded-xl overflow-auto",children:[(0,s.jsx)("div",{className:"p-2 text-xs text-muted-foreground",children:"zh"===eO?"文件":"Files"}),(0,s.jsxs)("div",{className:"px-2 pb-2 space-y-1",children:[(0,s.jsx)(n.$,{variant:"manifest"===tr?"default":"ghost",className:"w-full justify-start text-xs",onClick:()=>to("manifest"),children:"manifest.json"}),(0,s.jsx)(n.$,{variant:"app"===tr?"default":"ghost",className:"w-full justify-start text-xs",onClick:()=>to("app"),children:"app.json"}),(0,s.jsx)("div",{className:"pt-1 text-[10px] uppercase tracking-wide text-muted-foreground",children:"zh"===eO?"页面":"Pages"}),(0,s.jsx)("div",{className:"space-y-1",children:Object.keys(tl.pages||{}).map(e=>(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)(n.$,{variant:"page"!==tr||tc!==e||ax?"ghost":"default",className:"w-full justify-start text-xs",onClick:()=>{td(e),af(""),aj(null),aN("json"),to("page")},children:["pages/",e,".json"]}),(()=>{let t="pages/".concat(e,"/cards/"),a=Object.keys(ag).filter(e=>e.startsWith(t));return 0===a.length?null:(0,s.jsx)("div",{className:"ml-2 pl-2 border-l space-y-1",children:a.sort().map(a=>{let i=a.slice(t.length).split("/");if(i.length<2)return null;let l=i[0],r=i.slice(1).join("/");if(r.endsWith(".tsx"))return null;let o=ax===a;return(0,s.jsxs)(n.$,{variant:o?"default":"ghost",className:"w-full justify-start text-xs",onClick:()=>{try{let t=a.endsWith(".tsx")?"typescript":"json";td(e),af(a);let s=r.replace(/\.tsx$|\.json$/,""),i=s.includes(".")?s.split(".")[0]:s;aj({pageKey:e,sectionKey:l,cardType:i}),aN(t),eL(ag[a]||""),eM("code"),to("page")}catch(e){}},children:["cards/",l,"/",r]},a)})})})()]},e))}),(0,s.jsx)("div",{className:"pt-1 text-[10px] uppercase tracking-wide text-muted-foreground",children:"data"}),(0,s.jsx)(n.$,{variant:"dataSources"===tr?"default":"ghost",className:"w-full justify-start text-xs",onClick:()=>to("dataSources"),children:"data-sources.json"})]})]}),(0,s.jsx)(m,{withHandle:!0}),(0,s.jsx)(h,{defaultSize:80,minSize:40,children:(0,s.jsx)(Q,{height:"100%",defaultLanguage:ab,language:ab,theme:"vs",value:eP,onChange:e=>{let t=e||"";eL(t),ax&&(aS.current&&clearTimeout(aS.current),aS.current=setTimeout(()=>{try{if(av(e=>({...e,[ax]:t})),ay){var e,a;let s=ay.pageKey.replace(/^p-/,"");if(ax.endsWith(".json")){if(aw.current){aw.current=!1;return}let a=JSON.parse(t||"{}");null===(e=window.frames[0])||void 0===e||e.postMessage({type:"SET_OVERRIDE",pageId:s,sectionKey:ay.sectionKey,cardType:ay.cardType,props:a},"*")}else ax.endsWith(".tsx")&&(null===(a=window.frames[0])||void 0===a||a.postMessage({type:"SET_OVERRIDE",pageId:s,sectionKey:ay.sectionKey,cardType:ay.cardType,jsx:t},"*"))}}catch(e){}},300))},options:{wordWrap:"on",minimap:{enabled:!1},formatOnPaste:!0,formatOnType:!0,tabSize:2},onMount:function(e,t){eK.current=e;try{t.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemas:[{uri:"aino://manifest.schema.json",fileMatch:["*"],schema:E},{uri:"aino://card.schema.json",fileMatch:["**/pages/*/cards/**/*.json"],schema:ee}]})}catch(e){}eV(!0)}})})]})}):(0,s.jsx)("div",{className:"flex-1 border rounded-xl bg-white overflow-hidden",children:e$?(0,s.jsx)("iframe",{id:"my-app-iframe",src:"".concat(e$,"&isEdite=true"),className:"w-full h-full"}):(0,s.jsx)("div",{className:"h-full flex items-center justify-center text-xs text-muted-foreground",children:"zh"===eO?"点击上方预览按钮生成预览":"Switch to Preview to generate"})})]})})]})})}),(0,s.jsx)(F.O,{open:eH,onOpenChange:eG,appId:String(eI.appId),lang:eO}),(0,s.jsx)(R.lG,{open:a9,onOpenChange:se,children:(0,s.jsxs)(R.Cf,{className:"max-w-[520px] w-[92vw] bg-white",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{children:"zh"===eO?"上传背景图":"Upload Background"})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"建议尺寸：1080\xd71920（9:16）":"Suggested: 1080\xd71920 (9:16)"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let s=await a8(a,1080,1920,.82);ti(e=>({...e,backgroundImage:s,showBackground:!0})),se(!1)}}),ts.backgroundImage&&(0,s.jsx)("img",{src:ts.backgroundImage,alt:"bg",className:"mt-2 rounded-md border max-h-64 object-cover"})]}),(0,s.jsx)(R.Es,{children:(0,s.jsx)(n.$,{variant:"outline",onClick:()=>se(!1),children:"zh"===eO?"关闭":"Close"})})]})}),(0,s.jsx)(R.lG,{open:a$,onOpenChange:aB,children:(0,s.jsxs)(R.Cf,{className:"max-w-[560px] w-[96vw] bg-white",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{children:"zh"===eO?"标签管理":"Manage Tabs"})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(v.J,{children:"zh"===eO?"新增标签名称":"New Tab Title"}),(0,s.jsx)(x.p,{value:aR,onChange:e=>aM(e.target.value),placeholder:"zh"===eO?"例如：推荐":"e.g. Featured"})]}),(0,s.jsx)(n.$,{onClick:()=>{try{let e=(aR||"").trim();if(!e)return;let t="tab-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,7));tn(a=>{var s;let i={...a};i.pages=i.pages||{};let l=i.pages[tt]||{},n=Array.isArray(null===(s=l.topBar)||void 0===s?void 0:s.tabs)?l.topBar.tabs:[],r=aF([...Array.isArray(n)?n:[],{id:t,title:e}]);return l.topBar={...l.topBar||{enabled:!0},tabs:r},i.pages[tt]=l,i}),aM("")}catch(e){}},children:"zh"===eO?"新增":"Add"})]}),0===((null===(eb=tl.pages)||void 0===eb?void 0:null===(ej=eb[tt])||void 0===ej?void 0:null===(ey=ej.topBar)||void 0===ey?void 0:ey.tabs)||[]).length&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"暂无标签，请先新增":"No tabs yet. Add one first."}),aF((null===(eS=tl.pages)||void 0===eS?void 0:null===(ew=eS[tt])||void 0===ew?void 0:null===(eN=ew.topBar)||void 0===eN?void 0:eN.tabs)||[]).map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-[24px_1fr_auto] items-center gap-2 border rounded-md px-2 py-2",children:[(0,s.jsx)("div",{className:"text-xs",children:t+1}),(0,s.jsx)(x.p,{className:"h-8",value:e.title||"",onChange:e=>tn(a=>{var s,i;let l={...a};l.pages=l.pages||{};let n=l.pages[tt]||{},r=aF(Array.isArray(null===(s=n.topBar)||void 0===s?void 0:s.tabs)?n.topBar.tabs:[]);return r[t]={...r[t]||{},title:e.target.value,id:(null===(i=r[t])||void 0===i?void 0:i.id)||"tab-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,7))},n.topBar={...n.topBar||{enabled:!0},tabs:r},l.pages[tt]=n,l})}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(n.$,{size:"icon",variant:"ghost",onClick:()=>tn(e=>{var a;let s={...e};s.pages=s.pages||{};let i=s.pages[tt]||{},l=aF(Array.isArray(null===(a=i.topBar)||void 0===a?void 0:a.tabs)?i.topBar.tabs:[]);if(t>0){let e=l[t-1];l[t-1]=l[t],l[t]=e}return i.topBar={...i.topBar||{enabled:!0},tabs:l},s.pages[tt]=i,s}),children:"↑"}),(0,s.jsx)(n.$,{size:"icon",variant:"ghost",onClick:()=>tn(e=>{var a;let s={...e};s.pages=s.pages||{};let i=s.pages[tt]||{},l=aF(Array.isArray(null===(a=i.topBar)||void 0===a?void 0:a.tabs)?i.topBar.tabs:[]);if(t<l.length-1){let e=l[t+1];l[t+1]=l[t],l[t]=e}return i.topBar={...i.topBar||{enabled:!0},tabs:l},s.pages[tt]=i,s}),children:"↓"}),(0,s.jsx)(n.$,{size:"icon",variant:"ghost",onClick:()=>tn(e=>{var a;let s={...e};s.pages=s.pages||{};let i=s.pages[tt]||{},l=aF(Array.isArray(null===(a=i.topBar)||void 0===a?void 0:a.tabs)?i.topBar.tabs:[]);return l.splice(t,1),i.topBar={...i.topBar||{enabled:!0},tabs:l},s.pages[tt]=i,s}),children:"✕"})]})]},"mgr-".concat(e.id||t)))]}),(0,s.jsx)(R.Es,{children:(0,s.jsx)(n.$,{onClick:()=>aB(!1),children:"zh"===eO?"完成":"Done"})})]})}),(0,s.jsx)(R.lG,{open:aJ,onOpenChange:aU,children:(0,s.jsxs)(R.Cf,{className:"max-w-[880px] w-[96vw] max-h-[85vh] bg-white",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{children:"zh"===eO?"筛选设置：".concat(aV):"Filters: ".concat(aV)})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"数据源（表）":"Data Source (Table)"}),(0,s.jsx)("div",{className:"w-80",children:(0,s.jsxs)(B.l6,{value:aG,onValueChange:e=>{aq(e),a5(e)},children:[(0,s.jsx)(B.bq,{children:(0,s.jsx)(B.yv,{placeholder:"zh"===eO?"选择数据源":"Choose data source"})}),(0,s.jsx)(B.gC,{children:a3.map(e=>(0,s.jsx)(B.eb,{value:e.key,children:e.label||e.key},e.key))})]})}),0===a3.length&&(0,s.jsx)("div",{className:"text-[11px] text-muted-foreground",children:"zh"===eO?"请先在左侧添加数据源（整表）。":"Add a table data source first on the left."})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"可作为筛选的字段（来自所选数据源）":"Fields from selected data source"}),(0,s.jsx)(L.F,{className:"max-h-[40vh] border rounded-md",children:(0,s.jsxs)("div",{className:"p-3 space-y-2",children:[aZ&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"加载中...":"Loading..."}),!aZ&&0===aY.length&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"当前数据源无可用字段或数据源未选择。":"No fields for current data source or none selected."}),aY.map(e=>{var t;let a=!!(null===(t=a0[e.key])||void 0===t?void 0:t.__checked);return(0,s.jsxs)("div",{className:"grid grid-cols-[20px_1fr] items-center gap-2 border rounded-md px-2 py-2",children:[(0,s.jsx)($.S,{checked:a,onCheckedChange:t=>a1(a=>({...a,[e.key]:{...a[e.key]||{fieldId:e.key,type:e.type,label:e.label},__checked:!!t}}))}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:e.label}),(0,s.jsx)("span",{className:"text-[10px] text-muted-foreground",children:e.type})]})]},e.key)})]})}),(0,s.jsx)("div",{className:"text-[11px] text-muted-foreground",children:"zh"===eO?"多选字段，仅用于决定出现哪些筛选标签，不在此输入默认值。":"Multi-select fields to show as filter tags; no defaults here."})]})]}),(0,s.jsxs)(R.Es,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>aU(!1),children:"zh"===eO?"取消":"Cancel"}),(0,s.jsx)(n.$,{onClick:async()=>{try{var e,t,a;let s;let i=null===(t=tl.pages)||void 0===t?void 0:null===(e=t[tt])||void 0===e?void 0:e.topBar,l=(null==i?void 0:i.enabled)?"tab-".concat(at):"icon-".concat(at),n=aY.filter(e=>{var t;return null===(t=a0[e.key])||void 0===t?void 0:t.__checked}).map(e=>({fieldId:e.key,type:e.type,label:e.label,options:"select"===e.type?Array.isArray(e.options)?e.options:[]:void 0,optionsTree:"cascader"===e.type?Array.isArray(e.optionsTree)?e.optionsTree:[]:void 0})),r={enabled:!0,dataSourceKey:aG||void 0,fields:n},o=aW||"";null===(a=window.frames[0])||void 0===a||a.postMessage({type:"SET_OVERRIDE",pageId:tt.replace(/^p-/,""),sectionKey:l,cardType:o,filters:r},"*");let c="pages/".concat(tt,"/cards/").concat(l,"/").concat(o,".json"),d=ag[c];if(d)try{let e={...JSON.parse(d||"{}"),filters:r},t=JSON.stringify(e,null,2);av(e=>({...e,[c]:t})),ax===c&&(aw.current=!0,eL(t))}catch(e){}tn(e=>{let t={...e||{}};t.pages=t.pages||{};let a={...t.pages[tt]||{}},i={...a.overrides||{}},n={...i[l]||{}},c={...n[o]||{}};return c.filters=r,n[o]=c,i[l]=n,a.overrides=i,t.pages[tt]=a,s=t,t});try{let e=String(eI.appId),t={};try{let a=await P.api.applications.getApplication(e);t=(a.success&&a.data?a.data.config:{})||{}}catch(e){t={}}let a={...t,clientManifest:s};await P.api.applications.updateApplication(e,{config:a})}catch(e){}}catch(e){}aU(!1)},children:"zh"===eO?"保存":"Save"})]})]})}),(0,s.jsx)(R.lG,{open:aC,onOpenChange:az,children:(0,s.jsxs)(R.Cf,{className:"max-w-[720px] w-[96vw] bg-white/70 backdrop-blur-md rounded-2xl shadow-xl",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{className:"text-base font-semibold",children:"zh"===eO?"显示设置：".concat(ak):"Display: ".concat(ak)})}),(0,s.jsxs)("div",{className:"space-y-5",children:[(0,s.jsxs)("div",{className:"rounded-xl border p-4 bg-white/60",children:[(0,s.jsx)("div",{className:"text-sm font-medium mb-3",children:"zh"===eO?"显示数量":"Limit"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(x.p,{type:"number",min:1,value:aD,onChange:e=>aA(e.target.value),className:"w-28"}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(M.d,{checked:aO,onCheckedChange:e=>aE(!!e)}),(0,s.jsx)("span",{children:"zh"===eO?"无限显示":"Unlimited"})]})]}),(0,s.jsx)("div",{className:"text-[11px] text-muted-foreground mt-2",children:"zh"===eO?"数量越大渲染越多，可能影响性能":"Larger limits may affect performance"})]}),(0,s.jsxs)("div",{className:"rounded-xl border p-4 bg-white/60",children:[(0,s.jsx)("div",{className:"text-sm font-medium mb-3",children:"zh"===eO?"展示来源":"Source"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(n.$,{size:"sm",variant:"pick"===aP?"default":"outline",onClick:()=>aL("pick"),children:"zh"===eO?"指定内容":"Pick"}),(0,s.jsx)(n.$,{size:"sm",variant:"filter"===aP?"default":"outline",onClick:()=>aL("filter"),children:"zh"===eO?"按过滤":"Filter"}),(0,s.jsx)(n.$,{size:"sm",variant:"time"===aP?"default":"outline",onClick:()=>aL("time"),children:"zh"===eO?"按时间":"Time"}),(0,s.jsx)(n.$,{size:"sm",variant:"hot"===aP?"default":"outline",onClick:()=>aL("hot"),children:"zh"===eO?"按热度":"Hot"})]}),"pick"===aP&&(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"zh"===eO?"选择具体内容（占位，后续接数据选择器）":"Pick specific items (placeholder)"}),"filter"===aP&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,s.jsx)(x.p,{placeholder:"zh"===eO?"关键字":"Keyword"}),(0,s.jsx)(x.p,{placeholder:"zh"===eO?"类别（占位）":"Category (placeholder)"}),(0,s.jsx)(x.p,{placeholder:"zh"===eO?"标签（占位）":"Tags (placeholder)"})]}),"time"===aP&&(0,s.jsx)("div",{className:"flex items-center gap-3 text-sm",children:(0,s.jsx)("div",{className:"text-muted-foreground",children:"zh"===eO?"按时间降序":"Newest first"})}),"hot"===aP&&(0,s.jsx)("div",{className:"flex items-center gap-3 text-sm",children:(0,s.jsx)("div",{className:"text-muted-foreground",children:"zh"===eO?"按热度降序":"Hotness desc"})})]})]}),(0,s.jsxs)(R.Es,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>az(!1),children:"zh"===eO?"取消":"Cancel"}),(0,s.jsx)(n.$,{onClick:async()=>{try{var e,t,a;let s;let i=null===(t=tl.pages)||void 0===t?void 0:null===(e=t[tt])||void 0===e?void 0:e.topBar,l=(null==i?void 0:i.enabled)?"tab-".concat(at):"icon-".concat(at),n=aO?void 0:Math.max(1,parseInt(aD||"1",10)),r={mode:aP,limit:n,unlimited:!!aO},o=aT||"";null===(a=window.frames[0])||void 0===a||a.postMessage({type:"SET_OVERRIDE",pageId:tt.replace(/^p-/,""),sectionKey:l,cardType:o,display:r},"*");let c="pages/".concat(tt,"/cards/").concat(l,"/").concat(o,".json"),d=ag[c];if(d)try{let e={...JSON.parse(d||"{}"),display:r},t=JSON.stringify(e,null,2);av(e=>({...e,[c]:t})),ax===c&&(aw.current=!0,eL(t))}catch(e){}tn(e=>{let t={...e||{}};t.pages=t.pages||{};let a={...t.pages[tt]||{}},i={...a.overrides||{}},n={...i[l]||{}},c={...n[o]||{}};return c.display=r,n[o]=c,i[l]=n,a.overrides=i,t.pages[tt]=a,s=t,t});try{let e=String(eI.appId),t={};try{let a=await P.api.applications.getApplication(e);t=(a.success&&a.data?a.data.config:{})||{}}catch(e){t={}}let a={...t,clientManifest:s};await P.api.applications.updateApplication(e,{config:a})}catch(e){}}catch(e){}az(!1)},children:"zh"===eO?"保存":"Save"})]})]})}),(0,s.jsx)(R.lG,{open:ar,onOpenChange:ao,children:(0,s.jsxs)(R.Cf,{className:"max-w-[820px] w-[96vw] max-h-[85vh] bg-white",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{children:"zh"===eO?"配置：".concat(ap):"Config: ".concat(ap)})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"JSON 属性（保存后立即应用到右侧预览）":"JSON props (applies to preview on save)"}),(0,s.jsx)(g.T,{value:ah,onChange:e=>am(e.target.value),rows:16,className:"font-mono text-xs"})]}),(0,s.jsxs)(R.Es,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>ao(!1),children:"zh"===eO?"取消":"Cancel"}),(0,s.jsx)(n.$,{onClick:()=>{try{var e,t,a;let s=null===(t=tl.pages)||void 0===t?void 0:null===(e=t[tt])||void 0===e?void 0:e.topBar,i=(null==s?void 0:s.enabled)?"tab-".concat(at):"icon-".concat(at),l=JSON.parse(ah||"{}");null===(a=window.frames[0])||void 0===a||a.postMessage({type:"SET_OVERRIDE",pageId:tt.replace(/^p-/,""),sectionKey:i,cardType:ac,props:l},"*"),ao(!1)}catch(e){e_({description:(null==e?void 0:e.message)||("zh"===eO?"JSON 无法解析":"Invalid JSON"),variant:"destructive"})}},children:"zh"===eO?"保存":"Save"})]})]})}),(0,s.jsx)(R.lG,{open:st,onOpenChange:sa,children:(0,s.jsxs)(R.Cf,{className:"max-w-[520px] w-[92vw] bg-white",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{children:"Logo"})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"建议：正方形 PNG，至少 256\xd7256":"Square PNG, ≥256\xd7256"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let s=await a8(a,512,512,.9);ti(e=>({...e,logoImage:s,showLogo:!0})),sa(!1)}}),ts.logoImage&&(0,s.jsx)("img",{src:ts.logoImage,alt:"logo",className:"mt-2 rounded-md border size-24 object-cover"})]}),(0,s.jsx)(R.Es,{children:(0,s.jsx)(n.$,{variant:"outline",onClick:()=>sa(!1),children:"zh"===eO?"关闭":"Close"})})]})}),(0,s.jsx)(R.lG,{open:ss,onOpenChange:si,children:(0,s.jsxs)(R.Cf,{className:"max-w-[560px] w-[95vw] bg-white",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{children:"zh"===eO?"编辑介绍":"Edit Intro"})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(v.J,{children:"zh"===eO?"标题（中文）":"Title (ZH)"}),(0,s.jsx)(x.p,{value:sl,onChange:e=>sn(e.target.value),maxLength:30,placeholder:"zh"===eO?"中文标题":"ZH Title"}),(0,s.jsx)(v.J,{className:"mt-2 block",children:"zh"===eO?"标题（英文）":"Title (EN)"}),(0,s.jsx)(x.p,{value:sc,onChange:e=>sd(e.target.value),maxLength:60,placeholder:"zh"===eO?"英文标题":"EN Title"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(v.J,{children:"zh"===eO?"介绍（中文，最多3行）":"Intro ZH (max 3 lines)"}),(0,s.jsx)(g.T,{value:sr,onChange:e=>so(e.target.value),rows:3,maxLength:180,placeholder:"zh"===eO?"中文介绍":"ZH Intro"}),(0,s.jsx)(v.J,{className:"mt-2 block",children:"zh"===eO?"介绍（英文，最多3行）":"Intro EN (max 3 lines)"}),(0,s.jsx)(g.T,{value:sp,onChange:e=>su(e.target.value),rows:3,maxLength:300,placeholder:"zh"===eO?"英文介绍":"EN Intro"}),(0,s.jsx)("div",{className:"text-[10px] text-muted-foreground",children:"zh"===eO?"建议每行约60字以内":"~60 chars per line suggested"})]})]}),(0,s.jsxs)(R.Es,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>si(!1),children:"zh"===eO?"取消":"Cancel"}),(0,s.jsx)(n.$,{onClick:()=>{ti(e=>({...e,introTitle:{zh:sl.trim(),en:sc.trim()},introText:{zh:sr.trim(),en:sp.trim()},showIntro:!0})),si(!1)},children:"zh"===eO?"确定":"OK"})]})]})}),(0,s.jsx)(R.lG,{open:tK,onOpenChange:tW,children:(0,s.jsxs)(R.Cf,{className:"max-w-[520px] w-[92vw] bg-white",children:[(0,s.jsx)(R.c7,{children:(0,s.jsx)(R.L3,{children:"zh"===eO?"设置路由":"Set Route"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(v.J,{children:"zh"===eO?"路由":"Route"}),(0,s.jsx)(x.p,{value:tq,onChange:e=>tZ(e.target.value),placeholder:"/p-kxxxxxxxx or /home"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"zh"===eO?"建议页面使用 /p- 开头的短链接；必须以 / 开头。":"Recommend using short links starting with /p-; must start with /."})]}),(0,s.jsxs)(R.Es,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>tW(!1),children:"zh"===eO?"取消":"Cancel"}),(0,s.jsx)(n.$,{onClick:function(){let e=(tq||"").trim();if(!/^\/[A-Za-z0-9_\-/]*$/.test(e)||e.length<2){e_({description:"zh"===eO?"路由格式不正确，应以 / 开头，可包含字母数字-_/":"Invalid route. Must start with / and contain letters, numbers, - or _.",variant:"destructive"});return}tn(t=>{let a={...t},s=[...a.app.bottomNav];if(null!=tH&&s[tH]){s[tH]={...s[tH],route:e},a.app.bottomNav=s;let t=(e||"").replace(/^\//,"");a.pages=a.pages||{},a.pages[t]||(a.pages[t]={title:{zh:"新页面",en:"New Page"},layout:"mobile",route:e,cards:[]})}return a}),tW(!1)},children:"zh"===eO?"保存":"Save"})]})]})})]})}},47255:(e,t,a)=>{"use strict";a.d(t,{S:()=>r});var s=a(74364);a(10640);var i=a(83382),l=a(27367),n=a(11915);function r(e){let{className:t,...a}=e;return(0,s.jsx)(i.bL,{"data-slot":"checkbox",className:(0,n.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,s.jsx)(i.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,s.jsx)(l.A,{className:"size-3.5"})})})}},69494:(e,t,a)=>{"use strict";a.d(t,{T:()=>l});var s=a(74364);a(10640);var i=a(11915);function l(e){let{className:t,...a}=e;return(0,s.jsx)("textarea",{"data-slot":"textarea",className:(0,i.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}},73475:(e,t,a)=>{"use strict";a.d(t,{LocaleProvider:()=>o,Y:()=>c});var s=a(74364),i=a(10640);let l={brand:"通用无代码构建平台",save:"保存",newApp:"新建应用",appsTitle:"应用构建页",appsSubtitle:"管理已创建的应用或新建",searchApp:"搜索应用...",emptyAppHint:"还没有应用。点击右上角「新建应用」开始吧。",noDesc:"电商+系统模块示例",modulesCount:e=>{let{n:t}=e;return"模块 ".concat(t)},enter:"进入",clone:"克隆",delete:"删除",copySuffix:"（副本）",confirmDeleteApp:"确认删除该应用？",newAppNamePlaceholder:"请输入应用名称",toggleLang:"切换语言",appNotFound:"未找到应用",apps:"应用",directories:"目录（表）",rename:"重命名",addDir:"添加目录",typeCategory:"分类",typeTable:"表",emptyDirHint:"该模块暂无目录，请先添加。",moduleSettings:"模块设置",dirSettings:"目录设置",chooseDirHint:"请选择左侧目录开始操作",searchPlaceholder:"搜索 名称/品牌/标签...",filterByCategory:"按分类筛选",filterByStatus:"按上架状态",all:"全部",statusOn:"上架",statusOff:"下架",addRecord:"新增记录",tabList:"列表",tabFields:"字段管理",tabCategories:"内容分类",listHint:"提示：显示列由「字段管理」中的启用状态决定。单击一行打开右侧详情抽屉。",confirmDeleteRecord:"确认删除该记录？",addModule:"添加模块",module_ecom:"电商类通用模块",module_edu:"教育类通用模块",module_rec:"招聘类通用模块",module_content:"通用内容模块",module_project:"通用项目展示模块",module_custom:"通用自定义模块",renameModule:"模块名",newDirNamePlaceholder:"目录名称",unnamedDir:"未命名目录",chooseTableTpl:"选择表模板（custom/ecom-product/...）",renameDir:"目录名",ft_text:"文本",ft_textarea:"多行文本",ft_number:"数字",ft_select:"单选",ft_multiselect:"多选",ft_boolean:"布尔",ft_date:"日期",ft_time:"时间",ft_tags:"标签",ft_image:"图片",ft_profile:"标识",ft_video:"视频",ft_file:"文件",ft_richtext:"富文本",ft_percent:"百分比",ft_progress:"进度",ft_barcode:"条码",ft_checkbox:"复选框",ft_cascader:"级联选项",ft_relation_one:"关联",ft_relation_many:"多关联",ft_experience:"经历",ft_multiimage:"多图片",ft_multivideo:"多视频",ft_identity_verification:"实名认证",ft_other_verification:"其他认证",ft_meta_items:"数据项集合",fieldManagement:"字段管理",fieldCategoryManagement:"字段分类",recordCategoryManagement:"内容分类",allFields:"全部字段",uncategorized:"未分类",editField:"编辑字段",defaultField:"默认字段",deleteField:"删除",dragToSort:"拖动排序",confirmDeleteField:"确认删除该字段？",basicFields:"基础字段",businessFields:"业务字段",addCategory:"添加分类",addCategoryLoading:"添加中...",addCategoryFailed:"添加分类失败，请重试",categoryName:"分类名称",categoryDescription:"分类描述（可选）",categoryList:"分类列表",fieldList:"字段列表",enabled:"已启用",disabled:"已禁用",showFields:"显示",ofFields:"个字段",selectCategoryToView:"请选择一个字段分类查看详情",confirmDeleteCategory:"确认删除分类",confirmDeleteCategoryWithFields:"该分类包含",fieldsWillMoveToUncategorized:"个字段，删除后这些字段将移至「无分类」。",systemCategoryCannotDelete:"系统分类不能删除",previousPage:"上一页",nextPage:"下一页",fieldCategoryManagement:"字段分类",deleteCategory:"删除分类",recordCategoryManagement:"内容分类管理",addRecordCategory:"添加内容分类",recordCategoryName:"分类名称",recordCategoryDescription:"分类描述",recordCategoryList:"内容分类列表",confirmDeleteRecordCategory:"确认删除该内容分类？",recordCategoryCannotDelete:"该分类下还有记录，不能删除",selectRecordCategory:"选择内容分类",noRecordCategory:"无分类",typeChangeWarning:"更改字段类型会尝试转换已有数据，可能造成数据丢失，是否继续？",saveField:"保存字段",selfModule:"自主模块",thirdPartyModule:"第三方模块",searchModulePlaceholder:"搜索模块名称、提供商或描述...",allCategories:"所有类别",provider:"提供商",version:"版本",downloads:"下载",rating:"评分",install:"安装",noMatchingModules:"没有找到匹配的模块",noPermissionToDelete:"当前角色无权删除",noPermissionToBulkDelete:"当前角色无权批量删除",confirmDeleteRecord:"确认删除该记录？",confirmBulkDeleteRecords:"确认批量删除选中的",records:"条记录？",bulkDeleteCompleted:"批量删除完成",bulkDeleteSelected:"批量删除选中项",bulkDelete:"批量删除",clearSelection:"清除选择",selected:"已选择",items:"项",dynamicRecordAdded:"动态记录已添加",pleaseEnterDynamicContent:"请输入动态内容",userRecord:"用户记录",systemInfo:"系统信息",behaviorDynamic:"行为动态",other:"其他",addUserRecord:"添加用户记录",recordContent:"记录内容",enterUserRecordContent:"请输入用户记录内容...",addRecord:"添加记录",historyRecord:"历史记录",category:"分类",basicInfo:"基本资料",dynamicRecord:"动态记录",saveChanges:"保存更改",saved:"已保存"},n={brand:"Universal No-code Builder",save:"Save",newApp:"New App",appsTitle:"App Builder",appsSubtitle:"Manage existing apps or create a new one",searchApp:"Search apps...",emptyAppHint:"No app yet. Click New App to start.",noDesc:"E-commerce + system modules demo",modulesCount:e=>{let{n:t}=e;return"Modules ".concat(t)},enter:"Enter",clone:"Clone",delete:"Delete",copySuffix:" (copy)",confirmDeleteApp:"Delete this app?",newAppNamePlaceholder:"Enter app name",toggleLang:"Toggle language",appNotFound:"App not found",apps:"Apps",directories:"Directories (Tables)",rename:"Rename",addDir:"Add Directory",typeCategory:"Category",typeTable:"Table",emptyDirHint:"No directory in this module. Add one first.",moduleSettings:"Module Settings",dirSettings:"Directory Settings",chooseDirHint:"Pick a directory from the left to start",searchPlaceholder:"Search name/brand/tags...",filterByCategory:"Filter by category",filterByStatus:"Filter by status",all:"All",statusOn:"Online",statusOff:"Offline",addRecord:"Add Record",tabList:"List",tabFields:"Fields",tabCategories:"Content Categories",listHint:"Columns are controlled in Fields tab. Click a row to open the right drawer.",confirmDeleteRecord:"Delete this record?",addModule:"Add Module",module_ecom:"E-commerce module",module_edu:"Education module",module_content:"Content module",module_project:"Project showcase module",module_custom:"Custom module",renameModule:"Module name",newDirNamePlaceholder:"Directory name",unnamedDir:"Untitled directory",chooseTableTpl:"Choose table template (custom/ecom-product/...)",renameDir:"Directory name",ft_text:"Text",ft_textarea:"Textarea",ft_number:"Number",ft_select:"Single Select",ft_multiselect:"Multi Select",ft_boolean:"Boolean",ft_date:"Date",ft_time:"Time",ft_tags:"Tags",ft_image:"Image",ft_profile:"Profile",ft_video:"Video",ft_file:"File",ft_richtext:"Rich Text",ft_percent:"Percent",ft_progress:"Progress",ft_barcode:"Barcode",ft_checkbox:"Checkbox",ft_cascader:"Cascader",ft_relation_one:"Relation",ft_relation_many:"Multi-relation",ft_experience:"Experience",ft_multiimage:"Multi Image",ft_multivideo:"Multi Video",ft_identity_verification:"Identity Verification",ft_other_verification:"Other Verification",ft_meta_items:"Meta Items",fieldManagement:"Field Management",fieldCategoryManagement:"Field Categories",recordCategoryManagement:"Content Categories",allFields:"All Fields",uncategorized:"Uncategorized",editField:"Edit Field",defaultField:"Default Field",deleteField:"Delete",dragToSort:"Drag to sort",confirmDeleteField:"Confirm delete this field?",basicFields:"Basic Fields",businessFields:"Business Fields",addCategory:"Add Category",addCategoryLoading:"Adding...",addCategoryFailed:"Failed to add category, please try again",categoryName:"Category Name",categoryDescription:"Category Description (Optional)",categoryList:"Category List",fieldList:"Field List",enabled:"Enabled",disabled:"Disabled",showFields:"Showing",ofFields:"fields",selectCategoryToView:"Please select a field category to view details",confirmDeleteCategory:"Confirm delete category",confirmDeleteCategoryWithFields:"This category contains",fieldsWillMoveToUncategorized:"fields, they will be moved to 'Uncategorized' after deletion.",systemCategoryCannotDelete:"System categories cannot be deleted",previousPage:"Previous",nextPage:"Next",fieldCategoryManagement:"Field Category",deleteCategory:"Delete Category",recordCategoryManagement:"Content Category Management",addRecordCategory:"Add Content Category",recordCategoryName:"Category Name",recordCategoryDescription:"Category Description",recordCategoryList:"Content Category List",confirmDeleteRecordCategory:"Confirm delete this content category?",recordCategoryCannotDelete:"This category contains records and cannot be deleted",selectRecordCategory:"Select Content Category",noRecordCategory:"No Category",typeChangeWarning:"Changing field type will attempt to convert existing data, which may cause data loss. Continue?",saveField:"Save Field",selfModule:"Self Module",thirdPartyModule:"Third-party Module",searchModulePlaceholder:"Search module name, provider or description...",allCategories:"All Categories",provider:"Provider",version:"Version",downloads:"Downloads",rating:"Rating",install:"Install",noMatchingModules:"No matching modules found",noPermissionToDelete:"Current role has no permission to delete",noPermissionToBulkDelete:"Current role has no permission to bulk delete",confirmDeleteRecord:"Confirm delete this record?",confirmBulkDeleteRecords:"Confirm bulk delete selected",records:"records?",bulkDeleteCompleted:"Bulk delete completed",bulkDeleteSelected:"Bulk delete selected items",bulkDelete:"Bulk Delete",clearSelection:"Clear Selection",selected:"Selected",items:"items",dynamicRecordAdded:"Dynamic record added",pleaseEnterDynamicContent:"Please enter dynamic content",userRecord:"User Record",systemInfo:"System Info",behaviorDynamic:"Behavior Dynamic",other:"Other",addUserRecord:"Add User Record",recordContent:"Record Content",enterUserRecordContent:"Please enter user record content...",addRecord:"Add Record",historyRecord:"History Record",category:"Category",basicInfo:"Basic Info",dynamicRecord:"Dynamic Record",saveChanges:"Save Changes",saved:"Saved"},r=(0,i.createContext)(null);function o(e){let{children:t}=e,[a,o]=(0,i.useState)("zh"),[c,d]=(0,i.useState)(!1);(0,i.useEffect)(()=>{d(!0),o(localStorage.getItem("nocode_locale")||"zh")},[]),(0,i.useEffect)(()=>{c&&localStorage.setItem("nocode_locale",a)},[a,c]);let p="zh"===a?l:n;return(0,s.jsx)(r.Provider,{value:{locale:a,t:function(e,t){let a=p[e];return"function"==typeof a?a(t):null!=a?a:String(e)},toggleLocale:function(){o(e=>"zh"===e?"en":"zh")}},children:t})}function c(){let e=(0,i.useContext)(r);if(!e)throw Error("useLocale must be used within a LocaleProvider");return e.locale?e:{locale:"zh",t:(e,t)=>{let a=l[e];return"function"==typeof a?a(t):null!=a?a:String(e)},toggleLocale:()=>{}}}},91562:(e,t,a)=>{Promise.resolve().then(a.bind(a,24470))}},e=>{var t=t=>e(e.s=t);e.O(0,[2189,2144,4243,926,5275,5880,516,6520,1650,3294,1538,8380,1139,7358],()=>t(91562)),_N_E=e.O()}]);