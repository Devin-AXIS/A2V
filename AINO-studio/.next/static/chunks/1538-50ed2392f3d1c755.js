"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1538],{1331:(e,t,a)=>{a.d(t,{AM:()=>i,Wv:()=>l,hl:()=>o});var r=a(74364);a(10640);var s=a(38032),n=a(11915);function i(e){let{...t}=e;return(0,r.jsx)(s.bL,{"data-slot":"popover",...t})}function l(e){let{...t}=e;return(0,r.jsx)(s.l9,{"data-slot":"popover-trigger",...t})}function o(e){let{className:t,align:a="center",sideOffset:i=4,...l}=e;return(0,r.jsx)(s.ZL,{children:(0,r.jsx)(s.UC,{"data-slot":"popover-content",align:a,sideOffset:i,className:(0,n.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...l})})}},8639:(e,t,a)=>{a.d(t,{F:()=>i});var r=a(74364);a(10640);var s=a(92917),n=a(11915);function i(e){let{className:t,children:a,...i}=e;return(0,r.jsxs)(s.bL,{"data-slot":"scroll-area",className:(0,n.cn)("relative",t),...i,children:[(0,r.jsx)(s.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),(0,r.jsx)(l,{}),(0,r.jsx)(s.OK,{})]})}function l(e){let{className:t,orientation:a="vertical",...i}=e;return(0,r.jsx)(s.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:(0,n.cn)("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",t),...i,children:(0,r.jsx)(s.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}},19250:(e,t,a)=>{a.d(t,{V:()=>g});var r=a(35815),s=a(74364),n=a(10640),i=a(32826),l=a(96619),o=a(53107),d=a(3311),c=a(36084),u=a(11915),p=a(5660);function m(){let e=(0,r._)(["rtl:**:[.rdp-button_next>svg]:rotate-180"],["rtl:**:[.rdp-button\\_next>svg]:rotate-180"]);return m=function(){return e},e}function h(){let e=(0,r._)(["rtl:**:[.rdp-button_previous>svg]:rotate-180"],["rtl:**:[.rdp-button\\_previous>svg]:rotate-180"]);return h=function(){return e},e}function g(e){let{className:t,classNames:a,showOutsideDays:r=!0,captionLayout:n="label",buttonVariant:g="ghost",formatters:f,components:y,...v}=e,b=(0,d.a)();return(0,s.jsx)(c.h,{showOutsideDays:r,className:(0,u.cn)("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw(m()),String.raw(h()),t),captionLayout:n,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...f},classNames:{root:(0,u.cn)("w-fit",b.root),months:(0,u.cn)("flex gap-4 flex-col md:flex-row relative",b.months),month:(0,u.cn)("flex flex-col w-full gap-4",b.month),nav:(0,u.cn)("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",b.nav),button_previous:(0,u.cn)((0,p.r)({variant:g}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",b.button_previous),button_next:(0,u.cn)((0,p.r)({variant:g}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",b.button_next),month_caption:(0,u.cn)("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",b.month_caption),dropdowns:(0,u.cn)("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",b.dropdowns),dropdown_root:(0,u.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",b.dropdown_root),dropdown:(0,u.cn)("absolute bg-popover inset-0 opacity-0",b.dropdown),caption_label:(0,u.cn)("select-none font-medium","label"===n?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",b.caption_label),table:"w-full border-collapse",weekdays:(0,u.cn)("flex",b.weekdays),weekday:(0,u.cn)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",b.weekday),week:(0,u.cn)("flex w-full mt-2",b.week),week_number_header:(0,u.cn)("select-none w-(--cell-size)",b.week_number_header),week_number:(0,u.cn)("text-[0.8rem] select-none text-muted-foreground",b.week_number),day:(0,u.cn)("relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",b.day),range_start:(0,u.cn)("rounded-l-md bg-accent",b.range_start),range_middle:(0,u.cn)("rounded-none",b.range_middle),range_end:(0,u.cn)("rounded-r-md bg-accent",b.range_end),today:(0,u.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",b.today),outside:(0,u.cn)("text-muted-foreground aria-selected:text-muted-foreground",b.outside),disabled:(0,u.cn)("text-muted-foreground opacity-50",b.disabled),hidden:(0,u.cn)("invisible",b.hidden),...a},components:{Root:e=>{let{className:t,rootRef:a,...r}=e;return(0,s.jsx)("div",{"data-slot":"calendar",ref:a,className:(0,u.cn)(t),...r})},Chevron:e=>{let{className:t,orientation:a,...r}=e;return"left"===a?(0,s.jsx)(i.A,{className:(0,u.cn)("size-4",t),...r}):"right"===a?(0,s.jsx)(l.A,{className:(0,u.cn)("size-4",t),...r}):(0,s.jsx)(o.A,{className:(0,u.cn)("size-4",t),...r})},DayButton:x,WeekNumber:e=>{let{children:t,...a}=e;return(0,s.jsx)("td",{...a,children:(0,s.jsx)("div",{className:"flex size-(--cell-size) items-center justify-center text-center",children:t})})},...y},...v})}function x(e){let{className:t,day:a,modifiers:r,...i}=e,l=(0,d.a)(),o=n.useRef(null);return n.useEffect(()=>{var e;r.focused&&(null===(e=o.current)||void 0===e||e.focus())},[r.focused]),(0,s.jsx)(p.$,{ref:o,variant:"ghost",size:"icon","data-day":a.date.toLocaleDateString(),"data-selected-single":r.selected&&!r.range_start&&!r.range_end&&!r.range_middle,"data-range-start":r.range_start,"data-range-end":r.range_end,"data-range-middle":r.range_middle,className:(0,u.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",l.day,t),...i})}},24767:(e,t,a)=>{a.d(t,{C:()=>o,z:()=>l});var r=a(74364);a(10640);var s=a(92756),n=a(51137),i=a(11915);function l(e){let{className:t,...a}=e;return(0,r.jsx)(s.bL,{"data-slot":"radio-group",className:(0,i.cn)("grid gap-3",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)(s.q7,{"data-slot":"radio-group-item",className:(0,i.cn)("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,r.jsx)(s.C1,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,r.jsx)(n.A,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}},55132:(e,t,a)=>{a.d(t,{d:()=>i});var r=a(74364);a(10640);var s=a(69262),n=a(11915);function i(e){let{className:t,...a}=e;return(0,r.jsx)(s.bL,{"data-slot":"switch",className:(0,n.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,r.jsx)(s.zi,{"data-slot":"switch-thumb",className:(0,n.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}},74395:(e,t,a)=>{a.d(t,{O:()=>E});var r=a(74364),s=a(10640),n=a(53380),i=a(11915);function l(e){let{...t}=e;return(0,r.jsx)(n._s.Root,{"data-slot":"drawer",...t})}function o(e){let{...t}=e;return(0,r.jsx)(n._s.Portal,{"data-slot":"drawer-portal",...t})}function d(e){let{className:t,...a}=e;return(0,r.jsx)(n._s.Overlay,{"data-slot":"drawer-overlay",className:(0,i.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function c(e){let{className:t,children:a,...s}=e;return(0,r.jsxs)(o,{"data-slot":"drawer-portal",children:[(0,r.jsx)(d,{}),(0,r.jsxs)(n._s.Content,{"data-slot":"drawer-content",className:(0,i.cn)("group/drawer-content bg-background fixed z-50 flex h-auto flex-col","data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b","data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t","data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm","data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",t),...s,children:[(0,r.jsx)("div",{className:"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block"}),a]})]})}function u(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"drawer-header",className:(0,i.cn)("flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",t),...a})}function p(e){let{className:t,...a}=e;return(0,r.jsx)(n._s.Title,{"data-slot":"drawer-title",className:(0,i.cn)("text-foreground font-semibold",t),...a})}function m(e){let{className:t,...a}=e;return(0,r.jsx)(n._s.Description,{"data-slot":"drawer-description",className:(0,i.cn)("text-muted-foreground text-sm",t),...a})}var h=a(8639),g=a(5660),x=a(74688),f=a(69494),y=a(56318),v=a(24767),b=a(76572),j=a(1331),w=a(19250);let k=0,N=new Map,S=e=>{if(N.has(e))return;let t=setTimeout(()=>{N.delete(e),D({type:"REMOVE_TOAST",toastId:e})},1e6);N.set(e,t)},C=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?S(a):e.toasts.forEach(e=>{S(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},A=[],_={toasts:[]};function D(e){_=C(_,e),A.forEach(e=>{e(_)})}function T(e){let{...t}=e,a=(k=(k+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>D({type:"DISMISS_TOAST",toastId:a});return D({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>D({type:"UPDATE_TOAST",toast:{...e,id:a}})}}var O=a(8893);let z=e=>Object.prototype.toString.call(e).split(" ")[1].split("]")[0],M=(e,t)=>{let a=e.split("."),r=t;for(let e=0;e<a.length;e++)if("Array"===z(r=r[a[e]]))return[r,a[e+1]];return[r]};function E(e){let{open:t,onOpenChange:a,appId:n,lang:i="zh",dirId:o,dirName:d,dirFields:k}=e,{toast:N}=function(){let[e,t]=s.useState(_);return s.useEffect(()=>(A.push(t),()=>{let e=A.indexOf(t);e>-1&&A.splice(e,1)}),[e]),{...e,toast:T,dismiss:e=>D({type:"DISMISS_TOAST",toastId:e})}}(),[S,C]=(0,s.useState)("firecrawl"),[E,L]=(0,s.useState)(""),[I,$]=(0,s.useState)(""),[F,K]=(0,s.useState)(""),[U,P]=(0,s.useState)("weekdays"),[R,J]=(0,s.useState)("06:00"),[q,W]=(0,s.useState)(["Mon","Tue","Wed","Thu","Fri"]),[B,V]=(0,s.useState)(Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Shanghai"),[G,H]=(0,s.useState)(""),[X,Z]=(0,s.useState)("url"),[Q,Y]=(0,s.useState)(!1),[ee,et]=(0,s.useState)(!1),[ea,er]=(0,s.useState)(!1),[es,en]=(0,s.useState)("1"),[ei,el]=(0,s.useState)(""),eo=(e,t)=>"zh"===i?e:t,ed=(0,s.useMemo)(()=>({items:Array.from({length:6}).map((e,t)=>({title:"Senior Frontend Engineer ".concat(t+1),desc:"React/Next.js \xb7 TypeScript \xb7 UI/UX",salary:2e4+1e3*t,city:["北京","上海","深圳"][t%3],company:["AINO","Axis","Nova"][t%3],link:"https://jobs.example.com/".concat(t+1),posted_at:"2025-09-01"})),data:[{name:"fallback"}],results:[]}),[]),[ec,eu]=(0,s.useState)("$.items"),[ep,em]=(0,s.useState)(null),eh=(0,s.useMemo)(()=>ep||("$.items"===ec?ed.items:"$.data"===ec?ed.data:"$.results"===ec?ed.results:[]),[ec,ed,ep]),[eg,ex]=(0,s.useState)(""),[ef,ey]=(0,s.useState)(""),[ev,eb]=(0,s.useState)({}),[ej,ew]=(0,s.useState)(""),[ek,eN]=(0,s.useState)(!1),[eS,eC]=(0,s.useState)({total:0,done:0,ok:0,fail:0}),eA=(0,s.useMemo)(()=>{if(Array.isArray(k)&&k.length>0){let e=[];return k.map(t=>{if("meta_items"===t.type)t.metaItemsConfig.fields.map(a=>{e.push({parentKey:t.key,key:"".concat(t.key,"::").concat(a.id),label:"".concat(t.label||t.key,"-").concat(a.label),originLabel:a.label,type:a.type,required:!!a.required})});else{let a={key:t.key,label:t.label||t.key,type:t.type||"text",required:!!t.required};e.push(a)}}),e}return[{key:"title",label:eo("标题","Title"),type:"text",required:!0},{key:"description",label:eo("描述","Description"),type:"text"},{key:"salary",label:eo("薪资","Salary"),type:"number"},{key:"city",label:eo("城市","City"),type:"text"},{key:"company",label:eo("公司","Company"),type:"text"},{key:"url",label:"URL",type:"url"}]},[k,i]),[e_,eD]=(0,s.useState)(1),eT=Math.max(1,Math.ceil(eA.length/10)),eO=(0,s.useMemo)(()=>eA.slice((e_-1)*10,10*e_),[eA,e_]),[ez,eM]=(0,s.useState)({}),[eE,eL]=(0,s.useState)({}),[eI,e$]=(0,s.useState)({}),[eF,eK]=(0,s.useState)([]),[eU,eP]=(0,s.useState)(""),[eR,eJ]=(0,s.useState)(""),[eq,eW]=(0,s.useState)("");function eB(e){return e?e.startsWith("$.")||"$"===e?e:e.startsWith("$")?"$.".concat(e.slice(1)):"$.".concat(e):e}(0,s.useEffect)(()=>{if(eh&&eh.length>0){let e=function(e){if(!e||0===e.length)return[];let t=new Set,a=e[0];return a&&"object"==typeof a&&function e(a){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";for(let[s,n]of Object.entries(a)){let a=r?"".concat(r,".").concat(s):s;null!=n&&("string"==typeof n||"number"==typeof n||"boolean"==typeof n)?t.add(a):n&&"object"==typeof n&&!Array.isArray(n)?e(n,a):Array.isArray(n)&&(t.add(a),n.length>0&&n[0]&&"object"==typeof n[0]&&e(n[0],a))}}(a),Array.from(t).sort()}(eh),t=(eB(ec)||"").replace(/^\$\.?/,"").split(".").filter(Boolean),a=[];for(let e=1;e<=t.length;e++)a.push(t.slice(t.length-e).join("."));let r=e.flatMap(e=>a.map(t=>"".concat(t,".").concat(e))),s=r.map(e=>eB(e)),n=e.map(e=>(function(e,t){let a=eB(t||"$"),r=e.replace(/^\$\.?/,""),s=a.endsWith(".")||"$"===a?"":".";return"".concat(a).concat(s).concat(r)})(e,ec)),i=Array.from(new Set([...e,...r,...s,...n])).sort();eK(i),function(e){let t={},a={title:["title","name","job_title","position","职位","岗位","名称","jobName","positionName"],description:["description","desc","content","detail","描述","内容","详情","介绍","jobDesc","jobDescription"],salary:["salary","pay","wage","薪资","工资","待遇","报酬","money","compensation"],city:["city","location","address","城市","地点","地址","位置","area","region"],company:["company","employer","corp","公司","企业","雇主","companyName","employerName"],url:["url","link","href","链接","网址","jobUrl","detailUrl"],date:["date","time","created","posted","日期","时间","发布时间","publishTime","createTime"],experience:["experience","exp","years","经验","年限","workExp","workExperience"],education:["education","degree","学历","学位","edu","educationLevel"],type:["type","category","kind","类型","分类","jobType","category"],level:["level","grade","级别","等级","jobLevel","positionLevel"],skills:["skills","requirements","技能","要求","要求技能","jobSkills","requiredSkills"],benefits:["benefits","perks","福利","待遇","jobBenefits","companyBenefits"]};for(let r of eA){let s=e.find(e=>{var t;return null===(t=a[r.key])||void 0===t?void 0:t.some(t=>e.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(e.toLowerCase()))});if(s){t[r.key]=s;continue}let n=e.find(e=>e.toLowerCase().includes(r.key.toLowerCase().slice(0,4))||r.key.toLowerCase().includes(e.toLowerCase().slice(0,4)));n&&(t[r.key]=n)}eM(t),Object.keys(t).length>0&&N({description:eo("已自动匹配采集数据字段","Auto matched scraped data fields")})}(i)}},[eh]);let eV=[{value:"none",label:eo("无","None")},{value:"trim",label:"trim"},{value:"toNumber",label:"toNumber"},{value:"parseDate",label:"parseDate"},{value:"splitTags",label:"splitTags"}];function eG(e,t){return"number"===e?"number"==typeof t?"none":"toNumber":"date"===e?"parseDate":"tags"===e||"multiselect"===e?Array.isArray(t)?"none":"splitTags":"text"===e?"trim":"none"}let eH=(0,s.useMemo)(()=>{try{var e;let t=function e(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!t||r>2)return s;if(Array.isArray(t))return t.length>0&&e(t[0],a,r+1,s),s;if("object"==typeof t)for(let n of Object.keys(t)){let i=a?"".concat(a,".").concat(n):n;s.push(i),"object"==typeof t[n]&&e(t[n],i,r+1,s)}return s}(null!==(e=null==eh?void 0:eh[0])&&void 0!==e?e:{});return Array.from(new Set([...t,...eF])).sort()}catch(e){return eF}},[eh]);function eX(e,t){if(!e||!t)return;console.log("\uD83D\uDD0D getByPath 输入:",{obj:e,path:t,arrayPath:ec});let a=t.replace(/^\$\.?/,""),r=eB(ec).replace(/^\$\.?/,"");r&&a.startsWith(r)&&(a=a.slice(r.length)).startsWith(".")&&(a=a.slice(1)),console.log("\uD83D\uDD0D 处理后的路径:",a);let s=a.split(".").filter(Boolean),n=e;for(let e of s)if(console.log("\uD83D\uDD0D 访问路径部分: ".concat(e,", 当前值:"),n),n&&"object"==typeof n)console.log("\uD83D\uDD0D 获取到值:",n=n[e]);else{console.log("\uD83D\uDD0D 路径中断，返回 undefined");return}return console.log("\uD83D\uDD0D 最终结果:",n),n}function eZ(e){if("number"==typeof e)return e;if("string"==typeof e){let t=e.match(/([0-9]+(?:\.[0-9]+)?)/);if(t)return Number(t[1])}return Number(e)||0}async function eQ(){try{if(!o){N({description:eo("缺少目录ID，无法入库","Missing directory id"),variant:"destructive"});return}if(!eh||0===eh.length){N({description:eo("暂无样例，请先抓取或爬取。","No samples yet. Scrape/crawl first."),variant:"destructive"});return}let e=(()=>{let e;console.log("\uD83D\uDD0D 开始提取数组数据:",{arrayPath:ec,sampleRecords:eh});let t=[];"$.items"===ec&&eh&&eh.length>0&&(e=eh[0]);let a=function(e){let t={};for(let[a,r]of Object.entries(e)){let e=r.split(".");for(let r=1;r<=e.length;r++){let s=e.slice(0,r).join(".");t[s]||(t[s]=[]),t[s].push(a)}}let a={};for(let[e,r]of Object.entries(t))r.length>1&&(a[e]=r);let r={},s=new Set;for(let e of Object.keys(a).sort((e,t)=>t.length-e.length)){let t=a[e].filter(e=>!s.has(e));t.length>1&&(t.forEach(e=>s.add(e)),r[e]=t)}return r}(ez);for(let e in ez)ez[e].indexOf("$.items.")>-1&&(ez[e]=ez[e].replace("$.items.",""));for(let e in Object.keys(a).map(e=>{a[e.replace("$.items.","")]=a[e]}),a)e.indexOf("$.items.")>-1&&delete a[e];for(let e in a)a[e].forEach((t,r)=>{ez[t]&&(a[e][r]={[t]:ez[t].replace("".concat(e,"."),"")})});for(let r in a){let s=a[r],[n,i]=M(r,e);if(n instanceof Array)n.forEach((e,a)=>{let r={};s.forEach(t=>{Object.keys(t).forEach((a,s)=>{let[n,l]=a.split("::");l?(r[n]||(r[n]=[{images:[],label:"项 1",numbers:[],texts:[]}]),r[n][0].texts.push({id:l,value:e[i||t[a]],fieldId:l})):r[a]=e[i||t[a]]})}),t[a]={...t[a],...r}});else if("Object"===z(n)){let e={};Object.keys(currentMapping).forEach(t=>{e[t]=n[currentMapping[t]]}),t.push(e)}else{let e={};Object.keys(currentMapping).forEach(t=>{e[t]=n}),t.push(e)}}return t})();if(0===e.length){N({description:eo("未找到可入库的数据数组","No array data to upsert"),variant:"destructive"});return}let t=localStorage.getItem("aino_token");t||(t="test-token"),eN(!0),eC({total:e.length,done:0,ok:0,fail:0}),ew(eo("正在入库…","Upserting…"));let a=e3(),r=0,s=0,n=0;for(let i of e)try{let e=await fetch("".concat(a,"/api/records/").concat(encodeURIComponent(String(o))),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({props:i})});if(!e.ok)throw Error(await e.text().catch(()=>"create failed"));r+=1}catch(e){console.error("Upsert failed:",e),s+=1}finally{n+=1,eC({total:e.length,done:n,ok:r,fail:s})}let i=eo("入库完成：成功 ".concat(r,"，失败 ").concat(s),"Upsert done: ok ".concat(r,", fail ").concat(s));N({description:i}),ew(i)}finally{eN(!1)}}(0,s.useEffect)(()=>{t&&(et(!1),o||N({description:eo("请先选择目录","Please select a directory first"),variant:"destructive"}))},[t,o]);let eY={Mon:"周一",Tue:"周二",Wed:"周三",Thu:"周四",Fri:"周五",Sat:"周六",Sun:"周日"},e0={Mon:"Mon",Tue:"Tue",Wed:"Wed",Thu:"Thu",Fri:"Fri",Sat:"Sat",Sun:"Sun"},e1=e=>"zh"===i?eY[e]:e0[e],e2=(0,s.useMemo)(()=>{let e=parseInt(G||"0",10);if(!Number.isNaN(e)&&e>0)return"0 */".concat(e," * * * (").concat(B,")");let[t,a]=(R||"06:00").split(":"),r={Sun:"0",Mon:"1",Tue:"2",Wed:"3",Thu:"4",Fri:"5",Sat:"6"};if(ea){let e=ei?new Date(ei).toLocaleDateString():"?";return"ONCE ".concat(e," ").concat(R," (").concat(B,")")}if("daily"===U)return"".concat(a," ").concat(t," * * * (").concat(B,")");if("weekdays"===U)return"".concat(a," ").concat(t," * * 1-5 (").concat(B,")");if("weekend"===U)return"".concat(a," ").concat(t," * * 6,0 (").concat(B,")");if("monthly"===U)return"".concat(a," ").concat(t," ").concat(es," * * (").concat(B,")");let s=q.map(e=>{var t;return null!==(t=r[e])&&void 0!==t?t:""}).filter(Boolean).join(",")||"1-5";return"".concat(a," ").concat(t," * * ").concat(s," (").concat(B,")")},[U,R,q,B,G,ea,es,ei]);function e3(){return"http://47.94.52.142:3007"}async function e5(){let{firecrawlKey:e}=function(){let e=localStorage.getItem("aino_auth_integrations_v1"),t=(e?JSON.parse(e):{})[n]||{};return{openaiEndpoint:t.openaiEndpoint||t.fastgptEndpoint,openaiKey:t.openaiKey||t.fastgptKey,firecrawlKey:t.firecrawlKey}}();if(!e){N({description:eo("请先在授权管理配置 Firecrawl Key","Please configure Firecrawl Key in Authorization"),variant:"destructive"});return}let t=E.split(/\n+/).map(e=>e.trim()).filter(Boolean)[0]||I||"";if(!t){N({description:eo("请输入至少一个 URL 或域名","Please enter at least one URL or domain"),variant:"destructive"});return}try{var a;eb(e=>({...e,scrape:!0})),ew(eo("正在抓取样例…","Scraping sample…"));let r=localStorage.getItem("aino_token");r||(r="test-token");let s=await fetch("".concat(e3(),"/api/crawl/scrape"),{method:"POST",mode:"cors",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r),"x-aino-firecrawl-key":e},body:JSON.stringify({url:t,domain:I,nlRule:F,options:{formats:["markdown","html"]}})}),n=await s.json().catch(()=>({}));if(!s.ok||(null==n?void 0:n.success)===!1)throw Error((null==n?void 0:n.message)||"scrape failed");let i=Array.isArray(null==n?void 0:null===(a=n.data)||void 0===a?void 0:a.data)?n.data.data:[null==n?void 0:n.data];em(i||[]),N({description:eo("已抓取样例，已回填到预览","Scraped sample filled into preview")}),ew(eo("抓取完成","Scrape done"))}catch(e){console.error(e),N({description:eo("抓取失败","Scrape failed"),variant:"destructive"}),ew(eo("抓取失败","Scrape failed"))}finally{eb(e=>({...e,scrape:!1}))}}async function e4(){Y(!0);let e=localStorage.getItem("aino_token");e||(e="test-token");let t=await fetch("".concat(e3(),"/api/crawler/tanzhi/jobs"),{method:"GET",mode:"cors",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}),a=await t.json().catch(()=>({}));if(!t.ok||(null==a?void 0:a.success)===!1)throw Error((null==a?void 0:a.message)||"batch start failed");em([{result:{jobs:a.data}}]),Y(!1)}return(0,r.jsx)(l,{open:t,onOpenChange:a,children:(0,r.jsx)(c,{className:"border-none",children:(0,r.jsx)("div",{className:"mx-auto w-full max-w-6xl px-4 py-3",children:(0,r.jsxs)("div",{className:"rounded-2xl border border-white/40 bg-white/60 dark:bg-neutral-900/50 backdrop-blur-xl shadow-lg ring-1 ring-black/5",children:[(0,r.jsxs)(u,{className:"pb-2 bg-gradient-to-r from-transparent to-white/10 dark:to-neutral-900/10 rounded-t-2xl",children:[(0,r.jsx)(p,{children:eo("AI 运营（采集/抽取/入库）","AI Ops (Crawl/Extract/Upsert)")}),(0,r.jsx)(m,{children:eo("配置数据源、规则、目标与调度；支持 Dry-run 预览后再落库。","Configure sources, rules, target and schedule; Dry-run before upsert.")})]}),(0,r.jsxs)("div",{className:"px-4 pb-4",children:[(0,r.jsxs)(h.F,{className:"h-[68vh] pr-2",children:[(0,r.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:eo("按模板抓取","Capture according to template")}),(0,r.jsx)("div",{className:"rounded-xl border bg-white/60 dark:bg-neutral-900/50 backdrop-blur p-2 max-h-[160px] overflow-auto text-xs",children:(0,r.jsx)(g.$,{size:"sm",className:"cursor-pointer",onClick:e4,disabled:!!Q,children:Q?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(O.A,{className:"size-4 mr-1 animate-spin"}),eo("抓取中","Scraping")]}):eo("谈职岗位信息","Start scrape")})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)("section",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:eo("数据源","Source")}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(y.J,{children:eo("URL 列表(每行一个)","URL list (one per line)")}),(0,r.jsx)(f.T,{value:E,onChange:e=>L(e.target.value),placeholder:eo("https://...","https://..."),className:"min-h-[110px]"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(y.J,{children:eo("自然语言规则","Natural language rule")}),(0,r.jsx)(f.T,{value:F,onChange:e=>K(e.target.value),placeholder:eo("例如：我想要任何数据 / 只要海淀区的 / 城市=北京，岗位=前端，薪资>20k","e.g. I want any data / Only Haidian district / city=Beijing, role=frontend, salary>20k"),className:"min-h-[80px]"}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground space-y-1",children:[(0,r.jsx)("div",{children:eo("支持多种表达方式：","Supports various expressions:")}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-1 text-[10px]",children:[(0,r.jsxs)("div",{children:["• ",eo("通用采集：我想要任何数据、全部都要、都可以","General: I want any data, all data, anything")]}),(0,r.jsxs)("div",{children:["• ",eo("城市筛选：只要海淀区、城市=北京、在海淀区","City: Only Haidian, city=Beijing, in Haidian")]}),(0,r.jsxs)("div",{children:["• ",eo("岗位筛选：只要前端开发、岗位=前端、需要前端工程师","Role: Only frontend dev, role=frontend, need frontend engineer")]}),(0,r.jsxs)("div",{children:["• ",eo("薪资筛选：10k以上、薪资>20k、最低15k","Salary: Above 10k, salary>20k, minimum 15k")]}),(0,r.jsxs)("div",{children:["• ",eo("公司筛选：只要腾讯的、公司=腾讯、在腾讯工作","Company: Only Tencent, company=Tencent, work at Tencent")]})]})]})]})]}),(0,r.jsxs)("section",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(y.J,{children:eo("去重与更新策略","Dedup & update strategy")}),(0,r.jsxs)(v.z,{value:X,onValueChange:e=>Z(e),className:"grid grid-cols-1 gap-2 sm:grid-cols-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(v.C,{value:"url",id:"rk1"}),(0,r.jsx)(y.J,{htmlFor:"rk1",children:"URL"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(v.C,{value:"externalId",id:"rk2"}),(0,r.jsx)(y.J,{htmlFor:"rk2",children:"External ID"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(v.C,{value:"titleWindow",id:"rk3"}),(0,r.jsx)(y.J,{htmlFor:"rk3",children:eo("标题+时间窗口","Title + time window")})]})]}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:eo("存在则部分字段更新，不存在则新增。","Upsert: update if exists, otherwise create.")})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:eo("调度","Schedule")}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(y.J,{children:eo("预设","Preset")}),(0,r.jsxs)(b.l6,{value:U,onValueChange:e=>P(e),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})}),(0,r.jsxs)(b.gC,{children:[(0,r.jsx)(b.eb,{value:"weekdays",children:eo("工作日","Weekdays")}),(0,r.jsx)(b.eb,{value:"weekend",children:eo("周末","Weekend")}),(0,r.jsx)(b.eb,{value:"daily",children:eo("每天","Daily")}),(0,r.jsx)(b.eb,{value:"weekly",children:eo("每周","Weekly")}),(0,r.jsx)(b.eb,{value:"monthly",children:eo("每月","Monthly")}),(0,r.jsx)(b.eb,{value:"custom",children:eo("自定义","Custom")})]})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(y.J,{children:eo("时间","Time")}),(0,r.jsx)(x.p,{type:"time",value:R,onChange:e=>J(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(y.J,{children:eo("时区","Timezone")}),(0,r.jsxs)(b.l6,{value:B,onValueChange:e=>V(e),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})}),(0,r.jsxs)(b.gC,{children:[(0,r.jsx)(b.eb,{value:"Asia/Shanghai",children:"Asia/Shanghai"}),(0,r.jsx)(b.eb,{value:"UTC",children:"UTC"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(y.J,{children:eo("运行模式","Run mode")}),(0,r.jsxs)(v.z,{value:ea?"once":"repeat",onValueChange:e=>er("once"===e),className:"grid grid-cols-2 gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(v.C,{value:"repeat",id:"rm1"}),(0,r.jsx)(y.J,{htmlFor:"rm1",children:eo("重复","Repeat")})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(v.C,{value:"once",id:"rm2"}),(0,r.jsx)(y.J,{htmlFor:"rm2",children:eo("仅一次","Once")})]})]})]})]}),"custom"===U||"weekly"===U?(0,r.jsx)("div",{className:"flex flex-wrap gap-2 pt-1",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(e=>(0,r.jsx)("button",{className:"px-2.5 py-1 rounded-md text-xs border ".concat(q.includes(e)?"bg-blue-600 text-white border-blue-600":"bg-white/60 dark:bg-neutral-900/60"),onClick:()=>{W(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},type:"button",children:e1(e)},e))}):null,"monthly"===U&&(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3 pt-1",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(y.J,{children:eo("每月第几天","Day of month")}),(0,r.jsxs)(b.l6,{value:es,onValueChange:e=>en(e),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})}),(0,r.jsx)(b.gC,{children:Array.from({length:31}).map((e,t)=>(0,r.jsx)(b.eb,{value:String(t+1),children:t+1},t+1))})]})]})}),ea&&(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3 pt-1",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(y.J,{children:eo("执行日期","Run date")}),(0,r.jsxs)(j.AM,{children:[(0,r.jsx)(j.Wv,{asChild:!0,children:(0,r.jsx)(g.$,{variant:"outline",className:"w-full justify-start font-normal",children:ei?new Date(ei).toLocaleDateString():eo("选择日期","Pick a date")})}),(0,r.jsx)(j.hl,{className:"p-0",align:"start",children:(0,r.jsx)(w.V,{mode:"single",selected:ei?new Date(ei):void 0,onSelect:e=>el(e?e.toISOString():"")})})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,r.jsx)("div",{className:"space-y-1 md:col-span-2",children:(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:[eo("CRON 预览","CRON Preview"),"：",(0,r.jsx)("span",{className:"font-mono",children:e2})]})}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(y.J,{children:eo("间隔(小时，可选)","Interval (hours, optional)")}),(0,r.jsx)(x.p,{inputMode:"numeric",pattern:"[0-9]*",value:G,onChange:e=>H(e.target.value.replace(/[^0-9]/g,"")),placeholder:eo("留空则按上面时间执行","Leave empty to use time above")})]})]})]})]}),(0,r.jsxs)("section",{className:"space-y-3 lg:col-span-2",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:eo("抽取样例","Extracted Samples")}),(0,r.jsx)("div",{className:"rounded-xl border bg-white/60 dark:bg-neutral-900/50 backdrop-blur p-2 max-h-[160px] overflow-auto text-xs",children:0===eh.length?(0,r.jsx)("div",{className:"text-muted-foreground",children:eo("暂无样例，请先抓取或爬取。","No samples yet. Scrape/crawl first.")}):(0,r.jsx)("pre",{className:"whitespace-pre-wrap break-all",children:JSON.stringify(eh.slice(0,3),null,2)})})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:eo("字段映射","Field Mapping")}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.$,{variant:"secondary",size:"sm",onClick:function(){let e={},t={title:["title","name","job_title","position","职位","岗位","名称"],description:["description","desc","content","detail","描述","内容","详情","介绍"],salary:["salary","pay","wage","薪资","工资","待遇","报酬"],city:["city","location","address","城市","地点","地址","位置"],company:["company","employer","corp","公司","企业","雇主"],url:["url","link","href","链接","网址"],date:["date","time","created","posted","日期","时间","发布时间"],experience:["experience","exp","years","经验","年限"],education:["education","degree","学历","学位"],type:["type","category","kind","类型","分类"],level:["level","grade","级别","等级"],skills:["skills","requirements","技能","要求","要求技能"],benefits:["benefits","perks","福利","待遇"]};for(let a of eA){let r=eF.find(e=>{var r;return null===(r=t[a.key])||void 0===r?void 0:r.some(t=>e.toLowerCase().includes(t.toLowerCase()))});if(r){e[a.key]=r;continue}let s=eF.find(e=>e.toLowerCase().includes(a.key.toLowerCase().slice(0,4))||a.key.toLowerCase().includes(e.toLowerCase().slice(0,4)));s&&(e[a.key]=s)}eM(e),N({description:eo("已自动匹配相近字段","Auto matched similar fields")})},children:eo("自动匹配","Auto match")}),(0,r.jsx)(g.$,{variant:"outline",size:"sm",onClick:function(){eM({})},children:eo("清空","Clear")})]})]}),(0,r.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:eo("字段映射说明","Field Mapping Guide")}),(0,r.jsxs)("div",{className:"text-xs text-blue-800 space-y-1",children:[(0,r.jsxs)("div",{children:["• ",eo("采集数据 → 映射字段 → 格式化存储","Scraped Data → Map Fields → Format & Store")]}),(0,r.jsxs)("div",{children:["• ",eo("例如：采集到'职位名称' → 映射到'title'字段 → 存储为文本格式","e.g. 'Job Title' → map to 'title' field → store as text")]}),(0,r.jsxs)("div",{children:["• ",eo("例如：采集到'薪资15k' → 映射到'salary'字段 → 转换为数字15000","e.g. 'Salary 15k' → map to 'salary' field → convert to number 15000")]})]})]}),eF.length>0&&(0,r.jsxs)("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:[(0,r.jsxs)("div",{className:"text-sm font-medium text-green-900 mb-2",children:[eo("采集数据字段","Scraped Data Fields")," (",eF.length,")"]}),(0,r.jsxs)("div",{className:"text-xs text-green-800",children:[(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:eF.map(e=>(0,r.jsx)("span",{className:"px-2 py-1 bg-green-100 rounded text-green-700",children:e},e))}),(0,r.jsx)("div",{className:"mt-2 text-green-600",children:eo("系统已自动分析采集数据结构，并尝试匹配到您的字段","System has analyzed scraped data structure and attempted to match to your fields")})]})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(g.$,{variant:"outline",size:"sm",onClick:e5,disabled:!!ev.scrape,children:ev.scrape?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(O.A,{className:"size-4 mr-1 animate-spin"}),eo("抓取中","Scraping")]}):eo("开始抓取","Start scrape")})})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-white/60 dark:bg-neutral-900/50 backdrop-blur p-0",children:[ej&&(0,r.jsxs)("div",{className:"px-3 py-2 text-xs text-muted-foreground border-b bg-white/50 dark:bg-neutral-900/40 flex items-center gap-2",children:[(0,r.jsx)(O.A,{className:"size-3 ".concat(Object.values(ev).some(Boolean)?"animate-spin":"")}),(0,r.jsx)("span",{children:ej})]}),(0,r.jsx)("div",{className:"max-h-[240px] overflow-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"sticky top-0 bg-white/70 dark:bg-neutral-900/70 backdrop-blur",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left px-3 py-2 w-[26%]",children:eo("字段","Field")}),(0,r.jsxs)("th",{className:"text-left px-3 py-2 w-[30%]",children:[eo("来源键","Source key"),(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)(x.p,{value:eU,onChange:e=>eP(e.target.value),placeholder:eo("搜索键","Search keys"),className:"h-7"})})]}),(0,r.jsx)("th",{className:"text-left px-3 py-2 w-[22%]",children:eo("转换","Transform")}),(0,r.jsx)("th",{className:"text-left px-3 py-2",children:eo("示例","Sample")})]})}),(0,r.jsx)("tbody",{children:eO.map(e=>{var t,a,s,n,i,l,o,d;return(0,r.jsxs)("tr",{className:"border-t",children:[(0,r.jsxs)("td",{className:"px-3 py-2",children:[(0,r.jsx)("div",{className:"font-medium",children:e.label}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.key})]}),(0,r.jsx)("td",{className:"px-3 py-2 space-y-1",children:"progress"===e.key?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsx)(x.p,{value:(null===(t=eI[e.key])||void 0===t?void 0:t.arrayPath)||"$.progress",onChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{aggregation:"weightedAverage"},arrayPath:t.target.value}})),placeholder:eo("数组路径 如 $.progress","Array path e.g. $.progress")}),(0,r.jsxs)(b.l6,{value:(null===(a=eI[e.key])||void 0===a?void 0:a.aggregation)||"weightedAverage",onValueChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{},aggregation:t}})),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})}),(0,r.jsxs)(b.gC,{children:[(0,r.jsx)(b.eb,{value:"weightedAverage",children:"weightedAverage"}),(0,r.jsx)(b.eb,{value:"max",children:"max"}),(0,r.jsx)(b.eb,{value:"min",children:"min"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,r.jsx)(x.p,{value:(null===(s=eI[e.key])||void 0===s?void 0:s.labelKey)||"label",onChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{aggregation:"weightedAverage"},labelKey:t.target.value}})),placeholder:eo("标签键 label","label key")}),(0,r.jsx)(x.p,{value:(null===(n=eI[e.key])||void 0===n?void 0:n.valueKey)||"value",onChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{aggregation:"weightedAverage"},valueKey:t.target.value}})),placeholder:eo("数值键 value","value key")}),(0,r.jsx)(x.p,{value:(null===(i=eI[e.key])||void 0===i?void 0:i.statusKey)||"status",onChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{aggregation:"weightedAverage"},statusKey:t.target.value}})),placeholder:eo("状态键 status","status key")}),(0,r.jsx)(x.p,{value:(null===(l=eI[e.key])||void 0===l?void 0:l.weightKey)||"weight",onChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{aggregation:"weightedAverage"},weightKey:t.target.value}})),placeholder:eo("权重键 weight","weight key")})]}),(0,r.jsx)("div",{className:"text-[10px] text-muted-foreground",children:eo("样例: [{label,value,status,weight}] 将按聚合规则展示","Sample: [{label,value,status,weight}] aggregated by rule")})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.p,{value:ez[e.key]||"",onChange:t=>eM(a=>({...a,[e.key]:t.target.value})),placeholder:eo("如 title/desc/link","e.g. title/desc/link")}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(function(e){let t=(eF.length>0?eF:eH).map(t=>({k:t,s:function(e,t){let a=e.toLowerCase(),r=t.toLowerCase();if(a===r)return 100;if(r.includes(a))return 80;if(a.includes(r))return 70;let s=0;for(let e of a.split(/[_-]/))r.includes(e)&&(s+=10);return s}(e.key,t)})).sort((e,t)=>t.s-e.s).map(e=>e.k),a=eU?t.filter(e=>e.toLowerCase().includes(eU.toLowerCase())):t,r=[];return(a||[]).forEach(e=>{e.startsWith(ec)&&r.push(e)}),r.slice(0,8)})(e).map(t=>(0,r.jsx)("button",{type:"button",onClick:()=>eM(a=>({...a,[e.key]:t})),className:"text-[10px] px-1.5 py-0.5 rounded border ".concat(ez[e.key]===t?"bg-blue-600 text-white border-blue-600":"bg-white/70"),children:t},t)),e.required&&!ez[e.key]&&(0,r.jsx)("span",{className:"text-[10px] text-red-600 ml-1",children:eo("必填","Required")})]})]})}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsxs)(b.l6,{value:eE[e.key]||eG(e.type,(null!==(d=null==eh?void 0:eh[0])&&void 0!==d?d:{})[ez[e.key]||""]),onValueChange:t=>eL(a=>({...a,[e.key]:t})),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})}),(0,r.jsx)(b.gC,{children:eV.map(e=>(0,r.jsx)(b.eb,{value:e.value,children:e.label},e.value))})]})}),(0,r.jsx)("td",{className:"px-3 py-2 text-xs text-muted-foreground truncate",children:String(null==eh?void 0:null===(o=eh[0])||void 0===o?void 0:o[ez[e.key]||""])||"—"})]},e.key)})})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 text-xs text-muted-foreground",children:[(0,r.jsxs)("div",{children:[eo("第","Page")," ",e_,"/",eT]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.$,{variant:"outline",size:"sm",disabled:e_<=1,onClick:()=>eD(e=>Math.max(1,e-1)),children:"Prev"}),(0,r.jsx)(g.$,{variant:"outline",size:"sm",disabled:e_>=eT,onClick:()=>eD(e=>Math.min(eT,e+1)),children:"Next"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:eo("预览","Preview")}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.$,{variant:"outline",size:"sm",onClick:function(){if(!eh||0===eh.length){N({description:eo("暂无样例，请先抓取或爬取。","No samples yet. Scrape/crawl first."),variant:"destructive"});return}let e=eh[0],t={};for(let a of eA){if("progress"===a.key)continue;let r=ez[a.key];if(!r)continue;let s=eX(e,r),n=function(e,t){switch(t){case"trim":return"string"==typeof e?e.trim():e;case"toNumber":return eZ(e);case"parseDate":default:return e;case"splitTags":return"string"==typeof e?e.split(/[，,\s]+/).filter(Boolean):Array.isArray(e)?e:[]}}(s,eE[a.key]||eG(a.type,s));t[a.key]=n}let a=eI.progress||{arrayPath:"$.progress",labelKey:"label",valueKey:"value",statusKey:"status",weightKey:"weight",aggregation:"weightedAverage"},r=eX(e,a.arrayPath),s=[];Array.isArray(r)?s=r.map((e,t)=>({id:String(t+1),key:String(e[a.labelKey]||"p".concat(t+1)),label:String(e[a.labelKey]||"Progress ".concat(t+1)),value:Math.max(0,Math.min(100,eZ(e[a.valueKey]))),status:e[a.statusKey||"status"]||void 0,weight:void 0!==e[a.weightKey||"weight"]?eZ(e[a.weightKey||"weight"]):1})):ez.progress&&(s=[{id:"1",key:"progress",label:"Progress",value:Math.max(0,Math.min(100,eZ(eX(e,ez.progress)))),weight:1}]),t.progress={items:s,aggregated:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"weightedAverage",a=e.map(e=>{var t,a;return{v:Number(null!==(t=e.value)&&void 0!==t?t:0),w:Number(null!==(a=e.weight)&&void 0!==a?a:1)}});if("max"===t)return Math.max(0,...a.map(e=>e.v));if("min"===t)return Math.min(100,...a.map(e=>e.v));let r=a.reduce((e,t)=>e+(isFinite(t.w)?t.w:0),0)||1;return Math.max(0,Math.min(100,Math.round(a.reduce((e,t)=>e+(isFinite(t.v)?t.v:0)*(isFinite(t.w)?t.w:0),0)/r)))}(s,a.aggregation)},eW(JSON.stringify({original:e,mapped:t},null,2))},children:eo("本地预览","Local preview")}),(0,r.jsx)(g.$,{size:"sm",onClick:eQ,disabled:ek||!o,children:ek?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(O.A,{className:"size-4 mr-1 animate-spin"}),eo("入库中…","Upserting…")]}):eo("入库","Upsert")})]})]}),(0,r.jsx)("div",{className:"rounded-xl border bg-white/60 dark:bg-neutral-900/50 backdrop-blur p-3 text-xs text-muted-foreground min-h-[120px]",children:(0,r.jsx)("pre",{className:"whitespace-pre-wrap break-all",children:eq||eo("Dry-run 后将在此显示：原始→规范化→字段映射对照。","After dry-run, original → normalized → field mapping diffs will appear here.")})})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between pt-3",children:[(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:eo("来源与变更将被审计记录，支持回溯。","Source & changes are audited for traceability.")}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.$,{variant:"outline",onClick:()=>a(!1),children:eo("取消","Cancel")}),(0,r.jsx)(g.$,{variant:"secondary",onClick:function(){let e=localStorage.getItem("aino_auth_integrations_v1"),t=(e?JSON.parse(e):{})[n]||{},a=t.openaiEndpoint||t.fastgptEndpoint,r=t.openaiKey||t.fastgptKey;if(!a||!r){N({description:eo("请先在设置/授权管理中配置 OpenAI Endpoint 与 Key","Please configure OpenAI Endpoint & Key in Settings/Authorization first"),variant:"destructive"});return}N({description:eo("已提交 Dry-run，请稍等…","Dry-run submitted, please wait…")}),fetch("".concat("http://47.94.52.142:3007","/api/ai/chat"),{method:"POST",headers:{"Content-Type":"application/json","x-aino-openai-endpoint":a,"x-aino-openai-key":r},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"user",content:"ping"}]})}).then(async e=>{if(!e.ok)throw Error(await e.text());N({description:eo("AI 网关已响应","AI gateway responded")})}).catch(e=>{console.error(e),N({description:eo("AI 网关调用失败","AI gateway call failed"),variant:"destructive"})})},children:eo("Dry-run 预览","Dry-run")}),(0,r.jsx)(g.$,{variant:"outline",onClick:function(){N({description:eo("已开始运行，后台执行中","Run started in background")})},children:eo("立即运行","Run now")}),(0,r.jsx)(g.$,{onClick:eQ,disabled:ek||!o,children:ek?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(O.A,{className:"size-4 mr-1 animate-spin"}),eo("入库中…","Upserting…")]}):eo("入库","Upsert")})]})]}),ek&&(0,r.jsxs)("div",{className:"pt-2 text-xs text-muted-foreground",children:[eo("进度","Progress"),": ",eS.done,"/",eS.total," ",eo("成功","OK"),": ",eS.ok," ",eo("失败","Fail"),": ",eS.fail]})]})]})})})})}}}]);