"use strict";exports.id=58,exports.ids=[58],exports.modules={13135:(e,t,a)=>{a.d(t,{C:()=>d,z:()=>l});var r=a(33752);a(82153);var s=a(73300),i=a(61009),n=a(1237);function l({className:e,...t}){return(0,r.jsx)(s.bL,{"data-slot":"radio-group",className:(0,n.cn)("grid gap-3",e),...t})}function d({className:e,...t}){return(0,r.jsx)(s.q7,{"data-slot":"radio-group-item",className:(0,n.cn)("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:(0,r.jsx)(s.C1,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,r.jsx)(i.A,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}},19394:(e,t,a)=>{a.d(t,{d:()=>n});var r=a(33752);a(82153);var s=a(70896),i=a(1237);function n({className:e,...t}){return(0,r.jsx)(s.bL,{"data-slot":"switch",className:(0,i.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:(0,r.jsx)(s.zi,{"data-slot":"switch-thumb",className:(0,i.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}},57880:(e,t,a)=>{a.d(t,{V:()=>p});var r=a(33752),s=a(82153),i=a(78362),n=a(74073),l=a(2027),d=a(31091),o=a(74288),c=a(1237),u=a(51322);function p({className:e,classNames:t,showOutsideDays:a=!0,captionLayout:s="label",buttonVariant:p="ghost",formatters:m,components:x,...g}){let f=(0,d.a)();return(0,r.jsx)(o.h,{showOutsideDays:a,className:(0,c.cn)("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,e),captionLayout:s,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...m},classNames:{root:(0,c.cn)("w-fit",f.root),months:(0,c.cn)("flex gap-4 flex-col md:flex-row relative",f.months),month:(0,c.cn)("flex flex-col w-full gap-4",f.month),nav:(0,c.cn)("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",f.nav),button_previous:(0,c.cn)((0,u.r)({variant:p}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",f.button_previous),button_next:(0,c.cn)((0,u.r)({variant:p}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",f.button_next),month_caption:(0,c.cn)("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",f.month_caption),dropdowns:(0,c.cn)("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",f.dropdowns),dropdown_root:(0,c.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",f.dropdown_root),dropdown:(0,c.cn)("absolute bg-popover inset-0 opacity-0",f.dropdown),caption_label:(0,c.cn)("select-none font-medium","label"===s?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",f.caption_label),table:"w-full border-collapse",weekdays:(0,c.cn)("flex",f.weekdays),weekday:(0,c.cn)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",f.weekday),week:(0,c.cn)("flex w-full mt-2",f.week),week_number_header:(0,c.cn)("select-none w-(--cell-size)",f.week_number_header),week_number:(0,c.cn)("text-[0.8rem] select-none text-muted-foreground",f.week_number),day:(0,c.cn)("relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",f.day),range_start:(0,c.cn)("rounded-l-md bg-accent",f.range_start),range_middle:(0,c.cn)("rounded-none",f.range_middle),range_end:(0,c.cn)("rounded-r-md bg-accent",f.range_end),today:(0,c.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",f.today),outside:(0,c.cn)("text-muted-foreground aria-selected:text-muted-foreground",f.outside),disabled:(0,c.cn)("text-muted-foreground opacity-50",f.disabled),hidden:(0,c.cn)("invisible",f.hidden),...t},components:{Root:({className:e,rootRef:t,...a})=>(0,r.jsx)("div",{"data-slot":"calendar",ref:t,className:(0,c.cn)(e),...a}),Chevron:({className:e,orientation:t,...a})=>"left"===t?(0,r.jsx)(i.A,{className:(0,c.cn)("size-4",e),...a}):"right"===t?(0,r.jsx)(n.A,{className:(0,c.cn)("size-4",e),...a}):(0,r.jsx)(l.A,{className:(0,c.cn)("size-4",e),...a}),DayButton:h,WeekNumber:({children:e,...t})=>(0,r.jsx)("td",{...t,children:(0,r.jsx)("div",{className:"flex size-(--cell-size) items-center justify-center text-center",children:e})}),...x},...g})}function h({className:e,day:t,modifiers:a,...i}){let n=(0,d.a)(),l=s.useRef(null);return s.useEffect(()=>{a.focused&&l.current?.focus()},[a.focused]),(0,r.jsx)(u.$,{ref:l,variant:"ghost",size:"icon","data-day":t.date.toLocaleDateString(),"data-selected-single":a.selected&&!a.range_start&&!a.range_end&&!a.range_middle,"data-range-start":a.range_start,"data-range-end":a.range_end,"data-range-middle":a.range_middle,className:(0,c.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",n.day,e),...i})}},66419:(e,t,a)=>{a.d(t,{AM:()=>n,Wv:()=>l,hl:()=>d});var r=a(33752);a(82153);var s=a(5580),i=a(1237);function n({...e}){return(0,r.jsx)(s.bL,{"data-slot":"popover",...e})}function l({...e}){return(0,r.jsx)(s.l9,{"data-slot":"popover-trigger",...e})}function d({className:e,align:t="center",sideOffset:a=4,...n}){return(0,r.jsx)(s.ZL,{children:(0,r.jsx)(s.UC,{"data-slot":"popover-content",align:t,sideOffset:a,className:(0,i.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...n})})}},87929:(e,t,a)=>{a.d(t,{O:()=>O});var r=a(33752),s=a(82153),i=a(12042),n=a(1237);function l({...e}){return(0,r.jsx)(i._s.Root,{"data-slot":"drawer",...e})}function d({...e}){return(0,r.jsx)(i._s.Portal,{"data-slot":"drawer-portal",...e})}function o({className:e,...t}){return(0,r.jsx)(i._s.Overlay,{"data-slot":"drawer-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t})}function c({className:e,children:t,...a}){return(0,r.jsxs)(d,{"data-slot":"drawer-portal",children:[(0,r.jsx)(o,{}),(0,r.jsxs)(i._s.Content,{"data-slot":"drawer-content",className:(0,n.cn)("group/drawer-content bg-background fixed z-50 flex h-auto flex-col","data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b","data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t","data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm","data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",e),...a,children:[(0,r.jsx)("div",{className:"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block"}),t]})]})}function u({className:e,...t}){return(0,r.jsx)("div",{"data-slot":"drawer-header",className:(0,n.cn)("flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",e),...t})}function p({className:e,...t}){return(0,r.jsx)(i._s.Title,{"data-slot":"drawer-title",className:(0,n.cn)("text-foreground font-semibold",e),...t})}function h({className:e,...t}){return(0,r.jsx)(i._s.Description,{"data-slot":"drawer-description",className:(0,n.cn)("text-muted-foreground text-sm",e),...t})}var m=a(90155),x=a(51322),g=a(85768),f=a(94732),v=a(56970),y=a(13135),b=a(66482),j=a(66419),w=a(57880);let k=0,N=new Map,S=e=>{if(N.has(e))return;let t=setTimeout(()=>{N.delete(e),z({type:"REMOVE_TOAST",toastId:e})},1e6);N.set(e,t)},C=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?S(a):e.toasts.forEach(e=>{S(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},A=[],$={toasts:[]};function z(e){$=C($,e),A.forEach(e=>{e($)})}function T({...e}){let t=(k=(k+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>z({type:"DISMISS_TOAST",toastId:t});return z({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>z({type:"UPDATE_TOAST",toast:{...e,id:t}})}}var _=a(69123);function O({open:e,onOpenChange:t,appId:a,lang:i="zh",dirId:n,dirName:d,dirFields:o}){let{toast:k}=function(){let[e,t]=s.useState($);return s.useEffect(()=>(A.push(t),()=>{let e=A.indexOf(t);e>-1&&A.splice(e,1)}),[e]),{...e,toast:T,dismiss:e=>z({type:"DISMISS_TOAST",toastId:e})}}(),[N,S]=(0,s.useState)("firecrawl"),[C,O]=(0,s.useState)(""),[F,M]=(0,s.useState)(""),[D,I]=(0,s.useState)(""),[K,L]=(0,s.useState)("weekdays"),[P,E]=(0,s.useState)("06:00"),[R,J]=(0,s.useState)(["Mon","Tue","Wed","Thu","Fri"]),[U,B]=(0,s.useState)(Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Shanghai"),[q,V]=(0,s.useState)(""),[W,Z]=(0,s.useState)("url"),[G,X]=(0,s.useState)(!1),[H,Q]=(0,s.useState)(!1),[Y,ee]=(0,s.useState)("1"),[et,ea]=(0,s.useState)(""),er=(e,t)=>"zh"===i?e:t,es=(0,s.useMemo)(()=>({items:Array.from({length:6}).map((e,t)=>({title:`Senior Frontend Engineer ${t+1}`,desc:`React/Next.js \xb7 TypeScript \xb7 UI/UX`,salary:2e4+1e3*t,city:["北京","上海","深圳"][t%3],company:["AINO","Axis","Nova"][t%3],link:`https://jobs.example.com/${t+1}`,posted_at:"2025-09-01"})),data:[{name:"fallback"}],results:[]}),[]),[ei,en]=(0,s.useState)("$.items"),[el,ed]=(0,s.useState)(null),eo=(0,s.useMemo)(()=>el||("$.items"===ei?es.items:"$.data"===ei?es.data:"$.results"===ei?es.results:[]),[ei,es,el]),[ec,eu]=(0,s.useState)(""),[ep,eh]=(0,s.useState)(""),[em,ex]=(0,s.useState)({}),[eg,ef]=(0,s.useState)(""),ev=(0,s.useMemo)(()=>Array.isArray(o)&&o.length>0?o.map(e=>({key:e.key,label:e.label||e.key,type:e.type||"text",required:!!e.required})):[{key:"title",label:er("标题","Title"),type:"text",required:!0},{key:"description",label:er("描述","Description"),type:"text"},{key:"salary",label:er("薪资","Salary"),type:"number"},{key:"city",label:er("城市","City"),type:"text"},{key:"company",label:er("公司","Company"),type:"text"},{key:"url",label:"URL",type:"url"}],[o,i]),[ey,eb]=(0,s.useState)(1),ej=Math.max(1,Math.ceil(ev.length/10)),ew=(0,s.useMemo)(()=>ev.slice((ey-1)*10,10*ey),[ev,ey]),[ek,eN]=(0,s.useState)({}),[eS,eC]=(0,s.useState)({}),[eA,e$]=(0,s.useState)({}),ez=["title","desc","salary","city","company","link","posted_at"],[eT,e_]=(0,s.useState)(""),[eO,eF]=(0,s.useState)(""),[eM,eD]=(0,s.useState)(""),eI=[{value:"none",label:er("无","None")},{value:"trim",label:"trim"},{value:"toNumber",label:"toNumber"},{value:"parseDate",label:"parseDate"},{value:"splitTags",label:"splitTags"}];function eK(e,t){return"number"===e?"number"==typeof t?"none":"toNumber":"date"===e?"parseDate":"tags"===e||"multiselect"===e?Array.isArray(t)?"none":"splitTags":"text"===e?"trim":"none"}let eL=(0,s.useMemo)(()=>{try{let e=function e(t,a="",r=0,s=[]){if(!t||r>2)return s;if(Array.isArray(t))return t.length>0&&e(t[0],a,r+1,s),s;if("object"==typeof t)for(let i of Object.keys(t)){let n=a?`${a}.${i}`:i;s.push(n),"object"==typeof t[i]&&e(t[i],n,r+1,s)}return s}(eo?.[0]??{});return Array.from(new Set([...e,...ez])).sort()}catch{return ez}},[eo]);function eP(e,t){if(!e||!t)return;let a=t.replace(/^\$\.?/,"").split(".").filter(Boolean),r=e;for(let e of a){if(!r||"object"!=typeof r)return;r=r[e]}return r}function eE(e){if("number"==typeof e)return e;if("string"==typeof e){let t=e.match(/([0-9]+(?:\.[0-9]+)?)/);if(t)return Number(t[1])}return Number(e)||0}function eR(){return`aino_aiops_mapping_${a}_${n||"dir"}`}let eJ={Mon:"周一",Tue:"周二",Wed:"周三",Thu:"周四",Fri:"周五",Sat:"周六",Sun:"周日"},eU={Mon:"Mon",Tue:"Tue",Wed:"Wed",Thu:"Thu",Fri:"Fri",Sat:"Sat",Sun:"Sun"},eB=e=>"zh"===i?eJ[e]:eU[e],eq=(0,s.useMemo)(()=>{let e=parseInt(q||"0",10);if(!Number.isNaN(e)&&e>0)return`0 */${e} * * * (${U})`;let[t,a]=(P||"06:00").split(":"),r={Sun:"0",Mon:"1",Tue:"2",Wed:"3",Thu:"4",Fri:"5",Sat:"6"};if(H){let e=et?new Date(et).toLocaleDateString():"?";return`ONCE ${e} ${P} (${U})`}if("daily"===K)return`${a} ${t} * * * (${U})`;if("weekdays"===K)return`${a} ${t} * * 1-5 (${U})`;if("weekend"===K)return`${a} ${t} * * 6,0 (${U})`;if("monthly"===K)return`${a} ${t} ${Y} * * (${U})`;let s=R.map(e=>r[e]??"").filter(Boolean).join(",")||"1-5";return`${a} ${t} * * ${s} (${U})`},[K,P,R,U,q,H,Y,et]);function eV(){let e={}[a]||{};return{openaiEndpoint:e.openaiEndpoint||e.fastgptEndpoint,openaiKey:e.openaiKey||e.fastgptKey,firecrawlKey:e.firecrawlKey}}function eW(){return"http://47.94.52.142:3007"}async function eZ(){let{firecrawlKey:e}=eV();if(!e){k({description:er("请先在授权管理配置 Firecrawl Key","Please configure Firecrawl Key in Authorization"),variant:"destructive"});return}let t=C.split(/\n+/).map(e=>e.trim()).filter(Boolean)[0]||F||"";if(!t){k({description:er("请输入至少一个 URL 或域名","Please enter at least one URL or domain"),variant:"destructive"});return}try{ex(e=>({...e,scrape:!0})),ef(er("正在抓取样例…","Scraping sample…"));let a=await fetch(`${eW()}/api/crawl/scrape`,{method:"POST",headers:{"Content-Type":"application/json","x-aino-firecrawl-key":e},body:JSON.stringify({url:t,options:{formats:["markdown","html"]}})}),r=await a.json().catch(()=>({}));if(!a.ok||r?.success===!1)throw Error(r?.message||"scrape failed");let s=Array.isArray(r?.data?.data)?r.data.data:[r?.data];ed(s||[]),k({description:er("已抓取样例，已回填到预览","Scraped sample filled into preview")}),ef(er("抓取完成","Scrape done"))}catch(e){console.error(e),k({description:er("抓取失败","Scrape failed"),variant:"destructive"}),ef(er("抓取失败","Scrape failed"))}finally{ex(e=>({...e,scrape:!1}))}}async function eG(){let{firecrawlKey:e}=eV();if(!e){k({description:er("请先在授权管理配置 Firecrawl Key","Please configure Firecrawl Key in Authorization"),variant:"destructive"});return}let t=F||C.split(/\n+/).map(e=>e.trim()).filter(Boolean)[0]||"";if(!t){k({description:er("请输入域名或 URL","Please enter a domain or URL"),variant:"destructive"});return}try{ex(e=>({...e,crawlStart:!0})),ef(er("正在启动爬取…","Starting crawl…"));let a=await fetch(`${eW()}/api/crawl/start`,{method:"POST",headers:{"Content-Type":"application/json","x-aino-firecrawl-key":e},body:JSON.stringify({url:t,options:{limit:10}})}),r=await a.json().catch(()=>({}));if(!a.ok||r?.success===!1)throw Error(r?.message||"start failed");let s=r?.data?.id||r?.data?.jobId||"";eu(s),k({description:s?er("已启动爬取，点击查看状态","Crawl started, click to check status"):er("已启动爬取","Crawl started")}),ef(s?er("爬取已启动：","Crawl started: ")+s:er("爬取已启动","Crawl started"))}catch(e){console.error(e),k({description:er("启动失败","Start failed"),variant:"destructive"}),ef(er("启动失败","Start failed"))}finally{ex(e=>({...e,crawlStart:!1}))}}async function eX(){let{firecrawlKey:e}=eV();if(e&&ec)try{ex(e=>({...e,crawlStatus:!0})),ef(er("正在获取状态…","Fetching status…"));let t=await fetch(`${eW()}/api/crawl/status/${encodeURIComponent(ec)}`,{headers:{"x-aino-firecrawl-key":e}}),a=await t.json().catch(()=>({}));if(!t.ok||a?.success===!1)throw Error(a?.message||"status failed");let r=a?.data?.data||[];Array.isArray(r)&&r.length&&(ed(r),k({description:er("已更新预览数据","Preview updated")})),ef(er("状态已更新","Status updated"))}catch(e){console.error(e),k({description:er("获取状态失败","Fetch status failed"),variant:"destructive"}),ef(er("获取状态失败","Fetch status failed"))}finally{ex(e=>({...e,crawlStatus:!1}))}}async function eH(){let{firecrawlKey:e}=eV();if(!e){k({description:er("请先在授权管理配置 Firecrawl Key","Please configure Firecrawl Key in Authorization"),variant:"destructive"});return}let t=C.split(/\n+/).map(e=>e.trim()).filter(Boolean);if(0===t.length){k({description:er("请在 URL 列表输入若干地址","Please input some URLs in list"),variant:"destructive"});return}try{ex(e=>({...e,batchStart:!0})),ef(er("正在启动批量抓取…","Starting batch…"));let a=await fetch(`${eW()}/api/crawl/batch/start`,{method:"POST",headers:{"Content-Type":"application/json","x-aino-firecrawl-key":e},body:JSON.stringify({urls:t,options:{options:{formats:["markdown"]}}})}),r=await a.json().catch(()=>({}));if(!a.ok||r?.success===!1)throw Error(r?.message||"batch start failed");let s=r?.data?.id||r?.data?.jobId||"";eh(s),k({description:s?er("已启动批量抓取","Batch started"):er("已启动","Started")}),ef(s?er("批量抓取已启动：","Batch started: ")+s:er("批量抓取已启动","Batch started"))}catch(e){console.error(e),k({description:er("批量启动失败","Batch start failed"),variant:"destructive"}),ef(er("批量启动失败","Batch start failed"))}finally{ex(e=>({...e,batchStart:!1}))}}async function eQ(){let{firecrawlKey:e}=eV();if(e&&ep)try{ex(e=>({...e,batchStatus:!0}));let t=await fetch(`${eW()}/api/crawl/batch/status/${encodeURIComponent(ep)}`,{headers:{"x-aino-firecrawl-key":e}}),a=await t.json().catch(()=>({}));if(!t.ok||a?.success===!1)throw Error(a?.message||"batch status failed");let r=a?.data?.data||[];Array.isArray(r)&&r.length&&(ed(r),k({description:er("已更新批量预览","Batch preview updated")})),ef(er("批量状态已更新","Batch status updated"))}catch(e){console.error(e),k({description:er("获取批量状态失败","Fetch batch status failed"),variant:"destructive"}),ef(er("获取批量状态失败","Fetch batch status failed"))}finally{ex(e=>({...e,batchStatus:!1}))}}async function eY(){let{firecrawlKey:e}=eV();if(e&&ec)try{ex(e=>({...e,cancel:!0}));let t=(await fetch(`${eW()}/api/crawl/cancel/${encodeURIComponent(ec)}`,{method:"POST",headers:{"x-aino-firecrawl-key":e}})).ok;k({description:t?er("已取消","Cancelled"):er("取消失败","Cancel failed"),variant:t?void 0:"destructive"}),ef(t?er("爬取已取消","Crawl cancelled"):er("取消失败","Cancel failed"))}finally{ex(e=>({...e,cancel:!1}))}}return(0,r.jsx)(l,{open:e,onOpenChange:t,children:(0,r.jsx)(c,{className:"border-none",children:(0,r.jsx)("div",{className:"mx-auto w-full max-w-6xl px-4 py-3",children:(0,r.jsxs)("div",{className:"rounded-2xl border border-white/40 bg-white/60 dark:bg-neutral-900/50 backdrop-blur-xl shadow-lg ring-1 ring-black/5",children:[(0,r.jsxs)(u,{className:"pb-2 bg-gradient-to-r from-transparent to-white/10 dark:to-neutral-900/10 rounded-t-2xl",children:[(0,r.jsx)(p,{children:er("AI 运营（采集/抽取/入库）","AI Ops (Crawl/Extract/Upsert)")}),(0,r.jsx)(h,{children:er("配置数据源、规则、目标与调度；支持 Dry-run 预览后再落库。","Configure sources, rules, target and schedule; Dry-run before upsert.")})]}),(0,r.jsxs)("div",{className:"px-4 pb-4",children:[(0,r.jsx)(m.F,{className:"h-[68vh] pr-2",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)("section",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:er("数据源","Source")}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("Provider","Provider")}),(0,r.jsxs)(b.l6,{value:N,onValueChange:e=>S(e),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{placeholder:"Provider"})}),(0,r.jsxs)(b.gC,{children:[(0,r.jsx)(b.eb,{value:"firecrawl",children:"Firecrawl"}),(0,r.jsx)(b.eb,{value:"scrapegraph",children:"ScrapeGraphAI"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("域名(可选)","Domain (optional)")}),(0,r.jsx)(g.p,{value:F,onChange:e=>M(e.target.value),placeholder:"https://example.com"})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("URL 列表(每行一个)","URL list (one per line)")}),(0,r.jsx)(f.T,{value:C,onChange:e=>O(e.target.value),placeholder:er("https://...","https://..."),className:"min-h-[110px]"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("自然语言规则","Natural language rule")}),(0,r.jsx)(f.T,{value:D,onChange:e=>I(e.target.value),placeholder:er("例如：BOSS直聘/智联，城市=北京，岗位=前端，薪资>20k","e.g. Boss/Zhaopin, city=Beijing, role=frontend, salary>20k")}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:er("右侧会解析为结构化条件，便于确认。","Parsed structured conditions will be shown on the right for confirmation.")})]})]}),(0,r.jsxs)("section",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("去重与更新策略","Dedup & update strategy")}),(0,r.jsxs)(y.z,{value:W,onValueChange:e=>Z(e),className:"grid grid-cols-1 gap-2 sm:grid-cols-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(y.C,{value:"url",id:"rk1"}),(0,r.jsx)(v.J,{htmlFor:"rk1",children:"URL"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(y.C,{value:"externalId",id:"rk2"}),(0,r.jsx)(v.J,{htmlFor:"rk2",children:"External ID"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(y.C,{value:"titleWindow",id:"rk3"}),(0,r.jsx)(v.J,{htmlFor:"rk3",children:er("标题+时间窗口","Title + time window")})]})]}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:er("存在则部分字段更新，不存在则新增。","Upsert: update if exists, otherwise create.")})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:er("调度","Schedule")}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("预设","Preset")}),(0,r.jsxs)(b.l6,{value:K,onValueChange:e=>L(e),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})}),(0,r.jsxs)(b.gC,{children:[(0,r.jsx)(b.eb,{value:"weekdays",children:er("工作日","Weekdays")}),(0,r.jsx)(b.eb,{value:"weekend",children:er("周末","Weekend")}),(0,r.jsx)(b.eb,{value:"daily",children:er("每天","Daily")}),(0,r.jsx)(b.eb,{value:"weekly",children:er("每周","Weekly")}),(0,r.jsx)(b.eb,{value:"monthly",children:er("每月","Monthly")}),(0,r.jsx)(b.eb,{value:"custom",children:er("自定义","Custom")})]})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("时间","Time")}),(0,r.jsx)(g.p,{type:"time",value:P,onChange:e=>E(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("时区","Timezone")}),(0,r.jsxs)(b.l6,{value:U,onValueChange:e=>B(e),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})}),(0,r.jsxs)(b.gC,{children:[(0,r.jsx)(b.eb,{value:"Asia/Shanghai",children:"Asia/Shanghai"}),(0,r.jsx)(b.eb,{value:"UTC",children:"UTC"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("运行模式","Run mode")}),(0,r.jsxs)(y.z,{value:H?"once":"repeat",onValueChange:e=>Q("once"===e),className:"grid grid-cols-2 gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(y.C,{value:"repeat",id:"rm1"}),(0,r.jsx)(v.J,{htmlFor:"rm1",children:er("重复","Repeat")})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(y.C,{value:"once",id:"rm2"}),(0,r.jsx)(v.J,{htmlFor:"rm2",children:er("仅一次","Once")})]})]})]})]}),"custom"===K||"weekly"===K?(0,r.jsx)("div",{className:"flex flex-wrap gap-2 pt-1",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(e=>(0,r.jsx)("button",{className:`px-2.5 py-1 rounded-md text-xs border ${R.includes(e)?"bg-blue-600 text-white border-blue-600":"bg-white/60 dark:bg-neutral-900/60"}`,onClick:()=>{J(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},type:"button",children:eB(e)},e))}):null,"monthly"===K&&(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3 pt-1",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("每月第几天","Day of month")}),(0,r.jsxs)(b.l6,{value:Y,onValueChange:e=>ee(e),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})}),(0,r.jsx)(b.gC,{children:Array.from({length:31}).map((e,t)=>(0,r.jsx)(b.eb,{value:String(t+1),children:t+1},t+1))})]})]})}),H&&(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3 pt-1",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("执行日期","Run date")}),(0,r.jsxs)(j.AM,{children:[(0,r.jsx)(j.Wv,{asChild:!0,children:(0,r.jsx)(x.$,{variant:"outline",className:"w-full justify-start font-normal",children:et?new Date(et).toLocaleDateString():er("选择日期","Pick a date")})}),(0,r.jsx)(j.hl,{className:"p-0",align:"start",children:(0,r.jsx)(w.V,{mode:"single",selected:et?new Date(et):void 0,onSelect:e=>ea(e?e.toISOString():"")})})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,r.jsx)("div",{className:"space-y-1 md:col-span-2",children:(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:[er("CRON 预览","CRON Preview"),"：",(0,r.jsx)("span",{className:"font-mono",children:eq})]})}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(v.J,{children:er("间隔(小时，可选)","Interval (hours, optional)")}),(0,r.jsx)(g.p,{inputMode:"numeric",pattern:"[0-9]*",value:q,onChange:e=>V(e.target.value.replace(/[^0-9]/g,"")),placeholder:er("留空则按上面时间执行","Leave empty to use time above")})]})]})]})]}),(0,r.jsxs)("section",{className:"space-y-3 lg:col-span-2",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:er("抽取样例","Extracted Samples")}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(v.J,{className:"text-xs",children:er("数据数组路径","Array path")}),(0,r.jsxs)(b.l6,{value:ei,onValueChange:e=>en(e),children:[(0,r.jsx)(b.bq,{className:"w-[220px]",children:(0,r.jsx)(b.yv,{})}),(0,r.jsx)(b.gC,{children:["$.items","$.data","$.results"].map(e=>(0,r.jsx)(b.eb,{value:e,children:e},e))})]}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:er("将基于此路径读取记录数组","We will read records from this path")})]}),(0,r.jsx)("div",{className:"rounded-xl border bg-white/60 dark:bg-neutral-900/50 backdrop-blur p-2 max-h-[160px] overflow-auto text-xs",children:0===eo.length?(0,r.jsx)("div",{className:"text-muted-foreground",children:er("暂无样例，请先抓取或爬取。","No samples yet. Scrape/crawl first.")}):(0,r.jsx)("pre",{className:"whitespace-pre-wrap break-all",children:JSON.stringify(eo.slice(0,3),null,2)})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:er("字段映射","Field Mapping")}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.$,{variant:"outline",size:"sm",onClick:eZ,disabled:!!em.scrape,children:em.scrape?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.A,{className:"size-4 mr-1 animate-spin"}),er("抓取中","Scraping")]}):er("试抓取","Scrape test")}),(0,r.jsx)(x.$,{variant:"outline",size:"sm",onClick:eG,disabled:!!em.crawlStart,children:em.crawlStart?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.A,{className:"size-4 mr-1 animate-spin"}),er("启动中","Starting")]}):er("开始爬取","Start crawl")}),(0,r.jsx)(x.$,{variant:"outline",size:"sm",disabled:!ec||!!em.crawlStatus,onClick:eX,children:em.crawlStatus?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.A,{className:"size-4 mr-1 animate-spin"}),er("查询中","Fetching")]}):er("查看状态","Check status")}),(0,r.jsx)(x.$,{variant:"outline",size:"sm",onClick:eY,disabled:!ec||!!em.cancel,children:em.cancel?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.A,{className:"size-4 mr-1 animate-spin"}),er("取消中","Cancelling")]}):er("取消","Cancel")}),(0,r.jsx)(x.$,{variant:"outline",size:"sm",onClick:eH,disabled:!!em.batchStart,children:em.batchStart?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.A,{className:"size-4 mr-1 animate-spin"}),er("批量中","Starting")]}):er("批量开始","Batch start")}),(0,r.jsx)(x.$,{variant:"outline",size:"sm",disabled:!ep||!!em.batchStatus,onClick:eQ,children:em.batchStatus?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.A,{className:"size-4 mr-1 animate-spin"}),er("查询中","Fetching")]}):er("批量状态","Batch status")}),(0,r.jsx)(x.$,{variant:"secondary",size:"sm",onClick:function(){let e={};for(let t of ev){let a=ez.find(e=>e.toLowerCase().includes(t.key.toLowerCase().slice(0,4)));a&&(e[t.key]=a)}eN(e),k({description:er("已自动匹配相近字段","Auto matched similar fields")})},children:er("自动匹配","Auto match")}),(0,r.jsx)(x.$,{variant:"outline",size:"sm",onClick:function(){eN({})},children:er("清空","Clear")}),(0,r.jsx)(x.$,{variant:"outline",size:"sm",onClick:function(){try{let e={mapping:ek,mappingTransform:eS,when:Date.now()};localStorage.setItem(eR(),JSON.stringify(e)),eF(er("映射模板已保存","Mapping template saved")),k({description:er("映射模板已保存","Mapping template saved")})}catch(e){k({description:er("保存失败","Save failed"),variant:"destructive"})}},children:er("保存模板","Save template")}),(0,r.jsx)(x.$,{variant:"outline",size:"sm",onClick:function(){try{let e=localStorage.getItem(eR());if(!e){k({description:er("未找到模板","No template found"),variant:"destructive"});return}let t=JSON.parse(e||"{}");eN(t.mapping||{}),eC(t.mappingTransform||{}),k({description:er("模板已加载","Template loaded")})}catch(e){k({description:er("加载失败","Load failed"),variant:"destructive"})}},children:er("加载模板","Load template")})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-white/60 dark:bg-neutral-900/50 backdrop-blur p-0",children:[eg&&(0,r.jsxs)("div",{className:"px-3 py-2 text-xs text-muted-foreground border-b bg-white/50 dark:bg-neutral-900/40 flex items-center gap-2",children:[(0,r.jsx)(_.A,{className:`size-3 ${Object.values(em).some(Boolean)?"animate-spin":""}`}),(0,r.jsx)("span",{children:eg})]}),(0,r.jsx)("div",{className:"max-h-[240px] overflow-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"sticky top-0 bg-white/70 dark:bg-neutral-900/70 backdrop-blur",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left px-3 py-2 w-[26%]",children:er("字段","Field")}),(0,r.jsxs)("th",{className:"text-left px-3 py-2 w-[30%]",children:[er("来源键","Source key"),(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)(g.p,{value:eT,onChange:e=>e_(e.target.value),placeholder:er("搜索键","Search keys"),className:"h-7"})})]}),(0,r.jsx)("th",{className:"text-left px-3 py-2 w-[22%]",children:er("转换","Transform")}),(0,r.jsx)("th",{className:"text-left px-3 py-2",children:er("示例","Sample")})]})}),(0,r.jsx)("tbody",{children:ew.map(e=>(0,r.jsxs)("tr",{className:"border-t",children:[(0,r.jsxs)("td",{className:"px-3 py-2",children:[(0,r.jsx)("div",{className:"font-medium",children:e.label}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.key})]}),(0,r.jsx)("td",{className:"px-3 py-2 space-y-1",children:"progress"===e.key?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsx)(g.p,{value:eA[e.key]?.arrayPath||"$.progress",onChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{aggregation:"weightedAverage"},arrayPath:t.target.value}})),placeholder:er("数组路径 如 $.progress","Array path e.g. $.progress")}),(0,r.jsxs)(b.l6,{value:eA[e.key]?.aggregation||"weightedAverage",onValueChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{},aggregation:t}})),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})}),(0,r.jsxs)(b.gC,{children:[(0,r.jsx)(b.eb,{value:"weightedAverage",children:"weightedAverage"}),(0,r.jsx)(b.eb,{value:"max",children:"max"}),(0,r.jsx)(b.eb,{value:"min",children:"min"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,r.jsx)(g.p,{value:eA[e.key]?.labelKey||"label",onChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{aggregation:"weightedAverage"},labelKey:t.target.value}})),placeholder:er("标签键 label","label key")}),(0,r.jsx)(g.p,{value:eA[e.key]?.valueKey||"value",onChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{aggregation:"weightedAverage"},valueKey:t.target.value}})),placeholder:er("数值键 value","value key")}),(0,r.jsx)(g.p,{value:eA[e.key]?.statusKey||"status",onChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{aggregation:"weightedAverage"},statusKey:t.target.value}})),placeholder:er("状态键 status","status key")}),(0,r.jsx)(g.p,{value:eA[e.key]?.weightKey||"weight",onChange:t=>e$(a=>({...a,[e.key]:{...a[e.key]||{aggregation:"weightedAverage"},weightKey:t.target.value}})),placeholder:er("权重键 weight","weight key")})]}),(0,r.jsx)("div",{className:"text-[10px] text-muted-foreground",children:er("样例: [{label,value,status,weight}] 将按聚合规则展示","Sample: [{label,value,status,weight}] aggregated by rule")})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.p,{value:ek[e.key]||"",onChange:t=>eN(a=>({...a,[e.key]:t.target.value})),placeholder:er("如 title/desc/link","e.g. title/desc/link")}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(function(e){let t=eL.map(t=>({k:t,s:function(e,t){let a=e.toLowerCase(),r=t.toLowerCase();if(a===r)return 100;if(r.includes(a))return 80;if(a.includes(r))return 70;let s=0;for(let e of a.split(/[_-]/))r.includes(e)&&(s+=10);return s}(e.key,t)})).sort((e,t)=>t.s-e.s).map(e=>e.k);return(eT?t.filter(e=>e.toLowerCase().includes(eT.toLowerCase())):t).slice(0,6)})(e).map(t=>(0,r.jsx)("button",{type:"button",onClick:()=>eN(a=>({...a,[e.key]:t})),className:`text-[10px] px-1.5 py-0.5 rounded border ${ek[e.key]===t?"bg-blue-600 text-white border-blue-600":"bg-white/70"}`,children:t},t)),e.required&&!ek[e.key]&&(0,r.jsx)("span",{className:"text-[10px] text-red-600 ml-1",children:er("必填","Required")})]})]})}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsxs)(b.l6,{value:eS[e.key]||eK(e.type,(eo?.[0]??{})[ek[e.key]||""]),onValueChange:t=>eC(a=>({...a,[e.key]:t})),children:[(0,r.jsx)(b.bq,{children:(0,r.jsx)(b.yv,{})}),(0,r.jsx)(b.gC,{children:eI.map(e=>(0,r.jsx)(b.eb,{value:e.value,children:e.label},e.value))})]})}),(0,r.jsx)("td",{className:"px-3 py-2 text-xs text-muted-foreground truncate",children:String(eo?.[0]?.[ek[e.key]||""])||"—"})]},e.key))})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 text-xs text-muted-foreground",children:[(0,r.jsxs)("div",{children:[er("第","Page")," ",ey,"/",ej]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.$,{variant:"outline",size:"sm",disabled:ey<=1,onClick:()=>eb(e=>Math.max(1,e-1)),children:"Prev"}),(0,r.jsx)(x.$,{variant:"outline",size:"sm",disabled:ey>=ej,onClick:()=>eb(e=>Math.min(ej,e+1)),children:"Next"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:er("预览","Preview")}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(x.$,{variant:"outline",size:"sm",onClick:function(){if(!eo||0===eo.length){k({description:er("暂无样例，请先抓取或爬取。","No samples yet. Scrape/crawl first."),variant:"destructive"});return}let e=eo[0],t={};for(let a of ev){if("progress"===a.key)continue;let r=ek[a.key];if(!r)continue;let s=eP(e,r),i=function(e,t){switch(t){case"trim":return"string"==typeof e?e.trim():e;case"toNumber":return eE(e);case"parseDate":default:return e;case"splitTags":return"string"==typeof e?e.split(/[，,\s]+/).filter(Boolean):Array.isArray(e)?e:[]}}(s,eS[a.key]||eK(a.type,s));t[a.key]=i}let a=eA.progress||{arrayPath:"$.progress",labelKey:"label",valueKey:"value",statusKey:"status",weightKey:"weight",aggregation:"weightedAverage"},r=eP(e,a.arrayPath),s=[];Array.isArray(r)?s=r.map((e,t)=>({id:String(t+1),key:String(e[a.labelKey]||`p${t+1}`),label:String(e[a.labelKey]||`Progress ${t+1}`),value:Math.max(0,Math.min(100,eE(e[a.valueKey]))),status:e[a.statusKey||"status"]||void 0,weight:void 0!==e[a.weightKey||"weight"]?eE(e[a.weightKey||"weight"]):1})):ek.progress&&(s=[{id:"1",key:"progress",label:"Progress",value:Math.max(0,Math.min(100,eE(eP(e,ek.progress)))),weight:1}]),t.progress={items:s,aggregated:function(e,t="weightedAverage"){let a=e.map(e=>({v:Number(e.value??0),w:Number(e.weight??1)}));if("max"===t)return Math.max(0,...a.map(e=>e.v));if("min"===t)return Math.min(100,...a.map(e=>e.v));let r=a.reduce((e,t)=>e+(isFinite(t.w)?t.w:0),0)||1;return Math.max(0,Math.min(100,Math.round(a.reduce((e,t)=>e+(isFinite(t.v)?t.v:0)*(isFinite(t.w)?t.w:0),0)/r)))}(s,a.aggregation)},eD(JSON.stringify({original:e,mapped:t},null,2)),k({description:er("本地预览已生成","Local preview generated")})},children:er("本地预览","Local preview")})})]}),(0,r.jsx)("div",{className:"rounded-xl border bg-white/60 dark:bg-neutral-900/50 backdrop-blur p-3 text-xs text-muted-foreground min-h-[120px]",children:(0,r.jsx)("pre",{className:"whitespace-pre-wrap break-all",children:eM||er("Dry-run 后将在此显示：原始→规范化→字段映射对照。","After dry-run, original → normalized → field mapping diffs will appear here.")})})]})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between pt-3",children:[(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:er("来源与变更将被审计记录，支持回溯。","Source & changes are audited for traceability.")}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.$,{variant:"outline",onClick:()=>t(!1),children:er("取消","Cancel")}),(0,r.jsx)(x.$,{variant:"secondary",onClick:function(){let e={}[a]||{},t=e.openaiEndpoint||e.fastgptEndpoint,r=e.openaiKey||e.fastgptKey;if(!t||!r){k({description:er("请先在设置/授权管理中配置 OpenAI Endpoint 与 Key","Please configure OpenAI Endpoint & Key in Settings/Authorization first"),variant:"destructive"});return}k({description:er("已提交 Dry-run，请稍等…","Dry-run submitted, please wait…")}),fetch("http://47.94.52.142:3007/api/ai/chat",{method:"POST",headers:{"Content-Type":"application/json","x-aino-openai-endpoint":t,"x-aino-openai-key":r},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"user",content:"ping"}]})}).then(async e=>{if(!e.ok)throw Error(await e.text());k({description:er("AI 网关已响应","AI gateway responded")})}).catch(e=>{console.error(e),k({description:er("AI 网关调用失败","AI gateway call failed"),variant:"destructive"})})},children:er("Dry-run 预览","Dry-run")}),(0,r.jsx)(x.$,{onClick:function(){k({description:er("已开始运行，后台执行中","Run started in background")})},children:er("立即运行","Run now")})]})]})]})]})})})})}},90155:(e,t,a)=>{a.d(t,{F:()=>n});var r=a(33752);a(82153);var s=a(93669),i=a(1237);function n({className:e,children:t,...a}){return(0,r.jsxs)(s.bL,{"data-slot":"scroll-area",className:(0,i.cn)("relative",e),...a,children:[(0,r.jsx)(s.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:t}),(0,r.jsx)(l,{}),(0,r.jsx)(s.OK,{})]})}function l({className:e,orientation:t="vertical",...a}){return(0,r.jsx)(s.VM,{"data-slot":"scroll-area-scrollbar",orientation:t,className:(0,i.cn)("flex touch-none p-px transition-colors select-none","vertical"===t&&"h-full w-2.5 border-l border-l-transparent","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent",e),...a,children:(0,r.jsx)(s.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}}};